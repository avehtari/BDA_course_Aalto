<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aki Vehtari et al.">

<title>Bayesian Data Analysis Assignments 2023 - Assignment 7, 2023</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./assignment8.html" rel="next">
<link href="./assignment6.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignment1.html">Assignments</a></li><li class="breadcrumb-item"><a href="./assignment7.html">Assignment 7, 2023</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bayesian Data Analysis Assignments 2023</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">General instructions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment_instructions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment instructions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 1, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 2, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 3, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 4, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 5, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 6, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment7.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Assignment 7, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 8, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 9, 2023</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Templates</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 1, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 2, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 3, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 4, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 5, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 6, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 7, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 8, 2023</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 9, 2023</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#general-information" id="toc-general-information" class="nav-link active" data-scroll-target="#general-information"><span class="header-section-number">1</span> General information</a></li>
  <li><a href="#hierarchical-model-chicken-data-with-stan-6p" id="toc-hierarchical-model-chicken-data-with-stan-6p" class="nav-link" data-scroll-target="#hierarchical-model-chicken-data-with-stan-6p"><span class="header-section-number">2</span> Hierarchical Model: Chicken Data with Stan (6p)</a>
  <ul class="collapse">
  <li><a href="#choosing-a-weakly-informative-prior-by-intuition" id="toc-choosing-a-weakly-informative-prior-by-intuition" class="nav-link" data-scroll-target="#choosing-a-weakly-informative-prior-by-intuition"><span class="header-section-number">2.1</span> Choosing a weakly informative prior by intuition</a></li>
  <li><a href="#choosing-a-weakly-informative-prior-using-external-references" id="toc-choosing-a-weakly-informative-prior-using-external-references" class="nav-link" data-scroll-target="#choosing-a-weakly-informative-prior-using-external-references"><span class="header-section-number">2.2</span> Choosing a weakly informative prior using external references</a></li>
  <li><a href="#non-normal-priors" id="toc-non-normal-priors" class="nav-link" data-scroll-target="#non-normal-priors"><span class="header-section-number">2.3</span> Non-normal priors</a></li>
  <li><a href="#modeling-diet-effects-on-chicken-weight" id="toc-modeling-diet-effects-on-chicken-weight" class="nav-link" data-scroll-target="#modeling-diet-effects-on-chicken-weight"><span class="header-section-number">2.4</span> Modeling diet effects on chicken weight</a></li>
  </ul></li>
  <li><a href="#hierarchical-model-with-brms-3p" id="toc-hierarchical-model-with-brms-3p" class="nav-link" data-scroll-target="#hierarchical-model-with-brms-3p"><span class="header-section-number">3</span> Hierarchical model with BRMS (3p)</a></li>
  <li><a href="#overall-quality-of-the-report" id="toc-overall-quality-of-the-report" class="nav-link" data-scroll-target="#overall-quality-of-the-report"><span class="header-section-number">4</span> Overall quality of the report</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="assignment7.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignment1.html">Assignments</a></li><li class="breadcrumb-item"><a href="./assignment7.html">Assignment 7, 2023</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Assignment 7, 2023</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Hierarchical model in Stan</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Aki Vehtari et al. </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Currently, rendering on github is broken, such that the rendered template at <a href="https://avehtari.github.io/BDA_course_Aalto/assignments/template7.html">https://avehtari.github.io/BDA_course_Aalto/assignments/template7.html</a> looks weird. Rendering should however work on Aalto’s JupyterLab, but we will also try to fix rendering on github ASAP.</p>
</div>
</div>
<section id="general-information" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> General information</h1>
<p><strong>This is for BDA 2023</strong></p>
<p><strong>The maximum amount of points from this assignment is 9.</strong></p>
<p>We have prepared a <strong>quarto template specific to this assignment (<a href="template7.html">html</a>, <a href="https://avehtari.github.io/BDA_course_Aalto/assignments/template7.qmd">qmd</a>, <a href="template7.pdf">pdf</a>)</strong> to help you get started.</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Setup">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Setup
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We recommend Aalto students use <a href="https://jupyter.cs.aalto.fi">jupyter.cs.aalto.fi</a>, for all others we also provide a <a href="docker.html">docker container</a>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><strong>Reading instructions</strong>:</p>
<ul>
<li><a href="../BDA3_notes.html#ch5"><strong>The reading instructions for BDA3 Chapter 5</strong></a>.</li>
</ul>
<p><strong>Grading instructions:</strong></p>
<p>The grading will be done in peergrade. All grading questions and evaluations for this assignment are contained within this document in the collapsible <strong>Rubric</strong> blocks.</p>
<p><strong>Installing and using <code>CmdStanR</code>:</strong></p>
<p>See the <a href="https://avehtari.github.io/BDA_course_Aalto/demos.html">Stan demos</a> on how to use Stan in R (or Python). <a href="https://Aalto%20JupyterHub">Aalto JupyterHub</a> has working R and CmdStanR/RStan environment and is probably the easiest way to use Stan. * To use CmdStanR in <a href="https://Aalto%20JupyterHub">Aalto JupyterHub</a>:<br> <code>library(cmdstanr)</code><br> <code>set_cmdstan_path('/coursedata/cmdstan')</code></p>
<p>The Aalto Ubuntu desktops also have the necessary libraries installed.</p>
<p>To install Stan on your laptop, run ‘install.packages("cmdstanr", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))’ in R. If you encounter problems, see additional answers in <a href="https://avehtari.github.io/BDA_course_Aalto/FAQ.html"><strong>FAQ</strong></a>. For Aalto students, if you don’t succeed in short amount of time, it is probably easier to use <a href="https://Aalto%20JupyterHub">Aalto JupyterHub</a>.</p>
<p>If you use <code>Aalto JupyterHub</code>, all necessary packages have been pre-installed. In your laptop, install package <code>cmdstanr</code>. Installation instructions on Linux, Mac and Windows can be found at <a href="https://mc-stan.org/cmdstanr/" class="uri">https://mc-stan.org/cmdstanr/</a>. Additional useful packages are <code>loo</code>, <code>bayesplot</code> and <code>posterior</code> (but you don’t need these in this assignment). For Python users, <code>PyStan</code>, <code>CmdStanPy</code>, and <code>ArviZ</code> packages are useful.</p>
<p>Stan manual can be found at <a href="https://mc-stan.org/users/documentation/" class="uri">https://mc-stan.org/users/documentation/</a>. From this website, you can also find a lot of other useful material about Stan.</p>
<p>If you edit files ending <code>.stan</code> in RStudio, you can click “Check” in the editor toolbar to make syntax check. This can significantly speed-up writing a working Stan model.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reporting accuracy
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><strong>For posterior statistics of interest, only report digits that are not completely random based on the Monte Carlo standard error (MCSE).</strong></p>
<p><em>Example:</em> If you estimate <span class="math inline">\(E(\mu) \approx 1.234\)</span> with MCSE(<span class="math inline">\(E(\mu)\)</span>) = 0.01, then the true expectation is likely to be between <span class="math inline">\(1.204\)</span> and <span class="math inline">\(1.264\)</span>, it makes sense to report <span class="math inline">\(E(\mu) \approx 1.2\)</span>.</p>
<p>See Lecture video 4.1, <a href="../BDA3_notes.html#ch10">the chapter notes</a>, and <a href="https://avehtari.github.io/casestudies/Digits/digits.html">a case study</a> for more information.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Further information
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>The recommended tool in this course is R (with the IDE RStudio).</li>
<li>Instead of installing R and RStudio on you own computer, see <a href="https://avehtari.github.io/BDA_course_Aalto/FAQ.html#How_to_use_R_and_RStudio_remotely"><strong>how to use R and RStudio remotely</strong></a>.</li>
<li>If you want to install R and RStudio locally, download <a href="https://posit.co/download/rstudio-desktop/">R and RStudio</a>.</li>
<li>There are tons of tutorials, videos and introductions to R and RStudio online. You can find some initial hints from <a href="https://education.rstudio.com/"><strong>RStudio Education pages</strong></a>.</li>
<li>When working with R, we recommend writing the report using <code>quarto</code> and the provided template. The template includes the formatting instructions and how to include code and figures.</li>
<li>Instead of <code>quarto</code>, you can use other software to make the PDF report, but the the same instructions for formatting should be used.</li>
<li>Report all results in a single, <strong>anonymous</strong> *.pdf -file and submit it in <a href="peergrade.io"><strong>peergrade.io</strong></a>.</li>
<li>The course has its own R package <code>aaltobda</code> with data and functionality to simplify coding. The package is pre-installed in JupyterHub. To install the package on your own system, run the following code (upgrade="never" skips question about updating other packages):</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">install.packages</span>(<span class="st">"aaltobda"</span>, <span class="at">repos =</span> <span class="fu">c</span>(<span class="st">"https://avehtari.github.io/BDA_course_Aalto/"</span>, <span class="fu">getOption</span>(<span class="st">"repos"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Many of the exercises can be checked automatically using the R package <code>markmyassignment</code> (pre-installed in JupyterHub). Information on how to install and use the package can be found in <a href="https://cran.r-project.org/web/packages/markmyassignment/vignettes/markmyassignment.html">the <code>markmyassignment</code> documentation</a>. There is no need to include <code>markmyassignment</code> results in the report.</li>
<li>Recommended additional self study exercises for each chapter in BDA3 are listed in the course web page. These will help to gain deeper understanding of the topic.</li>
<li>Common questions and answers regarding installation and technical problems can be found in <a href="https://avehtari.github.io/BDA_course_Aalto/FAQ.html">Frequently Asked Questions (FAQ)</a>.</li>
<li>Deadlines for all assignments can be found on the course web page and in Peergrade. You can set email alerts for the deadlines in Peergrade settings.</li>
<li>You are allowed to discuss assignments with your friends, but it is not allowed to copy solutions directly from other students or from internet.</li>
<li>You can copy, e.g., plotting code from the course demos, but really try to solve the actual assignment problems with your own code and explanations.</li>
<li>Do not share your answers publicly.</li>
<li>Do not copy answers from the internet or from previous years. We compare the answers to the answers from previous years and to the answers from other students this year.</li>
<li>Use of AI is allowed on the course, but the most of the work needs to by the student, and you need to report whether you used AI and in which way you used them (See <a href="https://www.aalto.fi/en/services/guidance-for-the-use-of-artificial-intelligence-in-teaching-and-learning-at-aalto-university">points 5 and 6 in Aalto guidelines for use of AI in teaching</a>).</li>
<li>All suspected plagiarism will be reported and investigated. See more about the <a href="https://into.aalto.fi/display/ensaannot/Aalto+University+Code+of+Academic+Integrity+and+Handling+Violations+Thereof"><strong>Aalto University Code of Academic Integrity and Handling Violations Thereof</strong></a>.</li>
<li>Do not submit empty PDFs, almost empty PDFs, copy of the questions, nonsense generated by yourself or AI, as these are just harming the other students as they can’t do peergrading for the empty or nonsense submissions. Violations of this rule will be reported and investigated in the same way was plagiarism.</li>
<li>If you have any suggestions or improvements to the course material, please post in the course chat feedback channel, create an issue, or submit a pull request to the public repository!</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Can you open the PDF and it’s not blank nor nonsense? If the pdf is blank, nonsense, or something like only a copy of the questions, 1) report it as problematic in Peergrade-interface to get another report to review, and 2) send a message to TAs.</li>
<li>Is the report anonymous?</li>
</ul>
</div>
</div>
<p>This is the template for <a href="assignment7.html">assignment 7</a>. You can download the <a href="./additional_files/assignment7/chickens_separate.stan">separate model with bad priors</a> and the <a href="https://avehtari.github.io/BDA_course_Aalto/assignments/template7.qmd">qmd-file</a> or copy the code from this rendered document after clicking on <code>&lt;/&gt; Code</code> in the top right corner.</p>
<p><strong>Please replace the instructions in this template by your own text, explaining what you are doing in each exercise.</strong></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Setup
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The following loads several needed packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">library</span>(aaltobda)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">library</span>(bayesplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>This is bayesplot version 1.11.1.9000</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- Online documentation and vignettes at mc-stan.org/bayesplot</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- bayesplot theme set to bayesplot::theme_default()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>   * Does _not_ affect other ggplot2 plots</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>   * See ?bayesplot_theme_set for details on theme setting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">library</span>(cmdstanr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>This is cmdstanr version 0.8.1.9000</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- CmdStanR documentation and vignettes: mc-stan.org/cmdstanr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- CmdStan path: /u/77/ave/unix/.cmdstan/cmdstan-2.35.0-rc3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- CmdStan version: 2.35.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">library</span>(ggdist) <span class="co"># for stat_dotsinterval</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="fu">library</span>(posterior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>This is posterior version 1.6.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'posterior'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:bayesplot':

    rhat</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:aaltobda':

    mcse_quantile</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    mad, sd, var</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    %in%, match</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(brms)){</span>
<span id="cb24-2"><a href="#cb24-2"></a>    <span class="fu">install.packages</span>(<span class="st">"brms"</span>)</span>
<span id="cb24-3"><a href="#cb24-3"></a>    <span class="fu">library</span>(brms)</span>
<span id="cb24-4"><a href="#cb24-4"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: brms</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Rcpp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading 'brms' package (version 2.21.6). Useful instructions
can be found by typing help('brms'). A more detailed introduction
to the package is available through vignette('brms_overview').</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'brms'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:ggdist':

    dstudent_t, pstudent_t, qstudent_t, rstudent_t</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:bayesplot':

    rhat</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    ar</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Set more readable themes with bigger font for plotting packages.</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>ggplot2<span class="sc">::</span><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>))</span>
<span id="cb32-3"><a href="#cb32-3"></a>bayesplot<span class="sc">::</span><span class="fu">bayesplot_theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>))</span>
<span id="cb32-4"><a href="#cb32-4"></a></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="co"># This registers CmdStan as the backend for compiling cmdstan-chunks.</span></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="fu">check_cmdstan_toolchain</span>(<span class="at">fix =</span> <span class="cn">TRUE</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="fu">register_knitr_engine</span>(<span class="at">override =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="hierarchical-model-chicken-data-with-stan-6p" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Hierarchical Model: Chicken Data with Stan (6p)</h1>
<p><strong>Do not look at the secret dataset until you have defined your priors in section 2.1.</strong></p>
<p>A secret dataset, included in base <code>r</code>, contains weight measurements from 50 chicks from their birth until the age of 21 days. For this task, we are interested in modeling the weight of a chick at the age of 12 days.</p>
<section id="choosing-a-weakly-informative-prior-by-intuition" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="choosing-a-weakly-informative-prior-by-intuition"><span class="header-section-number">2.1</span> Choosing a weakly informative prior by intuition</h2>
<p>We will first guide you through two processes for choosing <em>weakly</em> informative priors which you can use in your projects as well (though, if expert knowledge is present, we encourage to use that though instead). Many definitions of <em>weak</em> exist, but for our purposes, we intend to set priors in this assignment which don’t overwhelm the likelihood contributions to the posterior while still exerting some amount of regularisation.</p>
<p>In the absence of additional information, we will assume that chick weights at 12 days of age (<span class="math inline">\(w\)</span>) follow a normal distribution: <span class="math display">\[
w\sim\mathcal N (\mu,\sigma).
\]</span> Our task will be to define weakly informative priors for the mean <span class="math inline">\(\mu\)</span> given observation model standard deviation, <span class="math inline">\(\sigma\)</span> (a prior distribution for <span class="math inline">\(\sigma\)</span> will be set in after section 2).</p>
<p>Here, <span class="math inline">\(\mu\)</span> represents the population mean chick weight at 12 days and <span class="math inline">\(\sigma\)</span> represents the standard-deviation of the chick weights <span class="math inline">\(w\)</span> around that population mean. For this exercise, we will be specifying a normal prior for <span class="math inline">\(\mu\)</span>:</p>
<p><span class="math display">\[
\mu\sim\mathcal N (\mu_0,\sigma_0).
\]</span></p>
<p><span class="math inline">\(\mu_0\)</span> represents our prior knowledge of what we believe the population weight to be and <span class="math inline">\(\sigma_0\)</span> represents our level of certainty in this belief. To specify a weakly-informative prior for <span class="math inline">\(\mu\)</span> we need to select values of <span class="math inline">\(\mu_0\)</span> and <span class="math inline">\(\sigma_0\)</span> that imply the range of plausible values that <span class="math inline">\(\mu\)</span> could take.</p>
<p>We can do this by our own intuitive prior knowledge (if such intuition exists), or by searching for external references.</p>
<p>Despite the name, weakly informed priors can be quite subjective (<a href="http://www.stat.columbia.edu/~gelman/research/published/entropy-19-00555-v2.pdf">see for more theoretical discussion here</a>), such that some justification is always needed. For the subtasks below, you will not be graded on the accuracy or precision of your numbers, but on your justification of them. The numerical choices you make should make sense and be understandable to an external reviewer of your work (even if they may not agree with your choices).</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A word of caution on eliciting the priors below
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Please note that in the below, we intend to set a prior on <span class="math inline">\(\mu\)</span> (the <em>mean</em> chick weight), but the intuition we ilicit is based on the weight of <em>individual</em> chicks. We do so to help create intuition about what the mean could be, however, it would be theoretically more accurate to ilicit priors about <em>mean</em> chick weights.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>We have made changes to the assignment text and some of the rubrics to make it clearer.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.a)">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.a)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on your own past experience and estimation skills, what would you guess is a typical weight range of a fully grown chicken in grams? Justify your choice with 1-3 sentences.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Would it make sense if a chicken weighed 1 million grams? 0.005 grams? What about a chicken that weighed more than you? More than a car? Note that is not important to have a very precise or accurate guess here, the key goal is simply to identify the range of plausible (or at least possible) values.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<section id="fully-grown-chicken-weight-range-by-intuition" class="level3 callout-body-container callout-body" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="fully-grown-chicken-weight-range-by-intuition"><span class="header-section-number">2.1.1</span> Fully grown chicken weight range by intuition</h3>
<ul>
<li>Does the chosen range meet the following common sense criteria?
<ul>
<li>The range is always above and below .</li>
</ul></li>
<li>Is the justification based on some sort of logic, even if you may disagree?</li>
</ul>
</section>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.b">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.b
</div>
</div>
<div class="callout-body-container callout-body">
<p>Adjust this range for a 12-day old chick and choose a mean <span class="math inline">\(\mu_0\)</span> for the weakly informed prior of the parameter <span class="math inline">\(\mu.\)</span> Justify your adjustment and choice with 1-3 sentences.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<section id="day-old-chick-weight-range-by-intuition" class="level3 callout-body-container callout-body" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="day-old-chick-weight-range-by-intuition"><span class="header-section-number">2.1.2</span> 12-day old chick weight range by intuition</h3>
<ul>
<li>The range is always above and below .</li>
<li>Is the justification based on some sort of logic, even if you may disagree?</li>
</ul>
</section>
</div>
<p>Choosing the prior standard deviation for <span class="math inline">\(\mu\)</span> requires a little more caution; overconfident (i.e.&nbsp;narrow) priors can have a strong effect on your results, whereas less confident priors are more easily overcome with observed data. Given that overconfidence is a common human bias, a good intuition-based standard deviation should focus on eliminating the impossible values, rather than including the most likely values.</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.c">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.c
</div>
</div>
<div class="callout-body-container callout-body">
<p>Choose a conservative lower and upper bound for the weight of any 12-day old chick, with the goal to exclude impossible values. Justify your choice with 1-3 sentences.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Depending on your choice of range above for a “typical” chick, this range excluding the impossible values should be wider.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<section id="prior-standard-deviation-by-intuition" class="level3 callout-body-container callout-body" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="prior-standard-deviation-by-intuition"><span class="header-section-number">2.1.3</span> Prior standard deviation by intuition</h3>
<ul>
<li>Does the chosen range meet the following common sense criteria?
<ul>
<li>The range is always above and below .</li>
</ul></li>
<li>Is the justification based on some sort of logic, even if you may disagree?</li>
</ul>
</section>
</div>
<p>A common technique to find a weakly informative prior is to have a standard deviation which is an order of magnitude (a factor of 10) larger than a plausible standard deviation of the data.</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.d">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.d
</div>
</div>
<div class="callout-body-container callout-body">
<p>What do you think is a plausible standard deviation <span class="math inline">\(\sigma_\text{plausible}\)</span> of the weight of 12 days-old chicks, based on your ranges stated above? Under the above recommendation, what standard deviation <span class="math inline">\(\sigma_0\)</span> should you use for your prior for the mean weight <span class="math inline">\(\mu\)</span>?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<section id="prior-standard-deviation-by-intuition-1" class="level4 callout-body-container callout-body" data-number="2.1.3.1">
<h4 data-number="2.1.3.1" class="anchored" data-anchor-id="prior-standard-deviation-by-intuition-1"><span class="header-section-number">2.1.3.1</span> Prior standard deviation by intuition</h4>
<ul>
<li>Do the two standard deviations meet the following common sense criteria?
<ul>
<li>Both values are </li>
</ul></li>
<li>Given the choice of mean from above, the interval <span class="math inline">\((\mu_0 - 3\sigma_0, \mu_0 + 3\sigma_0)\)</span> includes .</li>
</ul>
</section>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.e">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.e
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write down in mathematical form the final prior for the mean weight <span class="math inline">\(\mu\)</span> you found using this prior definition technique.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<section id="prior-by-intuition" class="level3 callout-body-container callout-body" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="prior-by-intuition"><span class="header-section-number">2.1.4</span> Prior by intuition</h3>
<ul>
<li>Does the final prior exist in mathematical notation?</li>
<li>Does the prior reflect the choices made above (i.e.&nbsp;<span class="math inline">\(\mu_0, \sigma_0\)</span>)?</li>
</ul>
</section>
</div>
</section>
<section id="choosing-a-weakly-informative-prior-using-external-references" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="choosing-a-weakly-informative-prior-using-external-references"><span class="header-section-number">2.2</span> Choosing a weakly informative prior using external references</h2>
<p>Next, we’ll use external references to pick the weakly informed prior. This technique is more general and doesn’t assume you would have prior knowledge.</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.f">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.f
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consult a trustworthy source on the weight range of farm chickens, e.g.&nbsp;books, articles, a farmer friend. If the recommended values are for a fully grown chicken, make a reasonable adjustment for a 12-day old chick. What is the weight range of a 12-day old chicken? Cite your source and justify any adjustments you make to the reference range.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<section id="weight-range-by-reference" class="level3 callout-body-container callout-body" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="weight-range-by-reference"><span class="header-section-number">2.2.1</span> Weight range by reference</h3>
<ul>
<li>Does the reference range meet the following common sense criteria?
<ul>
<li>The range is always above and below .</li>
</ul></li>
<li>Is there a citation? If an adjustment was made, was it justified by logic, even if you disagree?</li>
</ul>
</section>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.g">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.g
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on this reference range, what will you choose for the mean of our weakly informed prior? Justify your choice with 1-3 sentences.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<section id="weight-range-by-reference-1" class="level3 callout-body-container callout-body" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="weight-range-by-reference-1"><span class="header-section-number">2.2.2</span> Weight range by reference</h3>
<ul>
<li>Does the mean value meet the following common sense criteria?
<ul>
<li>The range is always above and below .</li>
</ul></li>
</ul>
</section>
</div>
<p>Next we choose the standard deviation of the prior. We could use the same technique as before, but we’ll walk you through another common approach. Assume that <span class="math inline">\(99.7\%\)</span> of all 12-day old chicks fall into the reference range you found. Under our assumption of a normal distribution, this range will encompass values between <span class="math inline">\(\mu_0 \pm 3\sigma_0\)</span>.</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.h">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.h
</div>
</div>
<div class="callout-body-container callout-body">
<p>Assuming symmetry, use the mean you chose and either the upper or lower bound <span class="math inline">\(b\)</span> of your reference range to solve the correct version of the following equations to find your associated choice of <span class="math inline">\(\sigma_0\)</span>: (show your work)</p>
<ul>
<li>For upper bound <span class="math inline">\(b_u\)</span>: <span class="math inline">\(Pr(\mu_0 + 3\sigma_0 &lt; b_u) \approx 0.997\)</span>, solving for <span class="math inline">\(\sigma_0\)</span>.</li>
<li>For lower bound <span class="math inline">\(b_l\)</span>: <span class="math inline">\(Pr(\mu_0 - 3\sigma_0 &gt; b_l) \approx 0.997\)</span>, solving for <span class="math inline">\(\sigma_0\)</span>.</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<section id="prior-standard-deviation-by-reference" class="level3 callout-body-container callout-body" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="prior-standard-deviation-by-reference"><span class="header-section-number">2.2.3</span> Prior standard deviation by reference</h3>
<ul>
<li>Does the calculated <span class="math inline">\(\sigma_0\)</span> value meet the following common sense criteria?
<ul>
<li>The value is above and below .</li>
</ul></li>
<li>Did they show their work?</li>
</ul>
</section>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.i">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.i
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write down in mathematical form the final prior for the mean weight <span class="math inline">\(\mu\)</span> you found using this prior definition technique.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<section id="prior-by-reference" class="level3 callout-body-container callout-body" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="prior-by-reference"><span class="header-section-number">2.2.4</span> Prior by reference</h3>
<ul>
<li>Does the final prior exist in mathematical notation?</li>
<li>Does the prior reflect the choices made above (i.e.&nbsp;<span class="math inline">\(\mu_0, \sigma_0\)</span>)?</li>
</ul>
</section>
</div>
</section>
<section id="non-normal-priors" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="non-normal-priors"><span class="header-section-number">2.3</span> Non-normal priors</h2>
<p>The previous steps all assumed we could use a prior which is normally distributed, but this may not always be the correct assumption to make.</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.j">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.j
</div>
</div>
<div class="callout-body-container callout-body">
<p>Under what mathematical/statistical circumstances would a normal distributed prior not make sense? List at least one circumstance. Are there values that the normal distribution can take on which would not make sense for some types of variables?</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-31-contents" aria-controls="callout-31" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-31" class="callout-31-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Consider the nature of any variable you are trying to define a prior over.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<section id="non-normal-priors-1" class="level3 callout-body-container callout-body" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="non-normal-priors-1"><span class="header-section-number">2.3.1</span> Non-normal priors</h3>
<ul>
<li>Example cases include variables that or variables that </li>
</ul>
</section>
</div>
</section>
<section id="modeling-diet-effects-on-chicken-weight" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="modeling-diet-effects-on-chicken-weight"><span class="header-section-number">2.4</span> Modeling diet effects on chicken weight</h2>
<p>In addition to chick weights, the data also contains a categorical variable indicating which diet the chick received. In the data file, each column contains the measurements for a single chick at a given point of time.</p>
<p>In addition to the existing diets, we are interested in the quality of another box of feed (the fifth diet), which a farmer happened to find yesterday at a dark corner of his warehouse. To read in the data and select chicks with age of 12 days, and to have a peek at the first 6 rows, just use:</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-34-contents" aria-controls="callout-34" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data inside, don’t peek before you have set your priors!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-34" class="callout-34-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-33-contents" aria-controls="callout-33" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Have you set your priors?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-33" class="callout-33-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">data</span>(<span class="st">"ChickWeight"</span>)</span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a>Chick12 <span class="ot">&lt;-</span> ChickWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(Time <span class="sc">==</span> <span class="dv">12</span>)</span>
<span id="cb33-4"><a href="#cb33-4"></a></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="fu">head</span>(Chick12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Grouped Data: weight ~ Time | Chick
  weight Time Chick Diet
1    106   12     1    1
2    122   12     2    1
3    115   12     3    1
4    102   12     4    1
5    141   12     5    1
6    141   12     6    1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>In the following analysis, we will model the <strong>weight of a chick at the age of 12 days</strong>. We will use the following three Gaussian models:</p>
<ul>
<li>a separate model, in which each diet is modeled individually</li>
<li>a pooled model, in which all measurements are combined and there is no distinction between diets</li>
<li>a hierarchical model, which has a hierarchical structure as described in <a href="https://users.aalto.fi/~ave/BDA3.pdf">BDA3</a> Section 11.6</li>
</ul>
<p>As in the model described in the book, use the same weight standard deviation <span class="math inline">\(\sigma\)</span> for all the groups in the hierarchical model. In the separate model, however, use separate weight standard deviation <span class="math inline">\(\sigma_d\)</span> for each diet <span class="math inline">\(d\)</span>. You should use weakly informative priors for all your models.</p>
<p>The provided Stan code below is given as an example of a separate model. Note that the author has left a comment expressing uncertainty about their prior choices. This separate model can be summarized mathematically as <span id="eq-separate"><span class="math display">\[
\begin{aligned}
    \mu_{d} &amp;\sim \pi(\mu_d)&amp;&amp;\text{(diet-wise mean weight),}\\
    \sigma_d &amp;\sim \pi(\sigma_d)&amp;&amp;\text{(diet-wise standard deviation of diet-wise chicken weights)},\\
    w_{i,d} &amp;\sim N(\mu_d,\sigma_d)&amp;&amp;\text{(diet-wise chicken weights)}\\
\end{aligned}
\tag{1}\]</span></span></p>
<p>with priors</p>
<p><span id="eq-separate-priors"><span class="math display">\[
\begin{aligned}
    \mu_{d} &amp;\sim N(0,10)&amp;&amp;\text{(adjust this) and}\\
    \sigma_d &amp;\sim\mathrm{exponential}(.02)&amp;&amp;\text{(you can keep this).}
\end{aligned}
\tag{2}\]</span></span></p>
<p>For the separate and the pooled models, use one of the weakly informative priors you have derived in 2.1) or 2.2) for the diet-wise mean weights <span class="math display">\[\mu_d\sim \pi(\mu_d)=N(\mu_0,\sigma_0).\]</span> For the hierarchical model, remember that the parameters in the priors for the diet-wise mean weights itself have to be parameters with their own prior distributions, in our case <span class="math display">\[
\begin{aligned}
\mu_d &amp;\sim N(\mu,\tau)&amp;&amp;\text{(diet-wise mean weights)},\\
\mu &amp;\sim \pi(\mu)&amp;&amp;\text{(mean of prior for diet-wise mean weights) and}\\
\tau &amp;\sim \pi(\tau)&amp;&amp;\text{(standard deviation of prior for diet-wise mean weights).}
\end{aligned}
\]</span></p>
<p>Use the prior you have used for the diet-wise mean weights <span class="math inline">\(\mu_d\)</span> in the separate and pooled models for the prior on the mean of the prior for the diet-wise mean weights <span class="math display">\[\mu \sim \pi(\mu) = N(\mu_0,\sigma_0)\]</span> in the hierarchical model and use <span class="math display">\[\tau \sim \pi(\tau) = \mathrm{exponential}(.02)\]</span> for the prior on the standard deviation of the prior for the diet-wise mean weights.</p>
<div class="sourceCode" id="cb35" data-include="additional_files/assignment7/chickens_separate.stan"><pre class="sourceCode numberSource stan number-lines code-with-copy"><code class="sourceCode stan"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-35-contents" aria-controls="callout-35" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sample from the posterior
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-35" class="callout-35-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>To sample from the posterior using Stan, use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="at">N_observations =</span> <span class="fu">nrow</span>(Chick12),</span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="at">N_diets =</span> <span class="fu">length</span>(<span class="fu">unique</span>(Chick12<span class="sc">$</span>Diet)),</span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="at">diet_idx =</span> Chick12<span class="sc">$</span>Diet,</span>
<span id="cb36-5"><a href="#cb36-5"></a>  <span class="at">weight =</span> Chick12<span class="sc">$</span>weight</span>
<span id="cb36-6"><a href="#cb36-6"></a>)</span>
<span id="cb36-7"><a href="#cb36-7"></a></span>
<span id="cb36-8"><a href="#cb36-8"></a>model_separate <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="at">stan_file =</span> <span class="st">"additional_files/assignment7/chickens_separate.stan"</span>)</span>
<span id="cb36-9"><a href="#cb36-9"></a></span>
<span id="cb36-10"><a href="#cb36-10"></a><span class="co"># Sampling from the posterior distribution happens here:</span></span>
<span id="cb36-11"><a href="#cb36-11"></a>fit_separate <span class="ot">&lt;-</span> model_separate<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> stan_data, <span class="at">refresh=</span><span class="dv">0</span>,</span>
<span id="cb36-12"><a href="#cb36-12"></a>                                      <span class="at">show_messages=</span><span class="cn">FALSE</span>,</span>
<span id="cb36-13"><a href="#cb36-13"></a>                                      <span class="at">show_exceptions=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: No chains finished successfully. Unable to retrieve the fit.</code></pre>
</div>
</div>
<p>Fit objects returned by the <code>sample()</code> method, by default print a summary of the posterior draws. These are <strong>NOT</strong> the results you would expect to turn in your report. You will need to change the priors in the code for the separate model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>fit_separate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: Fitting failed. Unable to print.</code></pre>
</div>
</div>
<p>Quick model convergence check (as in assignment 6):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>fit_separate<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: No CmdStan runs finished successfully. Unable to run bin/diagnose.</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.k">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.k
</div>
</div>
<div class="callout-body-container callout-body">
<p>Describe the models with mathematical notation (as is done for the separate model above). Also describe in words the difference between the model and the other models.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Are the models described using mathematical notation and the difference to other models described in words?
<ul>
<li>No equations and no description</li>
<li>Description but no equations</li>
<li>Equations but no description</li>
<li>Equations and description</li>
</ul></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.l">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.l
</div>
</div>
<div class="callout-body-container callout-body">
<p>Implement the models in Stan and include the code in the report. Use weakly informative priors for all of your models.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-39-contents" aria-controls="callout-39" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-39" class="callout-39-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>When sampling from the posterior of the hierarchical model, you will very likely get a warning about divergent transitions. This tells you that the sampler is having difficulties in sampling the joint posterior and this may lead to biased inference. We will return to this in the next task.</p>
</div>
</div>
</div>
<p><strong>For the figures below, we use the earlier draws for the separate model with bad priors. When you have implemented the pooled and hierarchical models, edit the code below to include draws from your model posterior into the figures.</strong></p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-40-contents" aria-controls="callout-40" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data preparation and sampling from the posterior
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-40" class="callout-40-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>fit_pooled <span class="ot">&lt;-</span> fit_separate</span>
<span id="cb42-2"><a href="#cb42-2"></a>fit_hierarchical <span class="ot">&lt;-</span> fit_separate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below, we collect the corresponding posterior draws from the three models into a shared data frame using the <code>extract_variable</code> function. This makes plotting the posterior in a single plot easier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># Expect the same number of posterior draws from each model.</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>ndraws <span class="ot">&lt;-</span> <span class="fu">nrow</span>(fit_hierarchical<span class="sc">$</span><span class="fu">sampler_diagnostics</span>(<span class="at">format =</span> <span class="st">"matrix"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: No chains finished successfully. Unable to retrieve the sampler diagnostics.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Collect posterior draws and the model used to a data frame.</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>mean_diet_4_separate <span class="ot">=</span> <span class="fu">extract_variable</span>(fit_separate, <span class="st">"mean_diet[4]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: No chains finished successfully. Unable to retrieve the draws.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>mean_diet_4_pooled <span class="ot">=</span> <span class="fu">extract_variable</span>(fit_pooled, <span class="st">"mean_diet[4]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: No chains finished successfully. Unable to retrieve the draws.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>mean_diet_4_hierarchical <span class="ot">=</span> <span class="fu">extract_variable</span>(fit_hierarchical, <span class="st">"mean_diet[4]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: No chains finished successfully. Unable to retrieve the draws.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>posterior_mean_diet_4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb51-2"><a href="#cb51-2"></a>  <span class="at">model_name =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Separate"</span>, <span class="st">"Pooled"</span>, <span class="st">"Hierarchical"</span>),</span>
<span id="cb51-3"><a href="#cb51-3"></a>              <span class="at">each =</span> ndraws),</span>
<span id="cb51-4"><a href="#cb51-4"></a>  <span class="at">mean_diet_4 =</span> <span class="fu">c</span>(</span>
<span id="cb51-5"><a href="#cb51-5"></a>   mean_diet_4_separate, mean_diet_4_pooled, mean_diet_4_hierarchical</span>
<span id="cb51-6"><a href="#cb51-6"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'mean_diet_4_separate' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>predicted_weight_diet_4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb53-2"><a href="#cb53-2"></a>  <span class="at">model_name =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Separate"</span>, <span class="st">"Pooled"</span>, <span class="st">"Hierarchical"</span>),</span>
<span id="cb53-3"><a href="#cb53-3"></a>              <span class="at">each =</span> ndraws),</span>
<span id="cb53-4"><a href="#cb53-4"></a>  <span class="at">predicted_weight =</span> <span class="fu">c</span>(</span>
<span id="cb53-5"><a href="#cb53-5"></a>   <span class="fu">extract_variable</span>(fit_separate, <span class="st">"weight_pred"</span>),</span>
<span id="cb53-6"><a href="#cb53-6"></a>   <span class="fu">extract_variable</span>(fit_pooled, <span class="st">"weight_pred"</span>),</span>
<span id="cb53-7"><a href="#cb53-7"></a>   <span class="fu">extract_variable</span>(fit_hierarchical, <span class="st">"weight_pred"</span>)</span>
<span id="cb53-8"><a href="#cb53-8"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: No chains finished successfully. Unable to retrieve the draws.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Collect posterior draws and the model used to a long data frame.</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>posterior_mean_diet_5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb55-3"><a href="#cb55-3"></a>  <span class="at">model_name =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Separate"</span>, <span class="st">"Pooled"</span>, <span class="st">"Hierarchical"</span>),</span>
<span id="cb55-4"><a href="#cb55-4"></a>    <span class="at">each =</span> ndraws</span>
<span id="cb55-5"><a href="#cb55-5"></a>  ),</span>
<span id="cb55-6"><a href="#cb55-6"></a>  <span class="at">mean_diet_5 =</span> <span class="fu">c</span>(</span>
<span id="cb55-7"><a href="#cb55-7"></a>    <span class="fu">extract_variable</span>(fit_separate, <span class="st">"mean_five"</span>),</span>
<span id="cb55-8"><a href="#cb55-8"></a>    <span class="fu">extract_variable</span>(fit_pooled, <span class="st">"mean_five"</span>),</span>
<span id="cb55-9"><a href="#cb55-9"></a>    <span class="fu">extract_variable</span>(fit_hierarchical, <span class="st">"mean_five"</span>)</span>
<span id="cb55-10"><a href="#cb55-10"></a>  )</span>
<span id="cb55-11"><a href="#cb55-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: No chains finished successfully. Unable to retrieve the draws.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># Mean observed weight per diet, these help to compare the posteriors to data.</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>diet_means <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb57-3"><a href="#cb57-3"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(diet) <span class="fu">mean</span>(Chick12[Chick12<span class="sc">$</span>Diet <span class="sc">==</span> diet, <span class="st">"weight"</span>])</span>
<span id="cb57-4"><a href="#cb57-4"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<section id="all-models" class="level3 callout-body-container callout-body" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="all-models"><span class="header-section-number">2.4.1</span> All models</h3>
<ul>
<li>Is there a related Stan implementation?
<ul>
<li>No Stan model implemented</li>
<li>Stan model implemented, but it seems clearly wrong or broken</li>
<li>Seemingly valid Stan model implemented</li>
</ul></li>
</ul>
</section>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.m">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.m
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use the provided code in the template to plot the <strong>posterior distribution of the mean of the weight measurements of the fourth diet</strong> and comment on the possible differences you observe between the models.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="fu">ggplot</span>(posterior_mean_diet_4, <span class="fu">aes</span>(<span class="at">x =</span> mean_diet_4, <span class="at">y =</span> model_name)) <span class="sc">+</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>  <span class="fu">stat_dotsinterval</span>(<span class="at">quantiles =</span> <span class="dv">100</span>, <span class="at">scale =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb58-3"><a href="#cb58-3"></a>  <span class="fu">vline_at</span>(diet_means[<span class="dv">4</span>], <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4"></a>  <span class="co"># Annotate the vline from above.</span></span>
<span id="cb58-5"><a href="#cb58-5"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Observation mean"</span>, <span class="at">x =</span> diet_means[<span class="dv">4</span>] <span class="sc">-</span> <span class="dv">5</span>, <span class="at">y =</span> .<span class="dv">7</span>,</span>
<span id="cb58-6"><a href="#cb58-6"></a>           <span class="at">hjust =</span> <span class="st">"right"</span>, <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7"></a>  <span class="co"># Add title and axis labels. One line to make everything so much more clear!</span></span>
<span id="cb58-8"><a href="#cb58-8"></a>  <span class="fu">labs</span>(</span>
<span id="cb58-9"><a href="#cb58-9"></a>    <span class="at">title =</span> <span class="st">"Mean of diet 4"</span>,</span>
<span id="cb58-10"><a href="#cb58-10"></a>    <span class="at">x =</span> <span class="st">"Weight (g)"</span>,</span>
<span id="cb58-11"><a href="#cb58-11"></a>    <span class="at">y =</span> <span class="st">"Model"</span></span>
<span id="cb58-12"><a href="#cb58-12"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'posterior_mean_diet_4' not found</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Is there a comparison plotted for the posteriors of the mean of diet 4? Does it look something like the model solution plot?
<ul>
<li>No comparison plotted</li>
<li>Comparison plotted but it clearly differs from the example</li>
<li>Comparison plotted and it approximately matches the example</li>
</ul></li>
<li>Separate model: Is the result for the separate model discussed?
<ul>
<li>The result is not discussed.</li>
<li>There is some discussion, but it is not mentioned that .</li>
<li>The result is discussed and the separate model is recognised as .</li>
</ul></li>
<li>Pooled model: Is the result for the pooled model discussed?
<ul>
<li>The result is not discussed.</li>
<li>There is some discussion, but it is not mentioned that .</li>
<li>The result is discussed and the pooled model is recognised as .</li>
</ul></li>
<li>Hierarchical model: Is the result for the hierarchical model discussed?
<ul>
<li>The result is not discussed.</li>
<li>There is some discussion, but it is not mentioned that .</li>
<li>The result is discussed and the hierarchical model is recognised as .</li>
</ul></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.n">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.n
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use the provided code in the template to plot the <strong>predictive distribution for another weight measurement from a chick having the fourth diet</strong> and comment on the possible differences you observe between the models.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="fu">ggplot</span>(predicted_weight_diet_4, <span class="fu">aes</span>(<span class="at">x =</span> predicted_weight, <span class="at">y =</span> model_name)) <span class="sc">+</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>  <span class="fu">stat_dotsinterval</span>(<span class="at">quantiles =</span> <span class="dv">100</span>, <span class="at">scale =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="fu">vline_at</span>(diet_means[<span class="dv">4</span>], <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb60-4"><a href="#cb60-4"></a>  <span class="co"># Annotate the vline from above.</span></span>
<span id="cb60-5"><a href="#cb60-5"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Observation mean"</span>, <span class="at">x =</span> diet_means[<span class="dv">4</span>] <span class="sc">-</span> <span class="dv">5</span>, <span class="at">y =</span> .<span class="dv">7</span>,</span>
<span id="cb60-6"><a href="#cb60-6"></a>           <span class="at">hjust =</span> <span class="st">"right"</span>, <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7"></a>  <span class="co"># Add title and axis labels. One line to make everything so much more clear!</span></span>
<span id="cb60-8"><a href="#cb60-8"></a>  <span class="fu">labs</span>(</span>
<span id="cb60-9"><a href="#cb60-9"></a>    <span class="at">title =</span> <span class="st">"Weigth of a chick with diet 4"</span>,</span>
<span id="cb60-10"><a href="#cb60-10"></a>    <span class="at">x =</span> <span class="st">"Weight (g)"</span>,</span>
<span id="cb60-11"><a href="#cb60-11"></a>    <span class="at">y =</span> <span class="st">"Model"</span></span>
<span id="cb60-12"><a href="#cb60-12"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'predicted_weight_diet_4' not found</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Is there a comparison plotted for the predictive distributions of the weight of a chick with diet 4? Does it look something like the model solution plot?
<ul>
<li>No comparison plotted</li>
<li>Comparison plotted but it clearly differs from the example</li>
<li>Comparison plotted and it approximately matches the example</li>
</ul></li>
<li>Separate model: Is the result for the separate model discussed?
<ul>
<li>The result is not discussed.</li>
<li>There is some discussion, but it is not mentioned that .</li>
<li>The result is discussed and the separate model is recognised as .</li>
</ul></li>
<li>Pooled model: Is the result for the pooled model discussed?
<ul>
<li>The result is not discussed.</li>
<li>There is some discussion, but it is not mentioned that .</li>
<li>The result is discussed and the pooled model is recognised as .</li>
</ul></li>
<li>Hierarchical model: Is the result for the hierarchical model discussed?
<ul>
<li>The result is not discussed.</li>
<li>There is some discussion, but it is not mentioned that .</li>
<li>The result is discussed and the hierarchical model is recognised as .</li>
</ul></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.o">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.o
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use the provided code in the template to plot the <strong>posterior distribution of the mean of the weight measurements of a new fifth diet</strong> and comment on the possible differences you observe between the models.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="fu">ggplot</span>(posterior_mean_diet_5, <span class="fu">aes</span>(<span class="at">x =</span> mean_diet_5, <span class="at">y =</span> model_name)) <span class="sc">+</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>  <span class="co"># Draw the mean of each diet from the data as a dashed vertical line.</span></span>
<span id="cb62-3"><a href="#cb62-3"></a>  <span class="fu">vline_at</span>(diet_means, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb62-4"><a href="#cb62-4"></a>  <span class="co"># dotsinterval gives mean, 50%, and 90% intervals + dotsplot with each dot</span></span>
<span id="cb62-5"><a href="#cb62-5"></a>  <span class="co"># representing 1% of data (quantiles = 100).</span></span>
<span id="cb62-6"><a href="#cb62-6"></a>  <span class="fu">stat_dotsinterval</span>(<span class="at">quantiles =</span> <span class="dv">100</span>, <span class="at">scale =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb62-7"><a href="#cb62-7"></a>  <span class="co"># Annotate the vline from above.</span></span>
<span id="cb62-8"><a href="#cb62-8"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Means of observed diets"</span>, <span class="at">y =</span> .<span class="dv">7</span>, <span class="at">x =</span> <span class="dv">100</span>,</span>
<span id="cb62-9"><a href="#cb62-9"></a>           <span class="at">hjust =</span> <span class="st">"right"</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">family =</span> <span class="st">"sans"</span>) <span class="sc">+</span></span>
<span id="cb62-10"><a href="#cb62-10"></a>  <span class="co"># Add title and axis labels. One line to make everything so much more clear!</span></span>
<span id="cb62-11"><a href="#cb62-11"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mean of a new diet"</span>,</span>
<span id="cb62-12"><a href="#cb62-12"></a>       <span class="at">x =</span> <span class="st">"Weight (g)"</span>,</span>
<span id="cb62-13"><a href="#cb62-13"></a>       <span class="at">y =</span> <span class="st">"Model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'posterior_mean_diet_5' not found</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Is there a comparison plotted for the posterior distributions of the mean weight with a new diet? Does it look something like the model solution plot?
<ul>
<li>No comparison plotted</li>
<li>Comparison plotted but it clearly differs from the example</li>
<li>Comparison plotted and it approximately matches the example</li>
</ul></li>
<li>Separate model: Is the result for the separate model discussed?
<ul>
<li>The result is not discussed.</li>
<li>There is some discussion, but it is not mentioned that .</li>
<li>The result is discussed and the separate model is recognised as .</li>
<li>In addition to the previous option, it is recognised that .</li>
</ul></li>
<li>Pooled model: Is the result for the pooled model discussed?
<ul>
<li>The result is not discussed.</li>
<li>There is some discussion, but it is not mentioned that .</li>
<li>The result is discussed and the pooled model is recognised as .</li>
<li>In addition to the previous option, it is mentioned that .</li>
</ul></li>
<li>Hierarchical model: Is the result for the hierarchical model discussed?
<ul>
<li>The result is not discussed.</li>
<li>There is some discussion, but it is not mentioned that .</li>
<li>The result is discussed and the hierarchical model is recognised as .</li>
</ul></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 2.p">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 2.p
</div>
</div>
<div class="callout-body-container callout-body">
<p>For each model, report the <strong>posterior expectation for the mean weight of diet 4 with a 90% credible interval</strong>.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-49-contents" aria-controls="callout-49" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-49" class="callout-49-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>See the example Stan codes in the demo <a href="http://avehtari.github.io/BDA_R_demos/demos_rstan/cmdstanr_demo.html#8_Comparison_of_(k)_groups_with_hierarchical_models">Bayesian data analysis - CmdStanR demos: Comparison of <span class="math inline">\(k\)</span> groups with hierarchical models</a> for the comparison of <span class="math inline">\(k\)</span> groups with and without the hierarchical structure.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>For the separate model, is the posterior 90% credible interval for the mean of the fourth diet close to: (small/medium deviation is fine).
<ul>
<li>No or incorrect answer</li>
<li>Answer is only partially correct</li>
<li>Answers look correct</li>
</ul></li>
<li>For the pooled model, is the posterior 90% credible interval for the mean of the fourth diet close to: (small/medium deviation is fine).
<ul>
<li>No answer</li>
<li>Answer is only partially correct</li>
<li>Answer looks correct</li>
</ul></li>
<li>For the hierarchical model, is the posterior 90% credible interval for the mean of the fourth diet close to: (small/medium deviation is fine).
<ul>
<li>No answer</li>
<li>Answer is only partially correct.</li>
<li>Answers look correct.</li>
</ul></li>
</ul>
</div>
</div>
</section>
</section>
<section id="hierarchical-model-with-brms-3p" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Hierarchical model with BRMS (3p)</h1>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>We have made changes to the assignment text and some of the rubrics to make it clearer.</p>
</div>
</div>
<p>The goal of this task is to discuss an alternative parameterisation of hierarchical models and introduce the <code>brms</code>-package.</p>
<p><a href="https://paul-buerkner.github.io/brms/"><code>brms</code></a> is a high-level interface for Stan providing tools to create a wide range of Bayesian models, including hierarchical ones. In the previous section, you might have noted that with the hierarchical implementation of the model there may be divergent transitions during the sampling from the posterior. This is related to <a href="https://mc-stan.org/docs/stan-users-guide/reparameterization.html">Neal’s funnel</a>, where the sampling algorithm would need to change the step size in order to effectively sample the posterior. One trick to improve sampling is to use an alternative parameterisation for the model. This parameterisation is called the non-centered parameterisation (<a href="#eq-non-centered" class="quarto-xref">Equation&nbsp;3</a>) and often it can help with the divergent transitions.</p>
<p>In short, we sample parameters from a distribution with a potentially easier geometry for the sampler to explore efficiently and then transform those values to the joint distribution of interest.</p>
<p>The noncentered parameterisation for the hierarchical model using the diet-wise helper parameter <span class="math inline">\(z_d\)</span> becomes</p>
<p><span id="eq-non-centered"><span class="math display">\[
\begin{aligned}
z_d &amp;\sim \operatorname{normal}(0, 1)&amp;&amp;\text{(diet-wise helper parameter)},\\
\mu_d &amp;= \mu + z_d \tau&amp;&amp;\text{(diet-wise mean weight)},\\
\mu &amp;\sim \pi(\mu)&amp;&amp;\text{(mean of prior for diet-wise mean weights),}\\
\tau &amp;\sim \pi(\tau)&amp;&amp;\text{(standard deviation of prior for diet-wise mean weights),}\\
\sigma &amp;\sim \pi(\sigma)&amp;&amp;\text{(standard deviation of diet-wise chicken weights) and},\\
w_{i, d} &amp;\sim \operatorname{normal}(\mu_d, \sigma)&amp;&amp;\text{(chicken weights)}.\\
\end{aligned}
\tag{3}\]</span></span></p>
<p>The hierarchical models made with <code>brms</code> use this non-centered parameterisation. Your tasks are the following:</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 3.a)">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 3.a)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use the function in the template to make a scatter plot of the posterior draws given the hierarchical model of the population level standard deviation parameter <span class="math inline">\(\tau\)</span> and the mean parameter of the fourth diet, <span class="math inline">\(\mu_4\)</span>. The possible divergent transitions are highlighted in red. In the report show the plot and comment if there are any divergent transitions.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_scatter</span>(<span class="at">x =</span> fit_hierarchical<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"mean_diet[4]"</span>, <span class="st">"sd_diets"</span>)),</span>
<span id="cb64-2"><a href="#cb64-2"></a>                        <span class="at">np =</span> <span class="fu">nuts_params</span>(fit_hierarchical)) <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(mean_diet[<span class="dv">4</span>]), <span class="at">y =</span> <span class="fu">expression</span>(sd_diets)) <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: No chains finished successfully. Unable to retrieve the draws.</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Is there a scatter plot of <span class="math inline">\(\sigma_0\)</span> and <span class="math inline">\(\mu_4\)</span> and some comments provided in the report?
<ul>
<li>No scatter plot or comments</li>
<li>The scatter plot is included, and divergent transitions are visible, but not commented on.</li>
<li>The scatter plot and comments on the divergences are included.</li>
</ul></li>
</ul>
</div>
</div>
<p>To sample from the posterior given the same model using <code>brms</code>, in the template set the weakly informative priors for the hierarchical model you used in the previous task. <code>brms</code> has an internal convention to name model parameters and the parameter names from <a href="#eq-non-centered" class="quarto-xref">Equation&nbsp;3</a> map into <code>brms</code> names with the following logic:</p>
<ul>
<li><span class="math inline">\(\mu\)</span> corresponds to <code>class="Intercept"</code></li>
<li><span class="math inline">\(\tau\)</span> corresponds to <code>class="sd"</code>,</li>
<li><span class="math inline">\(\sigma\)</span> corresponds to <code>class="sigma"</code>.</li>
</ul>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 3.b">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 3.b
</div>
</div>
<div class="callout-body-container callout-body">
<p>Replace <code>normal(0,10)</code> in the <code>brm</code> call in the template with your prior for the population mean <span class="math display">\[\mu \sim \pi(\mu) = N(\mu_0,\sigma_0)\]</span> you have derived in 2). Then, run the code chunk to sample from the posterior of the hierarchical model using <code>brms</code>.</p>
</div>
</div>
<p><strong>Create a brms model and sample from the posterior</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>brms_fit <span class="ot">=</span> <span class="fu">brm</span>(</span>
<span id="cb66-2"><a href="#cb66-2"></a>  weight <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Diet),</span>
<span id="cb66-3"><a href="#cb66-3"></a>  <span class="at">data=</span>Chick12,</span>
<span id="cb66-4"><a href="#cb66-4"></a>  <span class="at">prior=</span><span class="fu">c</span>(</span>
<span id="cb66-5"><a href="#cb66-5"></a>    <span class="co"># REPLACE WITH YOUR PRIOR DERIVED in 2)</span></span>
<span id="cb66-6"><a href="#cb66-6"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">class=</span><span class="st">"Intercept"</span>),</span>
<span id="cb66-7"><a href="#cb66-7"></a>    <span class="co"># YOU CAN LEAVE THE BELOW PRIORS</span></span>
<span id="cb66-8"><a href="#cb66-8"></a>    <span class="fu">prior</span>(<span class="fu">exponential</span>(.<span class="dv">02</span>), <span class="at">class=</span><span class="st">"sd"</span>),</span>
<span id="cb66-9"><a href="#cb66-9"></a>    <span class="fu">prior</span>(<span class="fu">exponential</span>(.<span class="dv">02</span>), <span class="at">class=</span><span class="st">"sigma"</span>)</span>
<span id="cb66-10"><a href="#cb66-10"></a>  ),</span>
<span id="cb66-11"><a href="#cb66-11"></a>  <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb66-12"><a href="#cb66-12"></a>  <span class="at">save_pars =</span> <span class="fu">save_pars</span>(<span class="at">manual =</span> <span class="fu">c</span>(<span class="st">"z_1[1,4]"</span>))</span>
<span id="cb66-13"><a href="#cb66-13"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Is the <code>brms</code> code shown and do the priors agree with the priors specified above?</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 3.c">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 3.c
</div>
</div>
<div class="callout-body-container callout-body">
<p>Report the <strong>posterior expectation for the mean weight of diet 4 <span class="math inline">\(\mu_4\)</span> with a 90% credible interval</strong>, using the code block in the template. How does it compare with your results from the first task?</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># Draws for mu_4</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>mu_4 <span class="ot">=</span> <span class="fu">posterior_epred</span>(brms_fit, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">Diet=</span><span class="dv">4</span>))</span>
<span id="cb67-3"><a href="#cb67-3"></a></span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="co"># Compute the mean, and quantiles. Remember to round your answers accordingly.</span></span>
<span id="cb67-5"><a href="#cb67-5"></a><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Given the <code>brms</code> model, is the posterior 90% credible interval for the mean of the fourth diet close to: (small/medium deviation is fine).
<ul>
<li>No answer</li>
<li>Answer is only partially correct.</li>
<li>Answers look correct.</li>
</ul></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 3.d">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 3.d
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use the code in the template to make a <strong>scatter plot of the group standard deviation parameter <span class="math inline">\(\tau\)</span> and group specific mean parameter</strong>.</p>
</div>
</div>
<p>Due the non-centered parametrization, we need to transform compute the <span class="math inline">\(\mu_d\)</span> term as the sum of the population intercept and the group specific deviation from the intercept. You can choose which diet to plot by modifying the <code>d</code> integer in <code>r_Diet[d,Intercept]</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>draws <span class="ot">=</span> <span class="fu">as_draws_df</span>(brms_fit) <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>  posterior<span class="sc">::</span><span class="fu">mutate_variables</span>(<span class="at">mean_diet_4 =</span> <span class="st">`</span><span class="at">r_Diet[4,Intercept]</span><span class="st">`</span> <span class="sc">+</span> b_Intercept)</span>
<span id="cb68-3"><a href="#cb68-3"></a></span>
<span id="cb68-4"><a href="#cb68-4"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_scatter</span>(draws,</span>
<span id="cb68-5"><a href="#cb68-5"></a>                        <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"mean_diet_4"</span>, <span class="st">"sd_Diet__Intercept"</span>),</span>
<span id="cb68-6"><a href="#cb68-6"></a>                        <span class="at">np =</span> <span class="fu">nuts_params</span>(brms_fit)) <span class="sc">+</span></span>
<span id="cb68-7"><a href="#cb68-7"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb68-8"><a href="#cb68-8"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(mean_diet[<span class="dv">4</span>])) <span class="sc">+</span></span>
<span id="cb68-9"><a href="#cb68-9"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(sd_diets))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="assignment7_files/figure-html/plot scatter non-centered parameterisation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Is there a scatter plot of <span class="math inline">\(\tau\)</span> and <span class="math inline">\(\mu_4\)</span> and some comments provided in the report?
<ul>
<li>No scatter plot or comments</li>
<li>The scatter plot is included, and divergent transitions are visible, but not commented on.</li>
<li>The scatter plot and comments on the divergences are included.</li>
</ul></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled" title="Subtask 3.e">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subtask 3.e
</div>
</div>
<div class="callout-body-container callout-body">
<p>In your report, address the following questions based on the plots you made for both parameterisations:</p>
<ul>
<li>Which of the parameterisations resulted in fewer divergent transitions?</li>
<li>Comment for both parameterisations: for which kind of values of <span class="math inline">\(\tau\)</span>, do the divergent transitions occur (if there are any)? It also might be that no clear pattern can be seen.</li>
<li>Does centered parameterisation have problems sampling from some specific region of the parameter space compared to the non-centered parameterisation.</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Has it been discussed which parameterisation resulted in fewer divergent transitions?</li>
<li>Has it been discussed for which values of <span class="math inline">\(\tau\)</span> the divergences occurred?</li>
<li>Has it been discussed whether/where the centered parameterisation has problems sampling?</li>
</ul>
</div>
</div>
</section>
<section id="overall-quality-of-the-report" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Overall quality of the report</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Rubric">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rubric
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Does the report include comment on whether AI was used, and if AI was used, explanation on how it was used?
<ul>
<li>No</li>
<li>Yes</li>
</ul></li>
<li>Does the report follow the formatting instructions?
<ul>
<li>Not at all</li>
<li>Little</li>
<li>Mostly</li>
<li>Yes</li>
</ul></li>
<li>In case the report doesn’t fully follow the general and formatting instructions, specify the instructions that have not been followed. If applicable, specify the page of the report, where this difference is visible. This will help the other student to improve their reports so that they are easier to read and review. If applicable, specify the page of the report, where this difference in formatting is visible.</li>
<li>Please also provide feedback on the presentation (e.g.&nbsp;text, layout, flow of the responses, figures, figure captions). Part of the course is practicing making data analysis reports. By providing feedback on the report presentation, other students can learn what they can improve or what they already did well. You should be able to provide constructive or positive feedback for all non-empty and non-nonsense reports. If you think the report is perfect, and you can’t come up with any suggestions how to improve, you can provide feedback on what you liked and why you think some part of the report is better than yours.</li>
</ul>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./assignment6.html" class="pagination-link" aria-label="Assignment 6, 2023">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Assignment 6, 2023</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./assignment8.html" class="pagination-link" aria-label="Assignment 8, 2023">
        <span class="nav-page-text">Assignment 8, 2023</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb69" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb69-1"><a href="#cb69-1"></a><span class="co">---</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="an">title:</span><span class="co"> "Assignment 7, 2023"</span></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="an">subtitle:</span><span class="co"> "Hierarchical model in Stan"</span></span>
<span id="cb69-4"><a href="#cb69-4"></a><span class="an">author:</span><span class="co"> "Aki Vehtari et al."</span></span>
<span id="cb69-5"><a href="#cb69-5"></a><span class="an">format:</span></span>
<span id="cb69-6"><a href="#cb69-6"></a><span class="co">  html:</span></span>
<span id="cb69-7"><a href="#cb69-7"></a><span class="co">    toc: true</span></span>
<span id="cb69-8"><a href="#cb69-8"></a><span class="co">    code-tools: true</span></span>
<span id="cb69-9"><a href="#cb69-9"></a><span class="co">    code-line-numbers: true</span></span>
<span id="cb69-10"><a href="#cb69-10"></a><span class="co">    number-sections: true</span></span>
<span id="cb69-11"><a href="#cb69-11"></a><span class="co">    mainfont: Georgia, serif</span></span>
<span id="cb69-12"><a href="#cb69-12"></a><span class="co">    page-layout: article</span></span>
<span id="cb69-13"><a href="#cb69-13"></a><span class="co">  pdf:</span></span>
<span id="cb69-14"><a href="#cb69-14"></a><span class="co">    geometry:</span></span>
<span id="cb69-15"><a href="#cb69-15"></a><span class="co">    - left=1cm,top=1cm,bottom=1cm,right=7cm</span></span>
<span id="cb69-16"><a href="#cb69-16"></a><span class="co">    number-sections: true</span></span>
<span id="cb69-17"><a href="#cb69-17"></a><span class="co">    code-annotations: none</span></span>
<span id="cb69-18"><a href="#cb69-18"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb69-19"><a href="#cb69-19"></a><span class="an">assignments:</span><span class="co"> ta</span></span>
<span id="cb69-20"><a href="#cb69-20"></a><span class="co">---</span></span>
<span id="cb69-21"><a href="#cb69-21"></a></span>
<span id="cb69-22"><a href="#cb69-22"></a>::::{.content-visible when-profile="public"}</span>
<span id="cb69-23"><a href="#cb69-23"></a></span>
<span id="cb69-24"><a href="#cb69-24"></a>:::{.callout-warning}</span>
<span id="cb69-25"><a href="#cb69-25"></a></span>
<span id="cb69-26"><a href="#cb69-26"></a>Currently, rendering on github is broken, such that the rendered template at <span class="co">[</span><span class="ot">https://avehtari.github.io/BDA_course_Aalto/assignments/template7.html</span><span class="co">](https://avehtari.github.io/BDA_course_Aalto/assignments/template7.html)</span></span>
<span id="cb69-27"><a href="#cb69-27"></a>looks weird. Rendering should however work on Aalto's JupyterLab, but we will also try to fix rendering on github ASAP.</span>
<span id="cb69-28"><a href="#cb69-28"></a></span>
<span id="cb69-29"><a href="#cb69-29"></a>:::</span>
<span id="cb69-30"><a href="#cb69-30"></a></span>
<span id="cb69-31"><a href="#cb69-31"></a>::::</span>
<span id="cb69-32"><a href="#cb69-32"></a></span>
<span id="cb69-33"><a href="#cb69-33"></a><span class="fu"># General information</span></span>
<span id="cb69-34"><a href="#cb69-34"></a></span>
<span id="cb69-35"><a href="#cb69-35"></a>**This is for BDA 2023**</span>
<span id="cb69-36"><a href="#cb69-36"></a></span>
<span id="cb69-37"><a href="#cb69-37"></a>**The maximum amount of points from this assignment is 9.**</span>
<span id="cb69-38"><a href="#cb69-38"></a></span>
<span id="cb69-39"><a href="#cb69-39"></a>We have prepared a **quarto template specific to this assignment ([html](template7.html), [qmd](https://avehtari.github.io/BDA_course_Aalto/assignments/template7.qmd), [pdf](template7.pdf))** to help you get started.</span>
<span id="cb69-40"><a href="#cb69-40"></a></span>
<span id="cb69-41"><a href="#cb69-41"></a>:::{.callout-warning icon=false title="Setup" collapse=true}</span>
<span id="cb69-42"><a href="#cb69-42"></a>We recommend Aalto students use <span class="co">[</span><span class="ot">jupyter.cs.aalto.fi</span><span class="co">](https://jupyter.cs.aalto.fi)</span>, for all others we also provide a <span class="co">[</span><span class="ot">docker container</span><span class="co">](docker.html)</span>.</span>
<span id="cb69-43"><a href="#cb69-43"></a>:::</span>
<span id="cb69-44"><a href="#cb69-44"></a></span>
<span id="cb69-45"><a href="#cb69-45"></a>:::{.callout-tip collapse=false}</span>
<span id="cb69-46"><a href="#cb69-46"></a>**Reading instructions**:</span>
<span id="cb69-47"><a href="#cb69-47"></a></span>
<span id="cb69-48"><a href="#cb69-48"></a><span class="ss">- </span><span class="co">[</span><span class="ot">**The reading instructions for BDA3 Chapter 5**</span><span class="co">](../BDA3_notes.html#ch5)</span>.</span>
<span id="cb69-49"><a href="#cb69-49"></a></span>
<span id="cb69-50"><a href="#cb69-50"></a>{{&lt; include includes/_grading_instructions.md &gt;}}</span>
<span id="cb69-51"><a href="#cb69-51"></a></span>
<span id="cb69-52"><a href="#cb69-52"></a>{{&lt; include includes/_cmdstanr.md &gt;}}</span>
<span id="cb69-53"><a href="#cb69-53"></a>:::</span>
<span id="cb69-54"><a href="#cb69-54"></a></span>
<span id="cb69-55"><a href="#cb69-55"></a>{{&lt; include includes/_reporting_accuracy.md &gt;}}</span>
<span id="cb69-56"><a href="#cb69-56"></a></span>
<span id="cb69-57"><a href="#cb69-57"></a>{{&lt; include includes/_general_info.md &gt;}}</span>
<span id="cb69-58"><a href="#cb69-58"></a>:::{.content-visible when-profile="public"}</span>
<span id="cb69-59"><a href="#cb69-59"></a>This is the template for <span class="co">[</span><span class="ot">assignment 7</span><span class="co">](assignment7.html)</span>. You can download the <span class="co">[</span><span class="ot">separate model with bad priors</span><span class="co">](./additional_files/assignment7/chickens_separate.stan)</span> and the <span class="co">[</span><span class="ot">qmd-file</span><span class="co">](https://avehtari.github.io/BDA_course_Aalto/assignments/template7.qmd)</span> or copy the code from this rendered document after clicking on <span class="in">`&lt;/&gt; Code`</span> in the top right corner.</span>
<span id="cb69-60"><a href="#cb69-60"></a></span>
<span id="cb69-61"><a href="#cb69-61"></a>**Please replace the instructions in this template by your own text, explaining what you are doing in each exercise.**</span>
<span id="cb69-62"><a href="#cb69-62"></a>:::</span>
<span id="cb69-63"><a href="#cb69-63"></a></span>
<span id="cb69-64"><a href="#cb69-64"></a>:::{.callout-tip collapse=true}</span>
<span id="cb69-65"><a href="#cb69-65"></a><span class="fu">## Setup</span></span>
<span id="cb69-66"><a href="#cb69-66"></a>The following loads several needed packages:</span>
<span id="cb69-67"><a href="#cb69-67"></a></span>
<span id="cb69-70"><a href="#cb69-70"></a><span class="in">```{r}</span></span>
<span id="cb69-71"><a href="#cb69-71"></a><span class="co">#| label: imports</span></span>
<span id="cb69-72"><a href="#cb69-72"></a></span>
<span id="cb69-73"><a href="#cb69-73"></a><span class="fu">library</span>(aaltobda)</span>
<span id="cb69-74"><a href="#cb69-74"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb69-75"><a href="#cb69-75"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb69-76"><a href="#cb69-76"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb69-77"><a href="#cb69-77"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb69-78"><a href="#cb69-78"></a><span class="fu">library</span>(ggdist) <span class="co"># for stat_dotsinterval</span></span>
<span id="cb69-79"><a href="#cb69-79"></a><span class="fu">library</span>(posterior)</span>
<span id="cb69-80"><a href="#cb69-80"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(brms)){</span>
<span id="cb69-81"><a href="#cb69-81"></a>    <span class="fu">install.packages</span>(<span class="st">"brms"</span>)</span>
<span id="cb69-82"><a href="#cb69-82"></a>    <span class="fu">library</span>(brms)</span>
<span id="cb69-83"><a href="#cb69-83"></a>}</span>
<span id="cb69-84"><a href="#cb69-84"></a></span>
<span id="cb69-85"><a href="#cb69-85"></a><span class="co"># Set more readable themes with bigger font for plotting packages.</span></span>
<span id="cb69-86"><a href="#cb69-86"></a>ggplot2<span class="sc">::</span><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>))</span>
<span id="cb69-87"><a href="#cb69-87"></a>bayesplot<span class="sc">::</span><span class="fu">bayesplot_theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>))</span>
<span id="cb69-88"><a href="#cb69-88"></a></span>
<span id="cb69-89"><a href="#cb69-89"></a><span class="co"># This registers CmdStan as the backend for compiling cmdstan-chunks.</span></span>
<span id="cb69-90"><a href="#cb69-90"></a><span class="fu">check_cmdstan_toolchain</span>(<span class="at">fix =</span> <span class="cn">TRUE</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-91"><a href="#cb69-91"></a><span class="fu">register_knitr_engine</span>(<span class="at">override =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-92"><a href="#cb69-92"></a><span class="in">```</span></span>
<span id="cb69-93"><a href="#cb69-93"></a>:::</span>
<span id="cb69-94"><a href="#cb69-94"></a></span>
<span id="cb69-95"><a href="#cb69-95"></a><span class="fu"># Hierarchical Model: Chicken Data with Stan (6p)</span></span>
<span id="cb69-96"><a href="#cb69-96"></a></span>
<span id="cb69-97"><a href="#cb69-97"></a>**Do not look at the secret dataset until you have defined your priors in section 2.1.**</span>
<span id="cb69-98"><a href="#cb69-98"></a></span>
<span id="cb69-99"><a href="#cb69-99"></a>A secret dataset, included in base <span class="in">`r`</span>, contains weight measurements from 50 chicks from their birth until the age of 21 days. For this task, we are interested in modeling the weight of a chick at the age of 12 days.</span>
<span id="cb69-100"><a href="#cb69-100"></a></span>
<span id="cb69-101"><a href="#cb69-101"></a><span class="fu">## Choosing a weakly informative prior by intuition</span></span>
<span id="cb69-102"><a href="#cb69-102"></a></span>
<span id="cb69-103"><a href="#cb69-103"></a>We will first guide you through two processes for choosing *weakly* informative priors which you can use in your projects as well (though, if expert knowledge is present, we encourage to use that though instead). Many definitions of *weak* exist, but for our purposes, we intend to set priors in this assignment which don't overwhelm the likelihood contributions to the posterior while still exerting some amount of regularisation.</span>
<span id="cb69-104"><a href="#cb69-104"></a></span>
<span id="cb69-105"><a href="#cb69-105"></a>In the absence of additional information, we will assume that chick weights at 12 days of age ($w$) follow a normal distribution:</span>
<span id="cb69-106"><a href="#cb69-106"></a>$$</span>
<span id="cb69-107"><a href="#cb69-107"></a>w\sim\mathcal N (\mu,\sigma).</span>
<span id="cb69-108"><a href="#cb69-108"></a>$$</span>
<span id="cb69-109"><a href="#cb69-109"></a>Our task will be to define weakly informative priors for the mean $\mu$ given observation model standard deviation, $\sigma$ (a prior distribution for $\sigma$ will be set in after section 2).</span>
<span id="cb69-110"><a href="#cb69-110"></a></span>
<span id="cb69-111"><a href="#cb69-111"></a>Here, $\mu$ represents the population mean chick weight at 12 days and $\sigma$ represents the standard-deviation of the chick weights $w$ around that population mean. For this exercise, we will be specifying a normal prior for $\mu$:</span>
<span id="cb69-112"><a href="#cb69-112"></a></span>
<span id="cb69-113"><a href="#cb69-113"></a>$$</span>
<span id="cb69-114"><a href="#cb69-114"></a>\mu\sim\mathcal N (\mu_0,\sigma_0).</span>
<span id="cb69-115"><a href="#cb69-115"></a>$$</span>
<span id="cb69-116"><a href="#cb69-116"></a></span>
<span id="cb69-117"><a href="#cb69-117"></a>$\mu_0$ represents our prior knowledge of what we believe the population weight to be and $\sigma_0$ represents our level of certainty in this belief. To specify a weakly-informative prior for $\mu$ we need to select values of $\mu_0$ and $\sigma_0$ that imply the range of plausible values that $\mu$ could take.</span>
<span id="cb69-118"><a href="#cb69-118"></a></span>
<span id="cb69-119"><a href="#cb69-119"></a>We can do this by our own intuitive prior knowledge (if such intuition exists), or by searching for external references.</span>
<span id="cb69-120"><a href="#cb69-120"></a></span>
<span id="cb69-121"><a href="#cb69-121"></a>Despite the name, weakly informed priors can be quite subjective (<span class="co">[</span><span class="ot">see for more theoretical discussion here</span><span class="co">](http://www.stat.columbia.edu/~gelman/research/published/entropy-19-00555-v2.pdf)</span>), such that some justification is always needed. For the subtasks below, you will not be graded on the accuracy or precision of your numbers, but on your justification of them. The numerical choices you make should make sense and be understandable to an external reviewer of your work (even if they may not agree with your choices).</span>
<span id="cb69-122"><a href="#cb69-122"></a></span>
<span id="cb69-123"><a href="#cb69-123"></a></span>
<span id="cb69-124"><a href="#cb69-124"></a>::: {.callout-caution collapse="false"}</span>
<span id="cb69-125"><a href="#cb69-125"></a><span class="fu">## A word of caution on eliciting the priors below</span></span>
<span id="cb69-126"><a href="#cb69-126"></a>Please note that in the below, we intend to set a prior on $\mu$ (the *mean* chick weight), but the intuition we ilicit is based on the weight of *individual* chicks. We do so to help create intuition about what the mean could be, however, it would be theoretically more accurate to ilicit priors about *mean* chick weights.</span>
<span id="cb69-127"><a href="#cb69-127"></a>:::</span>
<span id="cb69-128"><a href="#cb69-128"></a></span>
<span id="cb69-129"><a href="#cb69-129"></a>:::{.callout-important}</span>
<span id="cb69-130"><a href="#cb69-130"></a></span>
<span id="cb69-131"><a href="#cb69-131"></a>We have made changes to the assignment text and some of the rubrics to make it clearer.</span>
<span id="cb69-132"><a href="#cb69-132"></a></span>
<span id="cb69-133"><a href="#cb69-133"></a>:::</span>
<span id="cb69-134"><a href="#cb69-134"></a></span>
<span id="cb69-135"><a href="#cb69-135"></a></span>
<span id="cb69-136"><a href="#cb69-136"></a>:::{.callout-warning icon=false title="Subtask 2.a)"}</span>
<span id="cb69-137"><a href="#cb69-137"></a>Based on your own past experience and estimation skills, what would you guess is a typical weight range of a fully grown chicken in grams? Justify your choice with 1-3 sentences.</span>
<span id="cb69-138"><a href="#cb69-138"></a>:::</span>
<span id="cb69-139"><a href="#cb69-139"></a></span>
<span id="cb69-140"><a href="#cb69-140"></a>:::{.callout-tip collapse=false}</span>
<span id="cb69-141"><a href="#cb69-141"></a>Would it make sense if a chicken weighed 1 million grams? 0.005 grams? What about a chicken that weighed more than you? More than a car? Note that is not important to have a very precise or accurate guess here, the key goal is simply to identify the range of plausible (or at least possible) values.</span>
<span id="cb69-142"><a href="#cb69-142"></a>:::</span>
<span id="cb69-143"><a href="#cb69-143"></a></span>
<span id="cb69-144"><a href="#cb69-144"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-145"><a href="#cb69-145"></a><span class="fu">### Fully grown chicken weight range by intuition</span></span>
<span id="cb69-146"><a href="#cb69-146"></a></span>
<span id="cb69-147"><a href="#cb69-147"></a><span class="ss">* </span>Does the chosen range meet the following common sense criteria?</span>
<span id="cb69-148"><a href="#cb69-148"></a><span class="ss">  * </span>The range is always above <span class="co">[</span><span class="ot">zero</span><span class="co">]</span>{.content-hidden when-profile="public"} and below <span class="co">[</span><span class="ot">the average weight of a human (~60-80kg)</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-149"><a href="#cb69-149"></a><span class="ss">* </span>Is the justification based on some sort of logic, even if you may disagree?</span>
<span id="cb69-150"><a href="#cb69-150"></a>::::</span>
<span id="cb69-151"><a href="#cb69-151"></a></span>
<span id="cb69-152"><a href="#cb69-152"></a>:::{.callout-warning icon=false title="Subtask 2.b"}</span>
<span id="cb69-153"><a href="#cb69-153"></a>Adjust this range for a 12-day old chick and choose a mean $\mu_0$ for the weakly informed prior of the parameter $\mu.$ Justify your adjustment and choice with 1-3 sentences.</span>
<span id="cb69-154"><a href="#cb69-154"></a>:::</span>
<span id="cb69-155"><a href="#cb69-155"></a></span>
<span id="cb69-156"><a href="#cb69-156"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-157"><a href="#cb69-157"></a><span class="fu">### 12-day old chick weight range by intuition</span></span>
<span id="cb69-158"><a href="#cb69-158"></a></span>
<span id="cb69-159"><a href="#cb69-159"></a><span class="ss">* </span>The range is always above <span class="co">[</span><span class="ot">zero</span><span class="co">]</span>{.content-hidden when-profile="public"} and below <span class="co">[</span><span class="ot">the weight of fully grown chickens stated above</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-160"><a href="#cb69-160"></a><span class="ss">* </span>Is the justification based on some sort of logic, even if you may disagree?</span>
<span id="cb69-161"><a href="#cb69-161"></a>::::</span>
<span id="cb69-162"><a href="#cb69-162"></a></span>
<span id="cb69-163"><a href="#cb69-163"></a>Choosing the prior standard deviation for $\mu$ requires a little more caution; overconfident (i.e. narrow) priors can have a strong effect on your results,</span>
<span id="cb69-164"><a href="#cb69-164"></a>whereas less confident priors are more easily overcome with observed data.</span>
<span id="cb69-165"><a href="#cb69-165"></a>Given that overconfidence is a common human bias, a good intuition-based standard deviation should focus on eliminating the impossible values, rather than including the most likely values.</span>
<span id="cb69-166"><a href="#cb69-166"></a></span>
<span id="cb69-167"><a href="#cb69-167"></a>:::{.callout-warning icon=false title="Subtask 2.c"}</span>
<span id="cb69-168"><a href="#cb69-168"></a>Choose a conservative lower and upper bound for the weight of any 12-day old chick, with the goal to exclude impossible values. Justify your choice with 1-3 sentences.</span>
<span id="cb69-169"><a href="#cb69-169"></a>:::</span>
<span id="cb69-170"><a href="#cb69-170"></a></span>
<span id="cb69-171"><a href="#cb69-171"></a>:::{.callout-tip collapse=false}</span>
<span id="cb69-172"><a href="#cb69-172"></a>Depending on your choice of range above for a "typical" chick, this range excluding the impossible values should be wider.</span>
<span id="cb69-173"><a href="#cb69-173"></a>:::</span>
<span id="cb69-174"><a href="#cb69-174"></a></span>
<span id="cb69-175"><a href="#cb69-175"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-176"><a href="#cb69-176"></a><span class="fu">### Prior standard deviation by intuition</span></span>
<span id="cb69-177"><a href="#cb69-177"></a></span>
<span id="cb69-178"><a href="#cb69-178"></a><span class="ss">* </span>Does the chosen range meet the following common sense criteria?</span>
<span id="cb69-179"><a href="#cb69-179"></a><span class="ss">  * </span>The range is always above <span class="co">[</span><span class="ot">zero</span><span class="co">]</span>{.content-hidden when-profile="public"} and below <span class="co">[</span><span class="ot">the weight of fully grown chickens stated above</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-180"><a href="#cb69-180"></a><span class="ss">* </span>Is the justification based on some sort of logic, even if you may disagree?</span>
<span id="cb69-181"><a href="#cb69-181"></a>::::</span>
<span id="cb69-182"><a href="#cb69-182"></a></span>
<span id="cb69-183"><a href="#cb69-183"></a>A common technique to find a weakly informative prior is to have a standard deviation which is an order of magnitude (a factor of 10) larger than a plausible standard deviation of the data.</span>
<span id="cb69-184"><a href="#cb69-184"></a></span>
<span id="cb69-185"><a href="#cb69-185"></a>:::{.callout-warning icon=false title="Subtask 2.d"}</span>
<span id="cb69-186"><a href="#cb69-186"></a>What do you think is a plausible standard deviation $\sigma_\text{plausible}$ of the weight of 12 days-old chicks, based on your ranges stated above?</span>
<span id="cb69-187"><a href="#cb69-187"></a>Under the above recommendation, what standard deviation $\sigma_0$ should you use for your prior for the mean weight $\mu$?</span>
<span id="cb69-188"><a href="#cb69-188"></a>:::</span>
<span id="cb69-189"><a href="#cb69-189"></a></span>
<span id="cb69-190"><a href="#cb69-190"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-191"><a href="#cb69-191"></a><span class="fu">#### Prior standard deviation by intuition</span></span>
<span id="cb69-192"><a href="#cb69-192"></a></span>
<span id="cb69-193"><a href="#cb69-193"></a><span class="ss">* </span>Do the two standard deviations meet the following common sense criteria?</span>
<span id="cb69-194"><a href="#cb69-194"></a><span class="ss">  - </span>Both values are <span class="co">[</span><span class="ot">positive (i.e. &gt; 0)</span><span class="co">]</span>{.content-hidden when-profile="public"}</span>
<span id="cb69-195"><a href="#cb69-195"></a><span class="ss">* </span>Given the choice of mean from above, the interval $(\mu_0 - 3\sigma_0, \mu_0 + 3\sigma_0)$ includes <span class="co">[</span><span class="ot">the chosen range of **plausible weights** for 12-day old chicks reported in 2b)</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-196"><a href="#cb69-196"></a>::::</span>
<span id="cb69-197"><a href="#cb69-197"></a></span>
<span id="cb69-198"><a href="#cb69-198"></a></span>
<span id="cb69-199"><a href="#cb69-199"></a>:::{.callout-warning icon=false title="Subtask 2.e"}</span>
<span id="cb69-200"><a href="#cb69-200"></a>Write down in mathematical form the final prior for the mean weight $\mu$ you found using this prior definition technique.</span>
<span id="cb69-201"><a href="#cb69-201"></a>:::</span>
<span id="cb69-202"><a href="#cb69-202"></a></span>
<span id="cb69-203"><a href="#cb69-203"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-204"><a href="#cb69-204"></a><span class="fu">### Prior by intuition</span></span>
<span id="cb69-205"><a href="#cb69-205"></a></span>
<span id="cb69-206"><a href="#cb69-206"></a><span class="ss">* </span>Does the final prior exist in mathematical notation?</span>
<span id="cb69-207"><a href="#cb69-207"></a><span class="ss">* </span>Does the prior reflect the choices made above (i.e. $\mu_0, \sigma_0$)?</span>
<span id="cb69-208"><a href="#cb69-208"></a>::::</span>
<span id="cb69-209"><a href="#cb69-209"></a></span>
<span id="cb69-210"><a href="#cb69-210"></a><span class="fu">## Choosing a weakly informative prior using external references</span></span>
<span id="cb69-211"><a href="#cb69-211"></a></span>
<span id="cb69-212"><a href="#cb69-212"></a>Next, we'll use external references to pick the weakly informed prior. This technique is more general and doesn't assume you would have prior knowledge.</span>
<span id="cb69-213"><a href="#cb69-213"></a></span>
<span id="cb69-214"><a href="#cb69-214"></a>:::{.callout-warning icon=false title="Subtask 2.f"}</span>
<span id="cb69-215"><a href="#cb69-215"></a>Consult a trustworthy source on the weight range of farm chickens, e.g. books, articles, a farmer friend. If the recommended values are for a fully grown chicken, make a reasonable adjustment for a 12-day old chick. What is the weight range of a 12-day old chicken? Cite your source and justify any adjustments you make to the reference range.</span>
<span id="cb69-216"><a href="#cb69-216"></a>:::</span>
<span id="cb69-217"><a href="#cb69-217"></a></span>
<span id="cb69-218"><a href="#cb69-218"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-219"><a href="#cb69-219"></a><span class="fu">### Weight range by reference</span></span>
<span id="cb69-220"><a href="#cb69-220"></a><span class="ss">* </span>Does the reference range meet the following common sense criteria?</span>
<span id="cb69-221"><a href="#cb69-221"></a><span class="ss">  * </span>The range is always above <span class="co">[</span><span class="ot">zero</span><span class="co">]</span>{.content-hidden when-profile="public"} and below <span class="co">[</span><span class="ot">the Guiness world record for a fully grown chicken (10kg)</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-222"><a href="#cb69-222"></a><span class="ss">* </span>Is there a citation? If an adjustment was made, was it justified by logic, even if you disagree?</span>
<span id="cb69-223"><a href="#cb69-223"></a>::::</span>
<span id="cb69-224"><a href="#cb69-224"></a></span>
<span id="cb69-225"><a href="#cb69-225"></a>:::{.callout-warning icon=false title="Subtask 2.g"}</span>
<span id="cb69-226"><a href="#cb69-226"></a>Based on this reference range, what will you choose for the mean of our weakly informed prior? Justify your choice with 1-3 sentences.</span>
<span id="cb69-227"><a href="#cb69-227"></a>:::</span>
<span id="cb69-228"><a href="#cb69-228"></a></span>
<span id="cb69-229"><a href="#cb69-229"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-230"><a href="#cb69-230"></a><span class="fu">### Weight range by reference</span></span>
<span id="cb69-231"><a href="#cb69-231"></a></span>
<span id="cb69-232"><a href="#cb69-232"></a><span class="ss">* </span>Does the mean value meet the following common sense criteria?</span>
<span id="cb69-233"><a href="#cb69-233"></a><span class="ss">  * </span>The range is always above <span class="co">[</span><span class="ot">zero</span><span class="co">]</span>{.content-hidden when-profile="public"} and below <span class="co">[</span><span class="ot">the maximum of the given reference range</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-234"><a href="#cb69-234"></a>::::</span>
<span id="cb69-235"><a href="#cb69-235"></a></span>
<span id="cb69-236"><a href="#cb69-236"></a>Next we choose the standard deviation of the prior. We could use the same technique as before, but we'll walk you through another common approach. Assume that $99.7\%$ of all 12-day old chicks fall into the reference range you found. Under our assumption of a normal distribution, this range will encompass values between $\mu_0 \pm 3\sigma_0$.</span>
<span id="cb69-237"><a href="#cb69-237"></a></span>
<span id="cb69-238"><a href="#cb69-238"></a>:::{.callout-warning icon=false title="Subtask 2.h"}</span>
<span id="cb69-239"><a href="#cb69-239"></a>Assuming symmetry, use the mean you chose and either the upper or lower bound $b$ of your reference range to solve the correct version of the following equations to find your associated choice of $\sigma_0$: (show your work)</span>
<span id="cb69-240"><a href="#cb69-240"></a></span>
<span id="cb69-241"><a href="#cb69-241"></a><span class="ss">- </span>For upper bound $b_u$: $Pr(\mu_0 + 3\sigma_0 &lt; b_u) \approx 0.997$, solving for $\sigma_0$.</span>
<span id="cb69-242"><a href="#cb69-242"></a><span class="ss">- </span>For lower bound $b_l$: $Pr(\mu_0 - 3\sigma_0 &gt; b_l) \approx 0.997$, solving for $\sigma_0$.</span>
<span id="cb69-243"><a href="#cb69-243"></a>:::</span>
<span id="cb69-244"><a href="#cb69-244"></a></span>
<span id="cb69-245"><a href="#cb69-245"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-246"><a href="#cb69-246"></a><span class="fu">### Prior standard deviation by reference</span></span>
<span id="cb69-247"><a href="#cb69-247"></a></span>
<span id="cb69-248"><a href="#cb69-248"></a><span class="ss">* </span>Does the calculated $\sigma_0$ value meet the following common sense criteria?</span>
<span id="cb69-249"><a href="#cb69-249"></a><span class="ss">  * </span>The value is above <span class="co">[</span><span class="ot">zero</span><span class="co">]</span>{.content-hidden when-profile="public"} and below <span class="co">[</span><span class="ot">4kg</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-250"><a href="#cb69-250"></a><span class="ss">* </span>Did they show their work?</span>
<span id="cb69-251"><a href="#cb69-251"></a>::::</span>
<span id="cb69-252"><a href="#cb69-252"></a></span>
<span id="cb69-253"><a href="#cb69-253"></a>:::{.callout-warning icon=false title="Subtask 2.i"}</span>
<span id="cb69-254"><a href="#cb69-254"></a>Write down in mathematical form the final prior for the mean weight $\mu$ you found using this prior definition technique.</span>
<span id="cb69-255"><a href="#cb69-255"></a>:::</span>
<span id="cb69-256"><a href="#cb69-256"></a></span>
<span id="cb69-257"><a href="#cb69-257"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-258"><a href="#cb69-258"></a><span class="fu">### Prior by reference</span></span>
<span id="cb69-259"><a href="#cb69-259"></a></span>
<span id="cb69-260"><a href="#cb69-260"></a><span class="ss">* </span>Does the final prior exist in mathematical notation?</span>
<span id="cb69-261"><a href="#cb69-261"></a><span class="ss">* </span>Does the prior reflect the choices made above (i.e. $\mu_0, \sigma_0$)?</span>
<span id="cb69-262"><a href="#cb69-262"></a>::::</span>
<span id="cb69-263"><a href="#cb69-263"></a></span>
<span id="cb69-264"><a href="#cb69-264"></a><span class="fu">## Non-normal priors</span></span>
<span id="cb69-265"><a href="#cb69-265"></a></span>
<span id="cb69-266"><a href="#cb69-266"></a>The previous steps all assumed we could use a prior which is normally distributed, but this may not always be the correct assumption to make.</span>
<span id="cb69-267"><a href="#cb69-267"></a></span>
<span id="cb69-268"><a href="#cb69-268"></a>:::{.callout-warning icon=false title="Subtask 2.j"}</span>
<span id="cb69-269"><a href="#cb69-269"></a>Under what mathematical/statistical circumstances would a normal distributed prior not make sense? List at least one circumstance.  Are there values that the normal distribution can take on which would not make sense for some types of variables?</span>
<span id="cb69-270"><a href="#cb69-270"></a>:::</span>
<span id="cb69-271"><a href="#cb69-271"></a></span>
<span id="cb69-272"><a href="#cb69-272"></a>:::{.callout-tip collapse=false}</span>
<span id="cb69-273"><a href="#cb69-273"></a>Consider the nature of any variable you are trying to define a prior over.</span>
<span id="cb69-274"><a href="#cb69-274"></a>:::</span>
<span id="cb69-275"><a href="#cb69-275"></a></span>
<span id="cb69-276"><a href="#cb69-276"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-277"><a href="#cb69-277"></a><span class="fu">### Non-normal priors</span></span>
<span id="cb69-278"><a href="#cb69-278"></a></span>
<span id="cb69-279"><a href="#cb69-279"></a><span class="ss">* </span>Example cases include variables that <span class="co">[</span><span class="ot">are categorical, discrete, or binary, e.g. colors, counts, yes/no</span><span class="co">]</span>{.content-hidden when-profile="public"} or variables that <span class="co">[</span><span class="ot">should never be negative, e.g. height, weight, count, age</span><span class="co">]</span>{.content-hidden when-profile="public"}</span>
<span id="cb69-280"><a href="#cb69-280"></a>::::</span>
<span id="cb69-281"><a href="#cb69-281"></a></span>
<span id="cb69-282"><a href="#cb69-282"></a><span class="fu">## Modeling diet effects on chicken weight</span></span>
<span id="cb69-283"><a href="#cb69-283"></a></span>
<span id="cb69-284"><a href="#cb69-284"></a>In addition to chick weights, the data also contains a categorical variable indicating which diet the chick received. In the data file, each column contains the measurements for a single chick at a given point of time.</span>
<span id="cb69-285"><a href="#cb69-285"></a></span>
<span id="cb69-286"><a href="#cb69-286"></a>In addition to the existing diets, we are interested in the quality of another box of feed (the fifth diet), which a farmer happened to find yesterday at a dark corner of his warehouse. To read in the data and select chicks with age of 12 days, and to have a peek at the first 6 rows, just use:</span>
<span id="cb69-287"><a href="#cb69-287"></a></span>
<span id="cb69-288"><a href="#cb69-288"></a>::::{.callout-important collapse=true}</span>
<span id="cb69-289"><a href="#cb69-289"></a><span class="fu"># Data inside, don't peek before you have set your priors!</span></span>
<span id="cb69-290"><a href="#cb69-290"></a>:::{.callout-important collapse=true}</span>
<span id="cb69-291"><a href="#cb69-291"></a><span class="fu"># Have you set your priors?</span></span>
<span id="cb69-294"><a href="#cb69-294"></a><span class="in">```{r}</span></span>
<span id="cb69-295"><a href="#cb69-295"></a><span class="co">#| message: false</span></span>
<span id="cb69-296"><a href="#cb69-296"></a><span class="fu">data</span>(<span class="st">"ChickWeight"</span>)</span>
<span id="cb69-297"><a href="#cb69-297"></a></span>
<span id="cb69-298"><a href="#cb69-298"></a>Chick12 <span class="ot">&lt;-</span> ChickWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(Time <span class="sc">==</span> <span class="dv">12</span>)</span>
<span id="cb69-299"><a href="#cb69-299"></a></span>
<span id="cb69-300"><a href="#cb69-300"></a><span class="fu">head</span>(Chick12)</span>
<span id="cb69-301"><a href="#cb69-301"></a><span class="in">```</span></span>
<span id="cb69-302"><a href="#cb69-302"></a>:::</span>
<span id="cb69-303"><a href="#cb69-303"></a>::::</span>
<span id="cb69-304"><a href="#cb69-304"></a></span>
<span id="cb69-305"><a href="#cb69-305"></a>In the following analysis, we will model the **weight of a chick at the age of 12 days**. We will use the following three Gaussian models:</span>
<span id="cb69-306"><a href="#cb69-306"></a></span>
<span id="cb69-307"><a href="#cb69-307"></a><span class="ss">-   </span>a separate model, in which each diet is modeled individually</span>
<span id="cb69-308"><a href="#cb69-308"></a><span class="ss">-   </span>a pooled model, in which all measurements are combined and there is no distinction between diets</span>
<span id="cb69-309"><a href="#cb69-309"></a><span class="ss">-   </span>a hierarchical model, which has a hierarchical structure as described in <span class="co">[</span><span class="ot">BDA3</span><span class="co">](https://users.aalto.fi/~ave/BDA3.pdf)</span> Section 11.6</span>
<span id="cb69-310"><a href="#cb69-310"></a></span>
<span id="cb69-311"><a href="#cb69-311"></a>As in the model described in the book, use the same weight standard deviation $\sigma$ for all the groups in the hierarchical model. In the separate model, however, use separate weight standard deviation $\sigma_d$ for each diet $d$. You should use weakly informative priors for all your models.</span>
<span id="cb69-312"><a href="#cb69-312"></a></span>
<span id="cb69-313"><a href="#cb69-313"></a>The provided Stan code below is given as an example of a separate model. Note that the author has left a comment expressing uncertainty about their prior choices. This separate model can be summarized mathematically as</span>
<span id="cb69-314"><a href="#cb69-314"></a>$$</span>
<span id="cb69-315"><a href="#cb69-315"></a>\begin{aligned}</span>
<span id="cb69-316"><a href="#cb69-316"></a>    \mu_{d} &amp;\sim \pi(\mu_d)&amp;&amp;\text{(diet-wise mean weight),}<span class="sc">\\</span></span>
<span id="cb69-317"><a href="#cb69-317"></a>    \sigma_d &amp;\sim \pi(\sigma_d)&amp;&amp;\text{(diet-wise standard deviation of diet-wise chicken weights)},<span class="sc">\\</span></span>
<span id="cb69-318"><a href="#cb69-318"></a>    w_{i,d} &amp;\sim N(\mu_d,\sigma_d)&amp;&amp;\text{(diet-wise chicken weights)}<span class="sc">\\</span></span>
<span id="cb69-319"><a href="#cb69-319"></a>\end{aligned}</span>
<span id="cb69-320"><a href="#cb69-320"></a>$$ {#eq-separate}</span>
<span id="cb69-321"><a href="#cb69-321"></a></span>
<span id="cb69-322"><a href="#cb69-322"></a>with priors</span>
<span id="cb69-323"><a href="#cb69-323"></a></span>
<span id="cb69-324"><a href="#cb69-324"></a>$$</span>
<span id="cb69-325"><a href="#cb69-325"></a>\begin{aligned}</span>
<span id="cb69-326"><a href="#cb69-326"></a>    \mu_{d} &amp;\sim N(0,10)&amp;&amp;\text{(adjust this) and}<span class="sc">\\</span></span>
<span id="cb69-327"><a href="#cb69-327"></a>    \sigma_d &amp;\sim\mathrm{exponential}(.02)&amp;&amp;\text{(you can keep this).}</span>
<span id="cb69-328"><a href="#cb69-328"></a>\end{aligned}</span>
<span id="cb69-329"><a href="#cb69-329"></a>$$ {#eq-separate-priors}</span>
<span id="cb69-330"><a href="#cb69-330"></a></span>
<span id="cb69-331"><a href="#cb69-331"></a>For the separate and the pooled models, use one of the weakly informative priors you have derived in 2.1) or 2.2) for the diet-wise mean weights</span>
<span id="cb69-332"><a href="#cb69-332"></a>$$\mu_d\sim \pi(\mu_d)=N(\mu_0,\sigma_0).$$</span>
<span id="cb69-333"><a href="#cb69-333"></a>For the hierarchical model, remember that the parameters in the priors for the diet-wise mean weights itself have to be parameters with their own prior distributions, in our case</span>
<span id="cb69-334"><a href="#cb69-334"></a>$$</span>
<span id="cb69-335"><a href="#cb69-335"></a>\begin{aligned}</span>
<span id="cb69-336"><a href="#cb69-336"></a>\mu_d &amp;\sim N(\mu,\tau)&amp;&amp;\text{(diet-wise mean weights)},<span class="sc">\\</span></span>
<span id="cb69-337"><a href="#cb69-337"></a>\mu &amp;\sim \pi(\mu)&amp;&amp;\text{(mean of prior for diet-wise mean weights) and}<span class="sc">\\</span></span>
<span id="cb69-338"><a href="#cb69-338"></a>\tau &amp;\sim \pi(\tau)&amp;&amp;\text{(standard deviation of prior for diet-wise mean weights).}</span>
<span id="cb69-339"><a href="#cb69-339"></a>\end{aligned}</span>
<span id="cb69-340"><a href="#cb69-340"></a>$$</span>
<span id="cb69-341"><a href="#cb69-341"></a></span>
<span id="cb69-342"><a href="#cb69-342"></a>Use the prior you have used for the diet-wise mean weights $\mu_d$ in the separate and pooled models for the prior on the mean of the prior for the diet-wise mean weights</span>
<span id="cb69-343"><a href="#cb69-343"></a>$$\mu \sim \pi(\mu) = N(\mu_0,\sigma_0)$$</span>
<span id="cb69-344"><a href="#cb69-344"></a>in the hierarchical model and use</span>
<span id="cb69-345"><a href="#cb69-345"></a>$$\tau \sim \pi(\tau) = \mathrm{exponential}(.02)$$</span>
<span id="cb69-346"><a href="#cb69-346"></a>for the prior on the standard deviation of the prior for the diet-wise mean weights.</span>
<span id="cb69-347"><a href="#cb69-347"></a></span>
<span id="cb69-348"><a href="#cb69-348"></a><span class="in">```{.stan include="additional_files/assignment7/chickens_separate.stan"}</span></span>
<span id="cb69-349"><a href="#cb69-349"></a><span class="in">```</span></span>
<span id="cb69-350"><a href="#cb69-350"></a></span>
<span id="cb69-351"><a href="#cb69-351"></a>::: {.callout-warning collapse=false}</span>
<span id="cb69-352"><a href="#cb69-352"></a><span class="fu">## Sample from the posterior</span></span>
<span id="cb69-353"><a href="#cb69-353"></a></span>
<span id="cb69-354"><a href="#cb69-354"></a>To sample from the posterior using Stan, use:</span>
<span id="cb69-355"><a href="#cb69-355"></a></span>
<span id="cb69-358"><a href="#cb69-358"></a><span class="in">```{r}</span></span>
<span id="cb69-359"><a href="#cb69-359"></a><span class="co">#| label: format data for Stan</span></span>
<span id="cb69-360"><a href="#cb69-360"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb69-361"><a href="#cb69-361"></a>  <span class="at">N_observations =</span> <span class="fu">nrow</span>(Chick12),</span>
<span id="cb69-362"><a href="#cb69-362"></a>  <span class="at">N_diets =</span> <span class="fu">length</span>(<span class="fu">unique</span>(Chick12<span class="sc">$</span>Diet)),</span>
<span id="cb69-363"><a href="#cb69-363"></a>  <span class="at">diet_idx =</span> Chick12<span class="sc">$</span>Diet,</span>
<span id="cb69-364"><a href="#cb69-364"></a>  <span class="at">weight =</span> Chick12<span class="sc">$</span>weight</span>
<span id="cb69-365"><a href="#cb69-365"></a>)</span>
<span id="cb69-366"><a href="#cb69-366"></a></span>
<span id="cb69-367"><a href="#cb69-367"></a>model_separate <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="at">stan_file =</span> <span class="st">"additional_files/assignment7/chickens_separate.stan"</span>)</span>
<span id="cb69-368"><a href="#cb69-368"></a></span>
<span id="cb69-369"><a href="#cb69-369"></a><span class="co"># Sampling from the posterior distribution happens here:</span></span>
<span id="cb69-370"><a href="#cb69-370"></a>fit_separate <span class="ot">&lt;-</span> model_separate<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> stan_data, <span class="at">refresh=</span><span class="dv">0</span>,</span>
<span id="cb69-371"><a href="#cb69-371"></a>                                      <span class="at">show_messages=</span><span class="cn">FALSE</span>,</span>
<span id="cb69-372"><a href="#cb69-372"></a>                                      <span class="at">show_exceptions=</span><span class="cn">FALSE</span>)</span>
<span id="cb69-373"><a href="#cb69-373"></a><span class="in">```</span></span>
<span id="cb69-374"><a href="#cb69-374"></a>Fit objects returned by the <span class="in">`sample()`</span> method, by default print a summary of the posterior draws.</span>
<span id="cb69-375"><a href="#cb69-375"></a>These are **NOT** the results you would expect to turn in your report. You will need to change the priors in the code for the separate model.</span>
<span id="cb69-378"><a href="#cb69-378"></a><span class="in">```{r}</span></span>
<span id="cb69-379"><a href="#cb69-379"></a>fit_separate</span>
<span id="cb69-380"><a href="#cb69-380"></a><span class="in">```</span></span>
<span id="cb69-381"><a href="#cb69-381"></a>Quick model convergence check (as in assignment 6):</span>
<span id="cb69-384"><a href="#cb69-384"></a><span class="in">```{r}</span></span>
<span id="cb69-385"><a href="#cb69-385"></a>fit_separate<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span>
<span id="cb69-386"><a href="#cb69-386"></a><span class="in">```</span></span>
<span id="cb69-387"><a href="#cb69-387"></a></span>
<span id="cb69-388"><a href="#cb69-388"></a>:::</span>
<span id="cb69-389"><a href="#cb69-389"></a></span>
<span id="cb69-390"><a href="#cb69-390"></a></span>
<span id="cb69-391"><a href="#cb69-391"></a></span>
<span id="cb69-392"><a href="#cb69-392"></a>:::{.callout-warning icon=false title="Subtask 2.k"}</span>
<span id="cb69-393"><a href="#cb69-393"></a>Describe the models with mathematical notation (as is done for the separate model above). Also describe in words the difference between the model and the other models.</span>
<span id="cb69-394"><a href="#cb69-394"></a>:::</span>
<span id="cb69-395"><a href="#cb69-395"></a></span>
<span id="cb69-396"><a href="#cb69-396"></a></span>
<span id="cb69-397"><a href="#cb69-397"></a></span>
<span id="cb69-398"><a href="#cb69-398"></a></span>
<span id="cb69-399"><a href="#cb69-399"></a></span>
<span id="cb69-400"><a href="#cb69-400"></a></span>
<span id="cb69-401"><a href="#cb69-401"></a></span>
<span id="cb69-402"><a href="#cb69-402"></a></span>
<span id="cb69-403"><a href="#cb69-403"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-404"><a href="#cb69-404"></a></span>
<span id="cb69-405"><a href="#cb69-405"></a><span class="ss">* </span>Are the models described using mathematical notation and the difference to other models described in words?</span>
<span id="cb69-406"><a href="#cb69-406"></a><span class="ss">  - </span>No equations and no description</span>
<span id="cb69-407"><a href="#cb69-407"></a><span class="ss">  - </span>Description but no equations</span>
<span id="cb69-408"><a href="#cb69-408"></a><span class="ss">  - </span>Equations but no description</span>
<span id="cb69-409"><a href="#cb69-409"></a><span class="ss">  - </span>Equations and description</span>
<span id="cb69-410"><a href="#cb69-410"></a>::::</span>
<span id="cb69-411"><a href="#cb69-411"></a></span>
<span id="cb69-412"><a href="#cb69-412"></a>:::{.callout-warning icon=false title="Subtask 2.l"}</span>
<span id="cb69-413"><a href="#cb69-413"></a>Implement the models in Stan and include the code in the report. Use weakly informative priors for all of your models.</span>
<span id="cb69-414"><a href="#cb69-414"></a>:::</span>
<span id="cb69-415"><a href="#cb69-415"></a></span>
<span id="cb69-416"><a href="#cb69-416"></a>:::{.callout-tip collapse=false}</span>
<span id="cb69-417"><a href="#cb69-417"></a>When sampling from the posterior of the hierarchical model, you will very likely get a warning about divergent transitions. This tells you that the sampler is having difficulties in sampling the joint posterior and this may lead to biased inference. We will return to this in the next task.</span>
<span id="cb69-418"><a href="#cb69-418"></a>:::</span>
<span id="cb69-419"><a href="#cb69-419"></a></span>
<span id="cb69-420"><a href="#cb69-420"></a>:::{.content-visible when-profile="public"}</span>
<span id="cb69-421"><a href="#cb69-421"></a>**For the figures below, we use the earlier draws for the separate model with bad priors.</span>
<span id="cb69-422"><a href="#cb69-422"></a>When you have implemented the pooled and hierarchical models, edit the code below to</span>
<span id="cb69-423"><a href="#cb69-423"></a>include draws from your model posterior into the figures.**</span>
<span id="cb69-424"><a href="#cb69-424"></a>:::</span>
<span id="cb69-425"><a href="#cb69-425"></a></span>
<span id="cb69-426"><a href="#cb69-426"></a>:::{.callout-warning collapse=false}</span>
<span id="cb69-427"><a href="#cb69-427"></a><span class="fu">### Data preparation and sampling from the posterior</span></span>
<span id="cb69-428"><a href="#cb69-428"></a></span>
<span id="cb69-431"><a href="#cb69-431"></a><span class="in">```{r}</span></span>
<span id="cb69-432"><a href="#cb69-432"></a><span class="co">#| label: draws for pooled and hierarchical</span></span>
<span id="cb69-433"><a href="#cb69-433"></a><span class="co">#| code-summary: Sampling from the posteriors given the pooled and hierarhical models</span></span>
<span id="cb69-434"><a href="#cb69-434"></a></span>
<span id="cb69-435"><a href="#cb69-435"></a>fit_pooled <span class="ot">&lt;-</span> fit_separate</span>
<span id="cb69-436"><a href="#cb69-436"></a>fit_hierarchical <span class="ot">&lt;-</span> fit_separate</span>
<span id="cb69-437"><a href="#cb69-437"></a></span>
<span id="cb69-438"><a href="#cb69-438"></a></span>
<span id="cb69-439"><a href="#cb69-439"></a><span class="in">```</span></span>
<span id="cb69-440"><a href="#cb69-440"></a></span>
<span id="cb69-441"><a href="#cb69-441"></a>Below, we collect the corresponding posterior draws from the three models into a shared</span>
<span id="cb69-442"><a href="#cb69-442"></a>data frame using the <span class="in">`extract_variable`</span> function. This makes plotting the posterior</span>
<span id="cb69-443"><a href="#cb69-443"></a>in a single plot easier.</span>
<span id="cb69-446"><a href="#cb69-446"></a><span class="in">```{r}</span></span>
<span id="cb69-447"><a href="#cb69-447"></a><span class="co">#| label: prepare data for plots</span></span>
<span id="cb69-448"><a href="#cb69-448"></a><span class="co">#| code-summary: Prepare data for plots</span></span>
<span id="cb69-449"><a href="#cb69-449"></a></span>
<span id="cb69-450"><a href="#cb69-450"></a><span class="co"># Expect the same number of posterior draws from each model.</span></span>
<span id="cb69-451"><a href="#cb69-451"></a>ndraws <span class="ot">&lt;-</span> <span class="fu">nrow</span>(fit_hierarchical<span class="sc">$</span><span class="fu">sampler_diagnostics</span>(<span class="at">format =</span> <span class="st">"matrix"</span>))</span>
<span id="cb69-452"><a href="#cb69-452"></a></span>
<span id="cb69-453"><a href="#cb69-453"></a><span class="co"># Collect posterior draws and the model used to a data frame.</span></span>
<span id="cb69-454"><a href="#cb69-454"></a>mean_diet_4_separate <span class="ot">=</span> <span class="fu">extract_variable</span>(fit_separate, <span class="st">"mean_diet[4]"</span>)</span>
<span id="cb69-455"><a href="#cb69-455"></a>mean_diet_4_pooled <span class="ot">=</span> <span class="fu">extract_variable</span>(fit_pooled, <span class="st">"mean_diet[4]"</span>)</span>
<span id="cb69-456"><a href="#cb69-456"></a>mean_diet_4_hierarchical <span class="ot">=</span> <span class="fu">extract_variable</span>(fit_hierarchical, <span class="st">"mean_diet[4]"</span>)</span>
<span id="cb69-457"><a href="#cb69-457"></a>posterior_mean_diet_4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb69-458"><a href="#cb69-458"></a>  <span class="at">model_name =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Separate"</span>, <span class="st">"Pooled"</span>, <span class="st">"Hierarchical"</span>),</span>
<span id="cb69-459"><a href="#cb69-459"></a>              <span class="at">each =</span> ndraws),</span>
<span id="cb69-460"><a href="#cb69-460"></a>  <span class="at">mean_diet_4 =</span> <span class="fu">c</span>(</span>
<span id="cb69-461"><a href="#cb69-461"></a>   mean_diet_4_separate, mean_diet_4_pooled, mean_diet_4_hierarchical</span>
<span id="cb69-462"><a href="#cb69-462"></a>  ))</span>
<span id="cb69-463"><a href="#cb69-463"></a></span>
<span id="cb69-464"><a href="#cb69-464"></a>predicted_weight_diet_4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb69-465"><a href="#cb69-465"></a>  <span class="at">model_name =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Separate"</span>, <span class="st">"Pooled"</span>, <span class="st">"Hierarchical"</span>),</span>
<span id="cb69-466"><a href="#cb69-466"></a>              <span class="at">each =</span> ndraws),</span>
<span id="cb69-467"><a href="#cb69-467"></a>  <span class="at">predicted_weight =</span> <span class="fu">c</span>(</span>
<span id="cb69-468"><a href="#cb69-468"></a>   <span class="fu">extract_variable</span>(fit_separate, <span class="st">"weight_pred"</span>),</span>
<span id="cb69-469"><a href="#cb69-469"></a>   <span class="fu">extract_variable</span>(fit_pooled, <span class="st">"weight_pred"</span>),</span>
<span id="cb69-470"><a href="#cb69-470"></a>   <span class="fu">extract_variable</span>(fit_hierarchical, <span class="st">"weight_pred"</span>)</span>
<span id="cb69-471"><a href="#cb69-471"></a>  ))</span>
<span id="cb69-472"><a href="#cb69-472"></a></span>
<span id="cb69-473"><a href="#cb69-473"></a><span class="co"># Collect posterior draws and the model used to a long data frame.</span></span>
<span id="cb69-474"><a href="#cb69-474"></a>posterior_mean_diet_5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb69-475"><a href="#cb69-475"></a>  <span class="at">model_name =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Separate"</span>, <span class="st">"Pooled"</span>, <span class="st">"Hierarchical"</span>),</span>
<span id="cb69-476"><a href="#cb69-476"></a>    <span class="at">each =</span> ndraws</span>
<span id="cb69-477"><a href="#cb69-477"></a>  ),</span>
<span id="cb69-478"><a href="#cb69-478"></a>  <span class="at">mean_diet_5 =</span> <span class="fu">c</span>(</span>
<span id="cb69-479"><a href="#cb69-479"></a>    <span class="fu">extract_variable</span>(fit_separate, <span class="st">"mean_five"</span>),</span>
<span id="cb69-480"><a href="#cb69-480"></a>    <span class="fu">extract_variable</span>(fit_pooled, <span class="st">"mean_five"</span>),</span>
<span id="cb69-481"><a href="#cb69-481"></a>    <span class="fu">extract_variable</span>(fit_hierarchical, <span class="st">"mean_five"</span>)</span>
<span id="cb69-482"><a href="#cb69-482"></a>  )</span>
<span id="cb69-483"><a href="#cb69-483"></a>)</span>
<span id="cb69-484"><a href="#cb69-484"></a></span>
<span id="cb69-485"><a href="#cb69-485"></a><span class="co"># Mean observed weight per diet, these help to compare the posteriors to data.</span></span>
<span id="cb69-486"><a href="#cb69-486"></a>diet_means <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb69-487"><a href="#cb69-487"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(diet) <span class="fu">mean</span>(Chick12[Chick12<span class="sc">$</span>Diet <span class="sc">==</span> diet, <span class="st">"weight"</span>])</span>
<span id="cb69-488"><a href="#cb69-488"></a>)</span>
<span id="cb69-489"><a href="#cb69-489"></a><span class="in">```</span></span>
<span id="cb69-490"><a href="#cb69-490"></a>:::</span>
<span id="cb69-491"><a href="#cb69-491"></a></span>
<span id="cb69-492"><a href="#cb69-492"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-493"><a href="#cb69-493"></a><span class="fu">### All models</span></span>
<span id="cb69-494"><a href="#cb69-494"></a></span>
<span id="cb69-495"><a href="#cb69-495"></a><span class="ss">* </span>Is there a related Stan implementation?</span>
<span id="cb69-496"><a href="#cb69-496"></a><span class="ss">  - </span>No Stan model implemented</span>
<span id="cb69-497"><a href="#cb69-497"></a><span class="ss">  - </span>Stan model implemented, but it seems clearly wrong or broken</span>
<span id="cb69-498"><a href="#cb69-498"></a><span class="ss">  - </span>Seemingly valid Stan model implemented</span>
<span id="cb69-499"><a href="#cb69-499"></a>::::</span>
<span id="cb69-500"><a href="#cb69-500"></a></span>
<span id="cb69-501"><a href="#cb69-501"></a></span>
<span id="cb69-502"><a href="#cb69-502"></a></span>
<span id="cb69-503"><a href="#cb69-503"></a></span>
<span id="cb69-504"><a href="#cb69-504"></a></span>
<span id="cb69-505"><a href="#cb69-505"></a>:::{.callout-warning icon=false title="Subtask 2.m"}</span>
<span id="cb69-506"><a href="#cb69-506"></a>Use the provided code in the template to</span>
<span id="cb69-507"><a href="#cb69-507"></a>plot the **posterior distribution of the mean of the weight measurements of the fourth diet** and comment on the possible differences you observe</span>
<span id="cb69-508"><a href="#cb69-508"></a>between the models.</span>
<span id="cb69-509"><a href="#cb69-509"></a>:::</span>
<span id="cb69-510"><a href="#cb69-510"></a></span>
<span id="cb69-511"><a href="#cb69-511"></a>:::{.content-visible when-profile="public"}</span>
<span id="cb69-514"><a href="#cb69-514"></a><span class="in">```{r}</span></span>
<span id="cb69-515"><a href="#cb69-515"></a><span class="co">#| label: figure - posterior of mean 4</span></span>
<span id="cb69-516"><a href="#cb69-516"></a><span class="co">#| fig-cap: Posterior distribution of the mean weight of chicks consuming diet 4.</span></span>
<span id="cb69-517"><a href="#cb69-517"></a><span class="fu">ggplot</span>(posterior_mean_diet_4, <span class="fu">aes</span>(<span class="at">x =</span> mean_diet_4, <span class="at">y =</span> model_name)) <span class="sc">+</span></span>
<span id="cb69-518"><a href="#cb69-518"></a>  <span class="fu">stat_dotsinterval</span>(<span class="at">quantiles =</span> <span class="dv">100</span>, <span class="at">scale =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb69-519"><a href="#cb69-519"></a>  <span class="fu">vline_at</span>(diet_means[<span class="dv">4</span>], <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb69-520"><a href="#cb69-520"></a>  <span class="co"># Annotate the vline from above.</span></span>
<span id="cb69-521"><a href="#cb69-521"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Observation mean"</span>, <span class="at">x =</span> diet_means[<span class="dv">4</span>] <span class="sc">-</span> <span class="dv">5</span>, <span class="at">y =</span> .<span class="dv">7</span>,</span>
<span id="cb69-522"><a href="#cb69-522"></a>           <span class="at">hjust =</span> <span class="st">"right"</span>, <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb69-523"><a href="#cb69-523"></a>  <span class="co"># Add title and axis labels. One line to make everything so much more clear!</span></span>
<span id="cb69-524"><a href="#cb69-524"></a>  <span class="fu">labs</span>(</span>
<span id="cb69-525"><a href="#cb69-525"></a>    <span class="at">title =</span> <span class="st">"Mean of diet 4"</span>,</span>
<span id="cb69-526"><a href="#cb69-526"></a>    <span class="at">x =</span> <span class="st">"Weight (g)"</span>,</span>
<span id="cb69-527"><a href="#cb69-527"></a>    <span class="at">y =</span> <span class="st">"Model"</span></span>
<span id="cb69-528"><a href="#cb69-528"></a>  )</span>
<span id="cb69-529"><a href="#cb69-529"></a><span class="in">```</span></span>
<span id="cb69-530"><a href="#cb69-530"></a>:::</span>
<span id="cb69-531"><a href="#cb69-531"></a></span>
<span id="cb69-532"><a href="#cb69-532"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-533"><a href="#cb69-533"></a><span class="ss">* </span>Is there a comparison plotted for the posteriors of the mean of diet 4? Does it look something like the model solution plot?</span>
<span id="cb69-534"><a href="#cb69-534"></a><span class="ss">  -   </span>No comparison plotted</span>
<span id="cb69-535"><a href="#cb69-535"></a><span class="ss">  -   </span>Comparison plotted but it clearly differs from the example</span>
<span id="cb69-536"><a href="#cb69-536"></a><span class="ss">  -   </span>Comparison plotted and it approximately matches the example</span>
<span id="cb69-537"><a href="#cb69-537"></a><span class="ss">* </span>Separate model: Is the result for the separate model discussed?</span>
<span id="cb69-538"><a href="#cb69-538"></a><span class="ss">  -   </span>The result is not discussed.</span>
<span id="cb69-539"><a href="#cb69-539"></a><span class="ss">  -   </span>There is some discussion, but it is not mentioned that <span class="co">[</span><span class="ot">the separate model seems to match the observed mean the best</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-540"><a href="#cb69-540"></a><span class="ss">  -   </span>The result is discussed and the separate model is recognised as <span class="co">[</span><span class="ot">the best fit to the data</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-541"><a href="#cb69-541"></a><span class="ss">* </span>Pooled model: Is the result for the pooled model discussed?</span>
<span id="cb69-542"><a href="#cb69-542"></a><span class="ss">  -   </span>The result is not discussed.</span>
<span id="cb69-543"><a href="#cb69-543"></a><span class="ss">  -   </span>There is some discussion, but it is not mentioned that <span class="co">[</span><span class="ot">the posterior is furthest from observed mean</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-544"><a href="#cb69-544"></a><span class="ss">  -   </span>The result is discussed and the pooled model is recognised as <span class="co">[</span><span class="ot">having the worst fit to the data</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-545"><a href="#cb69-545"></a><span class="ss">* </span>Hierarchical model: Is the result for the hierarchical model discussed?</span>
<span id="cb69-546"><a href="#cb69-546"></a><span class="ss">  -   </span>The result is not discussed.</span>
<span id="cb69-547"><a href="#cb69-547"></a><span class="ss">  -   </span>There is some discussion, but it is not mentioned that <span class="co">[</span><span class="ot">the posterior is between the two other posteriors</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-548"><a href="#cb69-548"></a><span class="ss">  -   </span>The result is discussed and the hierarchical model is recognised as <span class="co">[</span><span class="ot">providing the second most accurate fit to the data</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-549"><a href="#cb69-549"></a>::::</span>
<span id="cb69-550"><a href="#cb69-550"></a></span>
<span id="cb69-551"><a href="#cb69-551"></a>:::{.callout-warning icon=false title="Subtask 2.n"}</span>
<span id="cb69-552"><a href="#cb69-552"></a>Use the provided code in the template to</span>
<span id="cb69-553"><a href="#cb69-553"></a>plot the **predictive distribution for another weight measurement from a chick having the fourth diet** and comment on the possible differences you observe</span>
<span id="cb69-554"><a href="#cb69-554"></a>between the models.</span>
<span id="cb69-555"><a href="#cb69-555"></a>:::</span>
<span id="cb69-556"><a href="#cb69-556"></a></span>
<span id="cb69-557"><a href="#cb69-557"></a>:::{.content-visible when-profile="public"}</span>
<span id="cb69-560"><a href="#cb69-560"></a><span class="in">```{r}</span></span>
<span id="cb69-561"><a href="#cb69-561"></a><span class="co">#| label: figure - predicted weight of for diet 4</span></span>
<span id="cb69-562"><a href="#cb69-562"></a><span class="co">#| fig-cap: The (posterior) predictive distribution of the weigth of a chick consuming diet 4.</span></span>
<span id="cb69-563"><a href="#cb69-563"></a><span class="fu">ggplot</span>(predicted_weight_diet_4, <span class="fu">aes</span>(<span class="at">x =</span> predicted_weight, <span class="at">y =</span> model_name)) <span class="sc">+</span></span>
<span id="cb69-564"><a href="#cb69-564"></a>  <span class="fu">stat_dotsinterval</span>(<span class="at">quantiles =</span> <span class="dv">100</span>, <span class="at">scale =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb69-565"><a href="#cb69-565"></a>  <span class="fu">vline_at</span>(diet_means[<span class="dv">4</span>], <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb69-566"><a href="#cb69-566"></a>  <span class="co"># Annotate the vline from above.</span></span>
<span id="cb69-567"><a href="#cb69-567"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Observation mean"</span>, <span class="at">x =</span> diet_means[<span class="dv">4</span>] <span class="sc">-</span> <span class="dv">5</span>, <span class="at">y =</span> .<span class="dv">7</span>,</span>
<span id="cb69-568"><a href="#cb69-568"></a>           <span class="at">hjust =</span> <span class="st">"right"</span>, <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb69-569"><a href="#cb69-569"></a>  <span class="co"># Add title and axis labels. One line to make everything so much more clear!</span></span>
<span id="cb69-570"><a href="#cb69-570"></a>  <span class="fu">labs</span>(</span>
<span id="cb69-571"><a href="#cb69-571"></a>    <span class="at">title =</span> <span class="st">"Weigth of a chick with diet 4"</span>,</span>
<span id="cb69-572"><a href="#cb69-572"></a>    <span class="at">x =</span> <span class="st">"Weight (g)"</span>,</span>
<span id="cb69-573"><a href="#cb69-573"></a>    <span class="at">y =</span> <span class="st">"Model"</span></span>
<span id="cb69-574"><a href="#cb69-574"></a>  )</span>
<span id="cb69-575"><a href="#cb69-575"></a><span class="in">```</span></span>
<span id="cb69-576"><a href="#cb69-576"></a>:::</span>
<span id="cb69-577"><a href="#cb69-577"></a></span>
<span id="cb69-578"><a href="#cb69-578"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-579"><a href="#cb69-579"></a></span>
<span id="cb69-580"><a href="#cb69-580"></a><span class="ss">* </span>Is there a comparison plotted for the predictive distributions of the weight of a chick with diet 4? Does it look something like the model solution plot?</span>
<span id="cb69-581"><a href="#cb69-581"></a><span class="ss">  -   </span>No comparison plotted</span>
<span id="cb69-582"><a href="#cb69-582"></a><span class="ss">  -   </span>Comparison plotted but it clearly differs from the example</span>
<span id="cb69-583"><a href="#cb69-583"></a><span class="ss">  -   </span>Comparison plotted and it approximately matches the example</span>
<span id="cb69-584"><a href="#cb69-584"></a><span class="ss">* </span>Separate model: Is the result for the separate model discussed?</span>
<span id="cb69-585"><a href="#cb69-585"></a><span class="ss">  -   </span>The result is not discussed.</span>
<span id="cb69-586"><a href="#cb69-586"></a><span class="ss">  -   </span>There is some discussion, but it is not mentioned that <span class="co">[</span><span class="ot">the separate model seems to match the data the best</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-587"><a href="#cb69-587"></a><span class="ss">  -   </span>The result is discussed and the separate model is recognised as <span class="co">[</span><span class="ot">the best fit to the data</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-588"><a href="#cb69-588"></a><span class="ss">* </span>Pooled model: Is the result for the pooled model discussed?</span>
<span id="cb69-589"><a href="#cb69-589"></a><span class="ss">  -   </span>The result is not discussed.</span>
<span id="cb69-590"><a href="#cb69-590"></a><span class="ss">  -   </span>There is some discussion, but it is not mentioned that <span class="co">[</span><span class="ot">the posterior is furthest from the data</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-591"><a href="#cb69-591"></a><span class="ss">  -   </span>The result is discussed and the pooled model is recognised as <span class="co">[</span><span class="ot">having the worst fit to the data</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-592"><a href="#cb69-592"></a><span class="ss">* </span>Hierarchical model: Is the result for the hierarchical model discussed?</span>
<span id="cb69-593"><a href="#cb69-593"></a><span class="ss">  -   </span>The result is not discussed.</span>
<span id="cb69-594"><a href="#cb69-594"></a><span class="ss">  -   </span>There is some discussion, but it is not mentioned that <span class="co">[</span><span class="ot">the posterior is between the two other posteriors</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-595"><a href="#cb69-595"></a><span class="ss">  -   </span>The result is discussed and the hierarchical model is recognised as <span class="co">[</span><span class="ot">providing the second most accurate fit to the data</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-596"><a href="#cb69-596"></a>::::</span>
<span id="cb69-597"><a href="#cb69-597"></a></span>
<span id="cb69-598"><a href="#cb69-598"></a>::: {.callout-warning icon=false title="Subtask 2.o"}</span>
<span id="cb69-599"><a href="#cb69-599"></a>Use the provided code in the template to</span>
<span id="cb69-600"><a href="#cb69-600"></a>plot the **posterior distribution of the mean of the weight measurements of a new fifth diet** and comment on the possible differences you observe</span>
<span id="cb69-601"><a href="#cb69-601"></a>between the models.</span>
<span id="cb69-602"><a href="#cb69-602"></a>:::</span>
<span id="cb69-603"><a href="#cb69-603"></a></span>
<span id="cb69-604"><a href="#cb69-604"></a>:::{.content-visible when-profile="public"}</span>
<span id="cb69-607"><a href="#cb69-607"></a><span class="in">```{r}</span></span>
<span id="cb69-608"><a href="#cb69-608"></a><span class="co">#| label: figure - posterior of mean 5</span></span>
<span id="cb69-609"><a href="#cb69-609"></a><span class="co">#| fig-cap: Posterior distribution of the mean weight of chicks consuming the new diet 5 not seen before.</span></span>
<span id="cb69-610"><a href="#cb69-610"></a></span>
<span id="cb69-611"><a href="#cb69-611"></a><span class="fu">ggplot</span>(posterior_mean_diet_5, <span class="fu">aes</span>(<span class="at">x =</span> mean_diet_5, <span class="at">y =</span> model_name)) <span class="sc">+</span></span>
<span id="cb69-612"><a href="#cb69-612"></a>  <span class="co"># Draw the mean of each diet from the data as a dashed vertical line.</span></span>
<span id="cb69-613"><a href="#cb69-613"></a>  <span class="fu">vline_at</span>(diet_means, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb69-614"><a href="#cb69-614"></a>  <span class="co"># dotsinterval gives mean, 50%, and 90% intervals + dotsplot with each dot</span></span>
<span id="cb69-615"><a href="#cb69-615"></a>  <span class="co"># representing 1% of data (quantiles = 100).</span></span>
<span id="cb69-616"><a href="#cb69-616"></a>  <span class="fu">stat_dotsinterval</span>(<span class="at">quantiles =</span> <span class="dv">100</span>, <span class="at">scale =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb69-617"><a href="#cb69-617"></a>  <span class="co"># Annotate the vline from above.</span></span>
<span id="cb69-618"><a href="#cb69-618"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Means of observed diets"</span>, <span class="at">y =</span> .<span class="dv">7</span>, <span class="at">x =</span> <span class="dv">100</span>,</span>
<span id="cb69-619"><a href="#cb69-619"></a>           <span class="at">hjust =</span> <span class="st">"right"</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">family =</span> <span class="st">"sans"</span>) <span class="sc">+</span></span>
<span id="cb69-620"><a href="#cb69-620"></a>  <span class="co"># Add title and axis labels. One line to make everything so much more clear!</span></span>
<span id="cb69-621"><a href="#cb69-621"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mean of a new diet"</span>,</span>
<span id="cb69-622"><a href="#cb69-622"></a>       <span class="at">x =</span> <span class="st">"Weight (g)"</span>,</span>
<span id="cb69-623"><a href="#cb69-623"></a>       <span class="at">y =</span> <span class="st">"Model"</span>)</span>
<span id="cb69-624"><a href="#cb69-624"></a><span class="in">```</span></span>
<span id="cb69-625"><a href="#cb69-625"></a>:::</span>
<span id="cb69-626"><a href="#cb69-626"></a></span>
<span id="cb69-627"><a href="#cb69-627"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-628"><a href="#cb69-628"></a><span class="ss">* </span>Is there a comparison plotted for the posterior distributions of the mean weight with a new diet? Does it look something like the model solution plot?</span>
<span id="cb69-629"><a href="#cb69-629"></a><span class="ss">  -   </span>No comparison plotted</span>
<span id="cb69-630"><a href="#cb69-630"></a><span class="ss">  -   </span>Comparison plotted but it clearly differs from the example</span>
<span id="cb69-631"><a href="#cb69-631"></a><span class="ss">  -   </span>Comparison plotted and it approximately matches the example</span>
<span id="cb69-632"><a href="#cb69-632"></a><span class="ss">* </span>Separate model: Is the result for the separate model discussed?</span>
<span id="cb69-633"><a href="#cb69-633"></a><span class="ss">  -   </span>The result is not discussed.</span>
<span id="cb69-634"><a href="#cb69-634"></a><span class="ss">  -   </span>There is some discussion, but it is not mentioned that <span class="co">[</span><span class="ot">the posterior for the separate model is extremely wide</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-635"><a href="#cb69-635"></a><span class="ss">  -   </span>The result is discussed and the separate model is recognised as <span class="co">[</span><span class="ot">having the widest posterior</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-636"><a href="#cb69-636"></a><span class="ss">  -   </span>In addition to the previous option, it is recognised that <span class="co">[</span><span class="ot">the separate model only gives prior predictive samples, that is, samples generated using parameter values drawn from the prior distribution</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-637"><a href="#cb69-637"></a><span class="ss">* </span>Pooled model: Is the result for the pooled model discussed?</span>
<span id="cb69-638"><a href="#cb69-638"></a><span class="ss">  -   </span>The result is not discussed.</span>
<span id="cb69-639"><a href="#cb69-639"></a><span class="ss">  -   </span>There is some discussion, but it is not mentioned that <span class="co">[</span><span class="ot">the posterior is the most narrow</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-640"><a href="#cb69-640"></a><span class="ss">    -   </span>The result is discussed and the pooled model is recognised as <span class="co">[</span><span class="ot">having too narrow a posterior</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-641"><a href="#cb69-641"></a><span class="ss">    -   </span>In addition to the previous option, it is mentioned that <span class="co">[</span><span class="ot">the pooled model only models the population, that is, it doesn’t differentiate between the diets</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-642"><a href="#cb69-642"></a><span class="ss">* </span>Hierarchical model: Is the result for the hierarchical model discussed?</span>
<span id="cb69-643"><a href="#cb69-643"></a><span class="ss">  -   </span>The result is not discussed.</span>
<span id="cb69-644"><a href="#cb69-644"></a><span class="ss">    -   </span>There is some discussion, but it is not mentioned that <span class="co">[</span><span class="ot">the hierarchical model seems to have the best result</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-645"><a href="#cb69-645"></a><span class="ss">    -   </span>The result is discussed and the hierarchical model is recognised as <span class="co">[</span><span class="ot">providing the best results</span><span class="co">]</span>{.content-hidden when-profile="public"}.</span>
<span id="cb69-646"><a href="#cb69-646"></a>::::</span>
<span id="cb69-647"><a href="#cb69-647"></a></span>
<span id="cb69-648"><a href="#cb69-648"></a>:::{.callout-warning icon=false title="Subtask 2.p"}</span>
<span id="cb69-649"><a href="#cb69-649"></a>For each model, report the **posterior expectation for the mean weight of diet 4 with a 90% credible interval**.</span>
<span id="cb69-650"><a href="#cb69-650"></a>:::</span>
<span id="cb69-651"><a href="#cb69-651"></a></span>
<span id="cb69-652"><a href="#cb69-652"></a>:::{.callout-tip collapse=false}</span>
<span id="cb69-653"><a href="#cb69-653"></a>See the example Stan codes in the demo <span class="co">[</span><span class="ot">Bayesian data analysis - CmdStanR demos: Comparison of $k$ groups with hierarchical models</span><span class="co">]</span>(http://avehtari.github.io/BDA_R_demos/demos_rstan/cmdstanr_demo.html#8_Comparison_of_(k)_groups_with_hierarchical_models) for the comparison of $k$ groups with and without the hierarchical structure.</span>
<span id="cb69-654"><a href="#cb69-654"></a>:::</span>
<span id="cb69-655"><a href="#cb69-655"></a></span>
<span id="cb69-656"><a href="#cb69-656"></a>::::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-657"><a href="#cb69-657"></a><span class="ss">* </span>For the separate model, is the posterior 90% credible interval for the mean of the fourth diet close to: [<span class="co">[</span><span class="ot">142, 160</span><span class="co">]</span>]{.content-hidden when-profile="public"} (small/medium deviation is fine).</span>
<span id="cb69-658"><a href="#cb69-658"></a><span class="ss">  - </span>No or incorrect answer</span>
<span id="cb69-659"><a href="#cb69-659"></a><span class="ss">  - </span>Answer is only partially correct</span>
<span id="cb69-660"><a href="#cb69-660"></a><span class="ss">  - </span>Answers look correct</span>
<span id="cb69-661"><a href="#cb69-661"></a><span class="ss">* </span>For the pooled model, is the posterior 90% credible interval for the mean of the fourth diet close to: [<span class="co">[</span><span class="ot">121, 137</span><span class="co">]</span>]{.content-hidden when-profile="public"} (small/medium deviation is fine).</span>
<span id="cb69-662"><a href="#cb69-662"></a><span class="ss">  - </span>No answer</span>
<span id="cb69-663"><a href="#cb69-663"></a><span class="ss">  - </span>Answer is only partially correct</span>
<span id="cb69-664"><a href="#cb69-664"></a><span class="ss">  - </span>Answer looks correct</span>
<span id="cb69-665"><a href="#cb69-665"></a><span class="ss">* </span>For the hierarchical model, is the posterior 90% credible interval for the mean of the fourth diet close to: [<span class="co">[</span><span class="ot">132, 163</span><span class="co">]</span>]{.content-hidden when-profile="public"} (small/medium deviation is fine).</span>
<span id="cb69-666"><a href="#cb69-666"></a><span class="ss">  - </span>No answer</span>
<span id="cb69-667"><a href="#cb69-667"></a><span class="ss">  - </span>Answer is only partially correct.</span>
<span id="cb69-668"><a href="#cb69-668"></a><span class="ss">  - </span>Answers look correct.</span>
<span id="cb69-669"><a href="#cb69-669"></a></span>
<span id="cb69-670"><a href="#cb69-670"></a>::::</span>
<span id="cb69-671"><a href="#cb69-671"></a></span>
<span id="cb69-672"><a href="#cb69-672"></a><span class="fu"># Hierarchical model with BRMS (3p)</span></span>
<span id="cb69-673"><a href="#cb69-673"></a></span>
<span id="cb69-674"><a href="#cb69-674"></a></span>
<span id="cb69-675"><a href="#cb69-675"></a>:::{.callout-important}</span>
<span id="cb69-676"><a href="#cb69-676"></a></span>
<span id="cb69-677"><a href="#cb69-677"></a>We have made changes to the assignment text and some of the rubrics to make it clearer.</span>
<span id="cb69-678"><a href="#cb69-678"></a></span>
<span id="cb69-679"><a href="#cb69-679"></a>:::</span>
<span id="cb69-680"><a href="#cb69-680"></a></span>
<span id="cb69-681"><a href="#cb69-681"></a>The goal of this task is to discuss an alternative parameterisation of hierarchical models and introduce the <span class="in">`brms`</span>-package.</span>
<span id="cb69-682"><a href="#cb69-682"></a></span>
<span id="cb69-683"><a href="#cb69-683"></a><span class="co">[</span><span class="ot">`brms`</span><span class="co">](https://paul-buerkner.github.io/brms/)</span> is a high-level interface for Stan providing tools to create a wide range of Bayesian models, including hierarchical ones. In the previous section, you might have noted that with the hierarchical implementation of the model there may be divergent transitions during the sampling from the posterior. This is related to <span class="co">[</span><span class="ot">Neal's funnel</span><span class="co">](https://mc-stan.org/docs/stan-users-guide/reparameterization.html)</span>, where the sampling algorithm would need to change the step size in order to effectively sample the posterior. One trick to improve sampling is to use an alternative parameterisation for the model. This parameterisation is called the non-centered parameterisation (@eq-non-centered) and often it can help with the divergent transitions.</span>
<span id="cb69-684"><a href="#cb69-684"></a></span>
<span id="cb69-685"><a href="#cb69-685"></a>In short, we sample parameters from a distribution with a potentially easier geometry for the sampler to explore efficiently and then transform those values to the joint distribution of interest.</span>
<span id="cb69-686"><a href="#cb69-686"></a></span>
<span id="cb69-687"><a href="#cb69-687"></a>The noncentered parameterisation for the hierarchical model using the diet-wise helper parameter $z_d$ becomes</span>
<span id="cb69-688"><a href="#cb69-688"></a></span>
<span id="cb69-689"><a href="#cb69-689"></a>$$</span>
<span id="cb69-690"><a href="#cb69-690"></a>\begin{aligned}</span>
<span id="cb69-691"><a href="#cb69-691"></a>z_d &amp;\sim \operatorname{normal}(0, 1)&amp;&amp;\text{(diet-wise helper parameter)},<span class="sc">\\</span></span>
<span id="cb69-692"><a href="#cb69-692"></a>\mu_d &amp;= \mu + z_d \tau&amp;&amp;\text{(diet-wise mean weight)},<span class="sc">\\</span></span>
<span id="cb69-693"><a href="#cb69-693"></a>\mu &amp;\sim \pi(\mu)&amp;&amp;\text{(mean of prior for diet-wise mean weights),}<span class="sc">\\</span></span>
<span id="cb69-694"><a href="#cb69-694"></a>\tau &amp;\sim \pi(\tau)&amp;&amp;\text{(standard deviation of prior for diet-wise mean weights),}<span class="sc">\\</span></span>
<span id="cb69-695"><a href="#cb69-695"></a>\sigma &amp;\sim \pi(\sigma)&amp;&amp;\text{(standard deviation of diet-wise chicken weights) and},<span class="sc">\\</span></span>
<span id="cb69-696"><a href="#cb69-696"></a>w_{i, d} &amp;\sim \operatorname{normal}(\mu_d, \sigma)&amp;&amp;\text{(chicken weights)}.<span class="sc">\\</span></span>
<span id="cb69-697"><a href="#cb69-697"></a>\end{aligned}</span>
<span id="cb69-698"><a href="#cb69-698"></a>$$ {#eq-non-centered}</span>
<span id="cb69-699"><a href="#cb69-699"></a></span>
<span id="cb69-700"><a href="#cb69-700"></a>The hierarchical models made with <span class="in">`brms`</span> use this non-centered parameterisation. Your tasks are the following:</span>
<span id="cb69-701"><a href="#cb69-701"></a></span>
<span id="cb69-702"><a href="#cb69-702"></a>:::{.callout-warning icon=false title="Subtask 3.a)"}</span>
<span id="cb69-703"><a href="#cb69-703"></a>Use the function in the template to make a scatter plot of the posterior draws given the hierarchical model of the population level standard deviation parameter $\tau$ and the mean parameter of the fourth diet, $\mu_4$. The possible divergent transitions are highlighted in red. In the report show the plot and comment if there are any divergent transitions.</span>
<span id="cb69-704"><a href="#cb69-704"></a>:::</span>
<span id="cb69-705"><a href="#cb69-705"></a></span>
<span id="cb69-706"><a href="#cb69-706"></a>:::{.content-visible when-profile="public"}</span>
<span id="cb69-709"><a href="#cb69-709"></a><span class="in">```{r}</span></span>
<span id="cb69-710"><a href="#cb69-710"></a><span class="co">#| label: plot scatter centered parameterisation</span></span>
<span id="cb69-711"><a href="#cb69-711"></a></span>
<span id="cb69-712"><a href="#cb69-712"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_scatter</span>(<span class="at">x =</span> fit_hierarchical<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"mean_diet[4]"</span>, <span class="st">"sd_diets"</span>)),</span>
<span id="cb69-713"><a href="#cb69-713"></a>                        <span class="at">np =</span> <span class="fu">nuts_params</span>(fit_hierarchical)) <span class="sc">+</span></span>
<span id="cb69-714"><a href="#cb69-714"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb69-715"><a href="#cb69-715"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(mean_diet[<span class="dv">4</span>]), <span class="at">y =</span> <span class="fu">expression</span>(sd_diets)) <span class="sc">+</span></span>
<span id="cb69-716"><a href="#cb69-716"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>))</span>
<span id="cb69-717"><a href="#cb69-717"></a><span class="in">```</span></span>
<span id="cb69-718"><a href="#cb69-718"></a>:::</span>
<span id="cb69-719"><a href="#cb69-719"></a></span>
<span id="cb69-720"><a href="#cb69-720"></a>:::{.callout-note icon=false title="Rubric"}</span>
<span id="cb69-721"><a href="#cb69-721"></a><span class="ss">* </span>Is there a scatter plot of $\sigma_0$ and $\mu_4$ and some comments provided in the report?</span>
<span id="cb69-722"><a href="#cb69-722"></a><span class="ss">  - </span>No scatter plot or comments</span>
<span id="cb69-723"><a href="#cb69-723"></a><span class="ss">  - </span>The scatter plot is included, and divergent transitions are visible, but not commented on.</span>
<span id="cb69-724"><a href="#cb69-724"></a><span class="ss">  - </span>The scatter plot and comments on the divergences are included.</span>
<span id="cb69-725"><a href="#cb69-725"></a>:::</span>
<span id="cb69-726"><a href="#cb69-726"></a></span>
<span id="cb69-727"><a href="#cb69-727"></a>To sample from the posterior given the same model using <span class="in">`brms`</span>, in the template set the weakly informative priors for the hierarchical model you used in the previous task. <span class="in">`brms`</span> has an internal convention to name model parameters and the parameter names from @eq-non-centered map into <span class="in">`brms`</span> names with the following logic:</span>
<span id="cb69-728"><a href="#cb69-728"></a></span>
<span id="cb69-729"><a href="#cb69-729"></a><span class="ss"> - </span>$\mu$ corresponds to <span class="in">`class="Intercept"`</span></span>
<span id="cb69-730"><a href="#cb69-730"></a><span class="ss"> - </span>$\tau$ corresponds to <span class="in">`class="sd"`</span>,</span>
<span id="cb69-731"><a href="#cb69-731"></a><span class="ss"> - </span>$\sigma$ corresponds to <span class="in">`class="sigma"`</span>.</span>
<span id="cb69-732"><a href="#cb69-732"></a></span>
<span id="cb69-733"><a href="#cb69-733"></a></span>
<span id="cb69-734"><a href="#cb69-734"></a>:::{.callout-warning icon=false title="Subtask 3.b"}</span>
<span id="cb69-735"><a href="#cb69-735"></a>Replace <span class="in">`normal(0,10)`</span> in the <span class="in">`brm`</span> call in the template with your prior for the population mean</span>
<span id="cb69-736"><a href="#cb69-736"></a>$$\mu \sim \pi(\mu) = N(\mu_0,\sigma_0)$$</span>
<span id="cb69-737"><a href="#cb69-737"></a>you have derived in 2). Then, run the code chunk to sample from the posterior of the hierarchical model using <span class="in">`brms`</span>.</span>
<span id="cb69-738"><a href="#cb69-738"></a>:::</span>
<span id="cb69-739"><a href="#cb69-739"></a></span>
<span id="cb69-740"><a href="#cb69-740"></a>:::{.content-visible when-profile="public"}</span>
<span id="cb69-741"><a href="#cb69-741"></a>**Create a brms model and sample from the posterior**</span>
<span id="cb69-742"><a href="#cb69-742"></a></span>
<span id="cb69-745"><a href="#cb69-745"></a><span class="in">```{r}</span></span>
<span id="cb69-746"><a href="#cb69-746"></a><span class="co">#| label: fit brms model</span></span>
<span id="cb69-747"><a href="#cb69-747"></a><span class="co">#| output: false</span></span>
<span id="cb69-748"><a href="#cb69-748"></a>brms_fit <span class="ot">=</span> <span class="fu">brm</span>(</span>
<span id="cb69-749"><a href="#cb69-749"></a>  weight <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Diet),</span>
<span id="cb69-750"><a href="#cb69-750"></a>  <span class="at">data=</span>Chick12,</span>
<span id="cb69-751"><a href="#cb69-751"></a>  <span class="at">prior=</span><span class="fu">c</span>(</span>
<span id="cb69-752"><a href="#cb69-752"></a>    <span class="co"># REPLACE WITH YOUR PRIOR DERIVED in 2)</span></span>
<span id="cb69-753"><a href="#cb69-753"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">class=</span><span class="st">"Intercept"</span>),</span>
<span id="cb69-754"><a href="#cb69-754"></a>    <span class="co"># YOU CAN LEAVE THE BELOW PRIORS</span></span>
<span id="cb69-755"><a href="#cb69-755"></a>    <span class="fu">prior</span>(<span class="fu">exponential</span>(.<span class="dv">02</span>), <span class="at">class=</span><span class="st">"sd"</span>),</span>
<span id="cb69-756"><a href="#cb69-756"></a>    <span class="fu">prior</span>(<span class="fu">exponential</span>(.<span class="dv">02</span>), <span class="at">class=</span><span class="st">"sigma"</span>)</span>
<span id="cb69-757"><a href="#cb69-757"></a>  ),</span>
<span id="cb69-758"><a href="#cb69-758"></a>  <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb69-759"><a href="#cb69-759"></a>  <span class="at">save_pars =</span> <span class="fu">save_pars</span>(<span class="at">manual =</span> <span class="fu">c</span>(<span class="st">"z_1[1,4]"</span>))</span>
<span id="cb69-760"><a href="#cb69-760"></a>)</span>
<span id="cb69-761"><a href="#cb69-761"></a><span class="in">```</span></span>
<span id="cb69-762"><a href="#cb69-762"></a>:::</span>
<span id="cb69-763"><a href="#cb69-763"></a></span>
<span id="cb69-764"><a href="#cb69-764"></a>::: {.callout-note icon=false title="Rubric"}</span>
<span id="cb69-765"><a href="#cb69-765"></a><span class="ss">* </span>Is the <span class="in">`brms`</span> code shown and do the priors agree with the priors specified above?</span>
<span id="cb69-766"><a href="#cb69-766"></a>:::</span>
<span id="cb69-767"><a href="#cb69-767"></a></span>
<span id="cb69-768"><a href="#cb69-768"></a>:::{.callout-warning icon=false title="Subtask 3.c"}</span>
<span id="cb69-769"><a href="#cb69-769"></a>Report the **posterior expectation for the mean weight of diet 4 $\mu_4$ with a 90% credible interval**, using the code block in the template. How does it compare with your results from the first task?</span>
<span id="cb69-770"><a href="#cb69-770"></a>:::</span>
<span id="cb69-771"><a href="#cb69-771"></a></span>
<span id="cb69-772"><a href="#cb69-772"></a>:::{.content-visible when-profile="public"}</span>
<span id="cb69-775"><a href="#cb69-775"></a><span class="in">```{r}</span></span>
<span id="cb69-776"><a href="#cb69-776"></a><span class="co">#| label: transformed posterior draws from brms</span></span>
<span id="cb69-777"><a href="#cb69-777"></a><span class="co"># Draws for mu_4</span></span>
<span id="cb69-778"><a href="#cb69-778"></a>mu_4 <span class="ot">=</span> <span class="fu">posterior_epred</span>(brms_fit, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">Diet=</span><span class="dv">4</span>))</span>
<span id="cb69-779"><a href="#cb69-779"></a></span>
<span id="cb69-780"><a href="#cb69-780"></a><span class="co"># Compute the mean, and quantiles. Remember to round your answers accordingly.</span></span>
<span id="cb69-781"><a href="#cb69-781"></a><span class="co"># ...</span></span>
<span id="cb69-782"><a href="#cb69-782"></a><span class="in">```</span></span>
<span id="cb69-783"><a href="#cb69-783"></a>:::</span>
<span id="cb69-784"><a href="#cb69-784"></a></span>
<span id="cb69-785"><a href="#cb69-785"></a>::: {.callout-note icon=false title="Rubric"}</span>
<span id="cb69-786"><a href="#cb69-786"></a><span class="ss">* </span>Given the <span class="in">`brms`</span> model, is the posterior 90% credible interval for the mean of the fourth diet close to: <span class="co">[</span><span class="ot">132, 162</span><span class="co">]</span>{.content-hidden when-profile="public"}(small/medium deviation is fine).</span>
<span id="cb69-787"><a href="#cb69-787"></a><span class="ss">  - </span>No answer</span>
<span id="cb69-788"><a href="#cb69-788"></a><span class="ss">  - </span>Answer is only partially correct.</span>
<span id="cb69-789"><a href="#cb69-789"></a><span class="ss">  - </span>Answers look correct.</span>
<span id="cb69-790"><a href="#cb69-790"></a>:::</span>
<span id="cb69-791"><a href="#cb69-791"></a></span>
<span id="cb69-792"><a href="#cb69-792"></a>:::{.callout-warning icon=false title="Subtask 3.d"}</span>
<span id="cb69-793"><a href="#cb69-793"></a>Use the code in the template to make a **scatter plot of the group standard deviation parameter $\tau$ and group specific mean parameter**.</span>
<span id="cb69-794"><a href="#cb69-794"></a>:::</span>
<span id="cb69-795"><a href="#cb69-795"></a></span>
<span id="cb69-796"><a href="#cb69-796"></a>:::{.content-visible when-profile="public"}</span>
<span id="cb69-797"><a href="#cb69-797"></a>Due the non-centered parametrization, we need to transform compute the $\mu_d$ term as the sum of the population intercept and the group specific deviation from the intercept. You can choose which diet to plot by modifying the <span class="in">`d`</span> integer in <span class="in">`r_Diet[d,Intercept]`</span>.</span>
<span id="cb69-800"><a href="#cb69-800"></a><span class="in">```{r}</span></span>
<span id="cb69-801"><a href="#cb69-801"></a><span class="co">#| label: plot scatter non-centered parameterisation</span></span>
<span id="cb69-802"><a href="#cb69-802"></a></span>
<span id="cb69-803"><a href="#cb69-803"></a>draws <span class="ot">=</span> <span class="fu">as_draws_df</span>(brms_fit) <span class="sc">|&gt;</span></span>
<span id="cb69-804"><a href="#cb69-804"></a>  posterior<span class="sc">::</span><span class="fu">mutate_variables</span>(<span class="at">mean_diet_4 =</span> <span class="st">`</span><span class="at">r_Diet[4,Intercept]</span><span class="st">`</span> <span class="sc">+</span> b_Intercept)</span>
<span id="cb69-805"><a href="#cb69-805"></a></span>
<span id="cb69-806"><a href="#cb69-806"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_scatter</span>(draws,</span>
<span id="cb69-807"><a href="#cb69-807"></a>                        <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"mean_diet_4"</span>, <span class="st">"sd_Diet__Intercept"</span>),</span>
<span id="cb69-808"><a href="#cb69-808"></a>                        <span class="at">np =</span> <span class="fu">nuts_params</span>(brms_fit)) <span class="sc">+</span></span>
<span id="cb69-809"><a href="#cb69-809"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb69-810"><a href="#cb69-810"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(mean_diet[<span class="dv">4</span>])) <span class="sc">+</span></span>
<span id="cb69-811"><a href="#cb69-811"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(sd_diets))</span>
<span id="cb69-812"><a href="#cb69-812"></a></span>
<span id="cb69-813"><a href="#cb69-813"></a><span class="in">```</span></span>
<span id="cb69-814"><a href="#cb69-814"></a>:::</span>
<span id="cb69-815"><a href="#cb69-815"></a></span>
<span id="cb69-816"><a href="#cb69-816"></a>::: {.callout-note icon=false title="Rubric"}</span>
<span id="cb69-817"><a href="#cb69-817"></a><span class="ss">* </span>Is there a scatter plot of $\tau$ and $\mu_4$ and some comments provided in the report?</span>
<span id="cb69-818"><a href="#cb69-818"></a><span class="ss">  - </span>No scatter plot or comments</span>
<span id="cb69-819"><a href="#cb69-819"></a><span class="ss">  - </span>The scatter plot is included, and divergent transitions are visible, but not commented on.</span>
<span id="cb69-820"><a href="#cb69-820"></a><span class="ss">  - </span>The scatter plot and comments on the divergences are included.</span>
<span id="cb69-821"><a href="#cb69-821"></a>:::</span>
<span id="cb69-822"><a href="#cb69-822"></a></span>
<span id="cb69-823"><a href="#cb69-823"></a>:::{.callout-warning icon=false title="Subtask 3.e"}</span>
<span id="cb69-824"><a href="#cb69-824"></a>In your report, address the following questions based on the plots you made for both parameterisations:</span>
<span id="cb69-825"><a href="#cb69-825"></a></span>
<span id="cb69-826"><a href="#cb69-826"></a><span class="ss"> - </span>Which of the parameterisations resulted in fewer divergent transitions?</span>
<span id="cb69-827"><a href="#cb69-827"></a><span class="ss"> - </span>Comment for both parameterisations: for which kind of values of $\tau$, do the divergent transitions occur (if there are any)? It also might be that no clear pattern can be seen.</span>
<span id="cb69-828"><a href="#cb69-828"></a><span class="ss"> - </span>Does centered parameterisation have problems sampling from some specific region of the parameter space compared to the non-centered parameterisation.</span>
<span id="cb69-829"><a href="#cb69-829"></a>:::</span>
<span id="cb69-830"><a href="#cb69-830"></a>::: {.callout-note icon=false title="Rubric"}</span>
<span id="cb69-831"><a href="#cb69-831"></a><span class="ss">* </span>Has it been discussed which parameterisation resulted in fewer divergent transitions?</span>
<span id="cb69-832"><a href="#cb69-832"></a><span class="ss">* </span>Has it been discussed for which values of $\tau$ the divergences occurred?</span>
<span id="cb69-833"><a href="#cb69-833"></a><span class="ss">* </span>Has it been discussed whether/where the centered parameterisation has problems sampling?</span>
<span id="cb69-834"><a href="#cb69-834"></a>:::</span>
<span id="cb69-835"><a href="#cb69-835"></a></span>
<span id="cb69-836"><a href="#cb69-836"></a>{{&lt; include includes/_overall_quality.md &gt;}}</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>