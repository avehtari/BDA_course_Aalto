<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aki Vehtari et al.">

<title>Assignment 8 – Bayesian Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./assignment9.html" rel="next">
<link href="./assignment7.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-3b41dc0f5e1034f3961de186a2aad809.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script>


</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignment1.html">Assignments</a></li><li class="breadcrumb-item"><a href="./assignment8.html">Assignment 8</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bayesian Data Analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">General instructions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment_instructions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment instructions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment8.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Assignment 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 9</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Templates</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 9</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#general-information" id="toc-general-information" class="nav-link active" data-scroll-target="#general-information"><span class="header-section-number">1</span> General information</a>
  <ul class="collapse">
  <li><a href="#assignment-questions" id="toc-assignment-questions" class="nav-link" data-scroll-target="#assignment-questions"><span class="header-section-number">1.1</span> Assignment questions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignment1.html">Assignments</a></li><li class="breadcrumb-item"><a href="./assignment8.html">Assignment 8</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Assignment 8</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Aki Vehtari et al. </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="general-information" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> General information</h1>
<p>The exercises here refer to the lecture 8-9/BDA chapter 7 content.</p>
<p><strong>The exercises constitute 96% of the Quiz 8 grade.</strong></p>
<p>We prepared a quarto notebook specific to this assignment to help you get started. <u>You still need to fill in your answers on Mycourses!</u> You can inspect this and future templates</p>
<ul>
<li>as a <a href="template8.html">rendered html file</a> (to access the qmd file click the “&lt;/&gt; Code” button at the top right hand corner of the template)</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>General Instructions for Answering the Assignment Questions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Questions below are exact copies of the text found in the MyCourses quiz and should serve as a notebook where you can store notes and code.</li>
<li>We recommend opening these notebooks in the Aalto JupyterHub, see <a href="https://avehtari.github.io/BDA_course_Aalto/FAQ.html#How_to_use_R_and_RStudio_remotely"><strong>how to use R and RStudio remotely</strong></a>.</li>
<li>For inspiration for code, have a look at the <a href="https://avehtari.github.io/BDA_course_Aalto/demos.html"><strong>BDA R Demos</strong></a> and the specific Assignment code notebooks</li>
<li>Recommended additional self study exercises for each chapter in BDA3 are listed in the course web page. These will help to gain deeper understanding of the topic.</li>
<li>Common questions and answers regarding installation and technical problems can be found in <a href="https://avehtari.github.io/BDA_course_Aalto/FAQ.html">Frequently Asked Questions (FAQ)</a>.</li>
<li>Deadlines for all assignments can be found on the course web page and in MyCourses.</li>
<li>You are allowed to discuss assignments with your friends, but it is not allowed to copy solutions directly from other students or from internet.</li>
<li>Do not share your answers publicly.</li>
<li>Do not copy answers from the internet or from previous years. We compare the answers to the answers from previous years and to the answers from other students this year.</li>
<li>Use of AI is allowed on the course, but the most of the work needs to by the student, and you need to report whether you used AI and in which way you used them (See <a href="https://www.aalto.fi/en/services/guidance-for-the-use-of-artificial-intelligence-in-teaching-and-learning-at-aalto-university">points 5 and 6 in Aalto guidelines for use of AI in teaching</a>).</li>
<li>All suspected plagiarism will be reported and investigated. See more about the <a href="https://into.aalto.fi/display/ensaannot/Aalto+University+Code+of+Academic+Integrity+and+Handling+Violations+Thereof"><strong>Aalto University Code of Academic Integrity and Handling Violations Thereof</strong></a>.</li>
<li>If you have any suggestions or improvements to the course material, please post in the course chat feedback channel, create an issue, or submit a pull request to the public repository!</li>
<li>The decimal separator throughout the <strong>whole course</strong> is a dot, “.” (Follows English language convention). Please be aware that MyCourses will not accept numerical value answers with “,” as a decimal separator</li>
<li><u><strong>Unless stated otherwise</strong></u>: if the question instructions ask for reporting of numerical values in terms of the ith decimal digit, round to the ith decimal digit. For example, 0.0075 for two decimal digits should be reported as 0.01. More on this in Assignment 4.</li>
</ul>
</div>
</div>
</div>
<section id="assignment-questions" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="assignment-questions"><span class="header-section-number">1.1</span> Assignment questions</h2>
<p>For convenience the assignment questions are copied below. Answer the questions in MyCourses.</p>
<p></p>
<h1 id="lecture-8-9chapter-7-of-bda-quiz-96-of-grade">Lecture 8-9/Chapter 7 of
  BDA Quiz (96% of grade)</h1>
<p>This week’s assignment focuses on hierarchical models and modelling with
  brms.</p>
<h1 id="elpd">1. ELPD</h1>
<p>In order to evaluate a model, for comparison to other models or for model
  checking purposes, it is useful to measure how well predictions match the
  data. Preferably, the measure of predictive accuracy is tailored to the
  data-application (application specific cost-function or decision theoretic
  quantity, discussed more next week). But in the absence of that, we might
  choose from a range of scoring functions or rules mentioned in the
  lecture/book (see for more details on general scoring functions or rules in <a href="https://sites.stat.washington.edu/raftery/Research/PDF/Gneiting2007jasa.pdf">Gneiting
    and Raftery (2007)</a>). For the below denote the target as <span class="math inline">\(y\)</span> and potential covariates as <span class="math inline">\(x\)</span>.</p>
<p><strong>1.1</strong> Which expression below defines the log-score for
  observation <span class="math inline">\(y_i\)</span>?</p>
<p><strong>1.2</strong> Why is the log-score a convenient scoring rule?</p>
<p><strong>1.3</strong> Denote by <span class="math inline">\(\tilde{y}\)</span>
  unseen target data with distribution <span class="math inline">\(p_t(\tilde{y})\)</span> and by <span class="math inline">\(y\)</span> target data that is conditioned on for
  posterior inference on model parameters. Which of the following refers to the
  expected log-predictive density for new data points <span class="math inline">\(\tilde{y}_1\dotsc,\tilde{y}_n\)</span>?</p>
<p><strong>1.4</strong> Suppose <span class="math inline">\(\tilde{y} =
    y\)</span>, then elpd reduces to the log point-wise predictive densities
  (lpd) for observations <span class="math inline">\(y_1,\dotsc,y_n\)</span>.
  Why is lpd often a bad estimate for elpd?</p>
<p><strong>1.5</strong> We often use leave-one-out cross-validation (LOO-CV) to
  approximate out-of-sample performance. Denote by <span class="math inline">\(y_{−i}\)</span> all but the ith observation for <span class="math inline">\(y\)</span> and by <span class="math inline">\(\int
    p(y_i\mid\theta)\,p(\theta\mid y_{-i})\,\mathrm{d}\theta\)</span> the
  posterior predictive distribution for the ith data point based on data leaving
  out the ith data point. Which of the expressions below refers to the Bayesian
  LOO-CV estimate of the out-of-sample predictive fit <span class="math inline">\(\mathrm{elpd}_{\mathrm{LOO}}\)</span>?</p>
<p><strong>1.6</strong> Instead of computing the LOO predictive densities n
  times for n left-out observations, a computationally much more efficient
  approach is to fit the model once and use importance sampling to approximate
  the n LOO densities in <span class="math inline">\(\mathrm{elpd}_{\mathrm{LOO}}\)</span>. Which of the
  below refers to the importance sampling estimate of <span class="math inline">\(\mathrm{elpd}_{\mathrm{LOO}}\)</span>? Assume <span class="math inline">\(\sum^S_{r=1}\tilde{w}_i^{(r)}=1\)</span> for all <span class="math inline">\(i\)</span>.</p>
<p><strong>1.7</strong> Use <span class="math inline">\(p(\theta \mid
    x,y)\)</span> as the proposal distribution for <span class="math inline">\(p(\theta \mid x_{−i},y_{−i})\)</span>. Derive the
  expression for the unnormalised importance weights <span class="math inline">\(w^{(s)}i\)</span> (up to a constant of
  proportionality), assuming that the likelihood conditional on <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>
  can be factorised by <span class="math inline">\(i=1,\dotsc,n\)</span>. Which
  of the below is proportional to the desired importance weight draw for the
  <span class="math inline">\(s\)</span>-th draw of the posterior and
  observation <span class="math inline">\(i\)</span>?</p>
<p><strong>1.8</strong> Derive the expression for the self-normalised importance
  sampling estimator with the weights derived in 1.7. Which of the below is
  correct?</p>
<p>The importance sampling estimator can also be extended to other scoring
  functions/rules. In particular, it will be of advantage for the projects to
  review the <span class="math inline">\(R^2\)</span> (coefficients of
  determination), Root-mean-squared-error (RMSE) which measure relative variance
  fit and point predictive accuracy respectively, as well as the Probability
  Integral Transform (PIT), and their associated cross-validated variants. These
  are easily implemented with BRMS fit objects. See the <a href="https://cran.r-project.org/web/packages/brms/brms.pdf">BRMS manual</a>
  as well as the Bayes <span class="math inline">\(R^2\)</span> <a href="https://avehtari.github.io/bayes_R2/bayes_R2.html">case study</a>
  further details on implementation for some of these.</p>
<p>ELPD assesses predictions in terms of the sharpness (concentration) (<a href="https://projecteuclid.org/journals/statistics-surveys/volume-6/issue-none/A-survey-of-Bayesian-predictive-methods-for-model-assessment-selection/10.1214/12-SS102.full">for
    log-score this is related to negative entropy</a>), as well as calibration
  (coverage) of the predictive distribution. Sharpness of the predictive
  distribution is rewarded since narrow predictive distributions have higher
  densities. On the other hand, too narrow distributions have high density in
  too narrow region, and lower density elsewhere. The probability intervals
  (e.g.&nbsp;central intervals) cumulative density functions of a calibrated
  distribution match the distribution of the target. It is possible that two
  different models are both well calibrated, but they have different sharpness,
  for example, if one of the models has additional covariate which helps to
  reduce the predictive uncertainty. In the below we will further discuss how to
  visually assess calibration. This belongs to the posterior predictive checks
  discussed during the lecture, and are useful to check first before formally
  evaluating models with ELPD (and other scoring functions/rules).</p>
<p><strong>1.9</strong> We can measure calibration by transforming the
  comparison between an observation and the conditional predictive distribution
  to a value between <span class="math inline">\([0,1]\)</span>. Define <span class="math inline">\(y^{\mathrm{rep}}_i\)</span> as a draw from the
  predictive distribution <span class="math inline">\(p(\tilde{y}_i\mid
    y_i)\)</span>, which transformation should we use?</p>
<p><strong>1.10</strong> This transformation is called the probability integral
  transform (PIT). How should the PITs be distributed with infinite data, if the
  predictive distribution is correctly calibrated?</p>
<p>When dealing with finite data, we can only hope to be close enough to uniform
  and you can use the <code>ppc_loo_pit_overlay()</code> function from bayesplot
  to visually check for the posterior uncertainty in the (cross-validated) PIT
  values.</p>
<p>Instead of looking at the distribution of PIT values, it can be easier to
  examine the cumulative distribution function of the PIT values, which should
  be close to a 45-degree line, since the large sample distribution is uniform.
  The below is taken from <a href="https://avehtari.github.io/BDA_R_demos/demos_rstan/brms_demo.html">the
    BRMS demo 13</a>.</p>
<p>Suppose the kernel density estimates of the predictive distribution and data
  look the following:</p>
<div class="figure"><img style="width: 50.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/refs/heads/master/figures/Quizzes/predictive_kernel1.png" alt="">
  <p class="caption">Figure 1</p>
</div>
<p><strong>1.11</strong> What can you say about calibration from this model for
  the data?</p>
<p><strong>1.12</strong> Based on the model in Figure 1, which of the plots
  below match the ECDF plot (light blue envelope indicates regions of acceptable
  ECDF values)?</p>
<div class="figure"><img style="width: 50.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/refs/heads/master/figures/Quizzes/ecdf1.png" alt="">
  <p class="caption">Figure 2</p>
</div>
<div class="figure"><img style="width: 50.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/refs/heads/master/figures/Quizzes/ecdf2.png" alt="">
  <p class="caption">Figure 3</p>
</div>
<p>Suppose the revised model produces the following predictive distribution:</p>
<div class="figure"><img style="width: 50.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/refs/heads/master/figures/Quizzes/predictive_kernel2.png" alt="">
  <p class="caption">Figure 4</p>
</div>
<p><strong>1.14</strong> Based on the model in Figure 4, which of the plots
  below match the ECDF plot (light blue envelope indicates regions of acceptable
  ECDF values)?</p>
<div class="figure"><img style="width: 50.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/refs/heads/master/figures/Quizzes/ecdf1.png" alt="">
  <p class="caption">Figure 5</p>
</div>
<div class="figure"><img style="width: 50.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/refs/heads/master/figures/Quizzes/ecdf2.png" alt="">
  <p class="caption">Figure 6</p>
</div>
<p><strong>2.2</strong> Assuming that importance weights have finite variance
  and mean, we can use the standard CLT to guarantee variance reduction at rate
  1/S, where S is the number of MCMC draws. Different CLTs can be applied
  depending on the existence of certain fractional moments (fractional moments
  are more general than integer moments and are useful in describing properties
  of fat-tailed distributions). To estimate the number of fractional moments of
  the weights, we can model the tails of the importance weights using insights
  of extreme value theory (<a href="https://www.jstor.org/stable/2958083?casa_token=quT8q7BWXIcAAAAA%3ALzyVeQUR6xs7OuLOQlyqZE4zj18ajlZ7TBWkRDmSEWAkZskNwfPW3IaZkHeigJRx7CKYZoWw2A0jVO5RLCP1c1dz3L6qZiVLRegko4O8JX8XEaeUyo31">Pickands,
    1975</a>). What distribution can be used to estimate the number of
  fractional moments?</p>
<p>We refer to the estimated value of 1/k as the k-hat value reported as a
  diagnostic in the loo package. Since most distributions have tails that are
  well approximated by GDP, we can replace tail weights of the importance weight
  distribution with the expected ordered statistics of the fitted GDP. In the
  context of LOO, we refer to this as Pareto smoothed importance sampling
  (PSIS-LOO).</p>
<p><strong>2.3</strong> What is the rationale of replacing largest weights by
  the expected ordered statistics of the fitted GDP?</p>
<p><strong>2.4</strong> Based on the above, suppose importance weights follow a
  standard Cauchy distribution. What k-hat value do you expect with sufficiently
  large number of draws?</p>
<p><strong>2.7</strong> What are common causes for large k-hats within the
  context of PSIS loo?</p>
<p><strong>2.8</strong> What should you consider doing if you have high k-hat
  values?</p>
<h1 id="sleep-study">3. Sleep study</h1>
<p>In Assignment 7, you fit two different models to the sleepstudy dataset. One
  with varying intercepts per person and one with varying intercepts and slopes.
  In this exercise you will perform visual checks and leave-one-out
  cross-validation on these models.</p>
<p>First, perform the following steps for the varying intercept model. This
  model allows for different Subjects to have different baseline Reaction times
  (before sleep deprivation).</p>
<p>Use <code>pp_check(fit)</code> to create the default density overlay plot.
</p>
<p><strong>3.1</strong> Which of the following best describes the interpretation
  of the plot?</p>
<p>Next try a different plot of the predictions: <code>pp_check(fit, type =
    "intervals_grouped", x = "Days", group = "Subject")</code></p>
<p><strong>3.2</strong> What does the plot present?</p>
<p><strong>3.3</strong> Based on the plot, what can you say about how the model
  predicts the observations of individual Subjects?</p>
<p>Next, use PSIS-LOO CV to estimate the elpd of the varying intercepts model.
</p>
<p><strong>3.4</strong> The elpd_loo estimate for the varying intercepts model
  is  and the standard error estimate is
  .</p>
<p>The second model estimates varying intercepts and varying slopes. This model
  allows for different effects of Days for each Subject.</p>
<p>Plot again the default density plot of predictions using
  <code>pp_check()</code></p>
<p><strong>3.5</strong> Which best describes the plot:</p>
<p>Perform PSIS-LOO CV to estimate elpd_loo for the varying intercepts and
  slopes model. You may find that there are high Pareto-k values. These can be
  fixed with importance weighted moment matching at the cost of some
  computation, but in this case the elpd_loo will change negligibly with the
  improved estimates.</p>
<p><strong>3.6</strong> The elpd_loo estimate for the varying slopes and
  intercepts model is  and the standard error estimate is
  .</p>
<p>So far you have only performed visual posterior checks to compare the models.
  However, another option is to compare the leave-one-out cross validation
  values between the models. Use <code>loo_compare()</code> to calculate the
  elpd_diff between the two models.</p>
<p><strong>3.7</strong> The elpd_diff estimate is (enter as negative value as
  shown in the loo_compare output)  and the standard error
  is .</p>
<p><strong>3.8</strong>: Which of these best describes the conclusions from the
  loo comparison:</p>
<h1 id="sleep-study-extensions">4. Sleep study extensions</h1>
<p>So far you only compared the two models that were fit in the previous week.
  But modelling is an iterative process, and additional features of the data can
  be modelled. Next, you will add three extensions to the previous models, which
  you may have thought about already: (1) Reaction times are known to be
  positively skewed (2) There could be a non-linear relationship between Days
  and Reaction time (3) As seen in the previous assignment, there are likely
  some outliers for some groups.</p>
<p>The first issue can be tackled by changing the observation family to a
  positively skewed distribution, such as log-normal. As this transforms the
  interpretation of the coefficients, the priors should be updated. Use the
  following priors with the lognormal observation family:</p>
<p><span class="math inline">\(\alpha_0 \sim
    \mathrm{normal}(\log(250),1)\)</span></p>
<p><span class="math inline">\(\beta_0\sim \mathrm{normal}(0,1)\)</span></p>
<p><span class="math inline">\(\sigma\sim\mathrm{normal}(0,2)\)</span></p>
<p><span class="math inline">\(\alpha_j\sim\mathrm{normal}(0,\tau_{\alpha})\)</span>
</p>
<p><span class="math inline">\(\beta_j\sim\mathrm{normal}(0,\tau_{\beta})\)</span>
</p>
<p><span class="math inline">\(\tau_{\alpha}\sim\mathrm{normal}(0,1)\)</span>
</p>
<p><span class="math inline">\(\tau_{\beta}\sim\mathrm{normal}(0,1)\)</span></p>
<p>Fit the varying slopes and intercept model with lognormal family.</p>
<p><strong>4.1</strong> Plot the default <code>pp_check()</code>. What do you
  notice?</p>
<p>Estimate the elpd_loo for the lognormal model.</p>
<p><strong>4.2</strong> The elpd_loo estimate for the lognormal model is
  , and the standard error estimate is
  .</p>
<p><strong>4.3</strong> How does this compare to the other models with respect
  to LOO-CV? </p>
<p>Next, to address potential non-linear effect with respect to Days, you can
  try with a spline term for Days. This allows for a non-linear population-level
  effect of Days on Reaction time. Add the term <code>s(Days)</code> to the
  formula for the lognormal model, and compare to the other models using
  pp_check and loo_compare. Use a normal(0, 1) prior on the <code>sDays_1</code>
  term.</p>
<p><strong>4.4</strong> Based on elpd_loo comparison: </p>
<p><strong>4.5</strong> To make inference robust to outliers, we could instead
  change the observation model to the student-t. Keep <code>s(Days)</code> in
  the model without specifying a prior for <code>sDays_1</code> (the default is
  a student_t prior in brms and in this case good enough) as well as the varying
  intercept and slope. Use the default prior (<code>gamma(2,0.1)</code>) in brms
  for the degrees of freedom. Do you find evidence for fat-tails? What is the
  posterior estimate of the degrees of freedom parameter <span class="math inline">\(\nu\)</span>? </p>
<p><strong>4.6</strong> The elpd_loo estimate of the student-t model is:
  </p>
<p><strong>4.7</strong> Plot the <code>conditional_effect()</code> (as in
  Assigment 7) for the student-t model. What do you observe in comparison to the
  normal conditional effects? </p>
<p><strong>4.8</strong> Based on elpd_loo, the order of the 5 models from best
  to worst predictive performance is: </p>
<p></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./assignment7.html" class="pagination-link" aria-label="Assignment 7">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Assignment 7</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./assignment9.html" class="pagination-link" aria-label="Assignment 9">
        <span class="nav-page-text">Assignment 9</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>