<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aki Vehtari et al.">

<title>Assignment 6 – Bayesian Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./assignment7.html" rel="next">
<link href="./assignment5.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-3b41dc0f5e1034f3961de186a2aad809.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script>


</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignment1.html">Assignments</a></li><li class="breadcrumb-item"><a href="./assignment6.html">Assignment 6</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">General instructions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment_instructions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment instructions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment6.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Assignment 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 9</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Templates</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 9</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#general-information" id="toc-general-information" class="nav-link active" data-scroll-target="#general-information"><span class="header-section-number">1</span> General information</a>
  <ul class="collapse">
  <li><a href="#assignment-questions" id="toc-assignment-questions" class="nav-link" data-scroll-target="#assignment-questions"><span class="header-section-number">1.1</span> Assignment questions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignment1.html">Assignments</a></li><li class="breadcrumb-item"><a href="./assignment6.html">Assignment 6</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Assignment 6</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Aki Vehtari et al. </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="general-information" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> General information</h1>
<p>The exercises here refer to the lecture 6/BDA chapter 12 content. The main topics for this assignment are the MCSE and importance sampling.</p>
<p><strong>The exercises constitute 96% of the Quiz 6 grade.</strong></p>
<p>We prepared a quarto notebook specific to this assignment to help you get started. <u>You still need to fill in your answers on Mycourses!</u> You can inspect this and future templates</p>
<ul>
<li>as a <a href="template6.html">rendered html file</a> (to access the qmd file click the “&lt;/&gt; Code” button at the top right hand corner of the template)</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>General Instructions for Answering the Assignment Questions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Questions below are exact copies of the text found in the MyCourses quiz and should serve as a notebook where you can store notes and code.</li>
<li>We recommend opening these notebooks in the Aalto JupyterHub, see <a href="https://avehtari.github.io/BDA_course_Aalto/FAQ.html#How_to_use_R_and_RStudio_remotely"><strong>how to use R and RStudio remotely</strong></a>.</li>
<li>For inspiration for code, have a look at the <a href="https://avehtari.github.io/BDA_course_Aalto/demos.html"><strong>BDA R Demos</strong></a> and the specific Assignment code notebooks</li>
<li>Recommended additional self study exercises for each chapter in BDA3 are listed in the course web page. These will help to gain deeper understanding of the topic.</li>
<li>Common questions and answers regarding installation and technical problems can be found in <a href="https://avehtari.github.io/BDA_course_Aalto/FAQ.html">Frequently Asked Questions (FAQ)</a>.</li>
<li>Deadlines for all assignments can be found on the course web page and in MyCourses.</li>
<li>You are allowed to discuss assignments with your friends, but it is not allowed to copy solutions directly from other students or from internet.</li>
<li>Do not share your answers publicly.</li>
<li>Do not copy answers from the internet or from previous years. We compare the answers to the answers from previous years and to the answers from other students this year.</li>
<li>Use of AI is allowed on the course, but the most of the work needs to by the student, and you need to report whether you used AI and in which way you used them (See <a href="https://www.aalto.fi/en/services/guidance-for-the-use-of-artificial-intelligence-in-teaching-and-learning-at-aalto-university">points 5 and 6 in Aalto guidelines for use of AI in teaching</a>).</li>
<li>All suspected plagiarism will be reported and investigated. See more about the <a href="https://into.aalto.fi/display/ensaannot/Aalto+University+Code+of+Academic+Integrity+and+Handling+Violations+Thereof"><strong>Aalto University Code of Academic Integrity and Handling Violations Thereof</strong></a>.</li>
<li>If you have any suggestions or improvements to the course material, please post in the course chat feedback channel, create an issue, or submit a pull request to the public repository!</li>
<li>The decimal separator throughout the <strong>whole course</strong> is a dot, “.” (Follows English language convention). Please be aware that MyCourses will not accept numerical value answers with “,” as a decimal separator</li>
<li><u><strong>Unless stated otherwise</strong></u>: if the question instructions ask for reporting of numerical values in terms of the ith decimal digit, round to the ith decimal digit. For example, 0.0075 for two decimal digits should be reported as 0.01. More on this in Assignment 4.</li>
</ul>
</div>
</div>
</div>
<section id="assignment-questions" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="assignment-questions"><span class="header-section-number">1.1</span> Assignment questions</h2>
<p>For convenience the assignment questions are copied below. Answer the questions in MyCourses.</p>
<p></p>
<h1 id="lecture-6chapter-12-of-bda-quiz-96-of-grade">Lecture 6/Chapter 12 of BDA
  Quiz (96% of grade)</h1>
<p>This week’s assignment focuses on building the foundations for using frontier
  MCMC methods and the probabilistic programming language Stan. We will directly
  code in Stan, but later assignments will use the <a href="https://paulbuerkner.com/brms/">brms</a> R package for building Stan
  models.</p>
<h1 id="a-brief-overview-of-hamiltonian-monte-carlo-hmc">1. A brief overview of
  Hamiltonian Monte Carlo (HMC)</h1>
<p><strong>1.1</strong> What is the intuition behind HMC as described in the
  course lectures?</p>
<p>In order to generate good proposals, HMC uses the Hamiltonian function and
  it’s partial derivatives to generate a path along the surface of the log
  posterior. As in the lecture, define <span class="math inline">\(\phi\)</span>
  as the momentum variable which is of the same dimension as the parameter
  vector <span class="math inline">\(\theta\)</span>. The Hamiltonian function
  has two terms <span class="math inline">\(U(\theta)\)</span> and <span class="math inline">\(K(\phi)\)</span>.</p>
<p><strong>1.2</strong> What is the intuition behind the term <span class="math inline">\(U(\theta)\)</span></p>
<p><strong>1.3</strong> What is the intuition behind the term <span class="math inline">\(K(\phi)\)</span></p>
<p><strong>1.4</strong> The partial derivatives of the Hamiltonian, also known
  as Hamilton’s equations, determine how <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\phi\)</span> change during MCMC. What problem occurs
  when implementing Hamilton’s equations computationally?</p>
<p><strong>1.5</strong> All HMC implementations on a digital computer need to
  discretise the simulated trajectory dictated by Hamilton’s equations. Which
  computational method does Stan (and most other HMC-based algorithms) use for
  discretisation?</p>
<p><strong>1.6</strong> It is not necessary in this course to know the
  computational details behind the leapfrog integrator, only that it is applied
  for <span class="math inline">\(L\)</span> steps along the Hamiltonian
  trajectory with step size, <span class="math inline">\(\epsilon\)</span>. The
  figure below by <a href="https://arxiv.org/abs/1206.1901">Neal (2012)</a>
  shows dynamic simulation in the joint position-momentum space using leapfrog
  method. Based on these figures, which of the following statements is false?
</p>
<p><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/slides/figs/hmc_leapfrog.png">
</p>
<p>HMC has two general steps at each iteration of the MCMC chain. Denote the
  current state of the MCMC chain as <span class="math inline">\(t\)</span>,
  then</p>
<ol style="list-style-type: decimal;">
  <li>we draw a new momentum variable <span class="math inline">\(\phi\)</span>
    (often assumed to distributed marginally Gaussian)</li>
  <li>perform a Metropolis update with <span class="math inline">\(r=\exp\left(-H(\theta^*,\phi^*)+H(\theta^{(t-1)},\phi^{(t-1)})\right)\)</span>,
    where Hamiltonian dynamics are used to produce the proposal. The two
    parameters of the algorithm, number of steps <span class="math inline">\(L\)</span> and step size <span class="math inline">\(\epsilon\)</span>, need to be tuned.</li>
</ol>
<p><strong>1.7</strong> What can happen eventually, when allowing the trajectory
  length, defined as step size times number of steps, <span class="math inline">\(\epsilon L\)</span>, to be long enough? Check out this
  <a href="https://chi-feng.github.io/mcmc-demo/app.html?algorithm=HamiltonianMC&amp;target=standard">interactive
    demo</a> (algorithm=HamiltonianMC, target=standard) and set Leapfrog steps
  equal to 75 for visual intuition (if the demo freezes, close the demo, restart
  and instead of sliders, make the control changes by editing the values in the
  numeric fields). Do not adjust anything else in the demo.</p>
<p>To avoid this behaviour that static HMC with fixed integration time (number
  of steps times the step size) may have, the No-U-Turn (NUTS) algorithm by <a href="https://www.jmlr.org/papers/volume15/hoffman14a/hoffman14a.pdf">Hoffman
    and Gelman (2014)</a> performs automatic tuning: neither the step size nor
  number of steps need be specified by the user. NUTS uses a tree-building
  algorithm (see the <a href="https://avehtari.github.io/BDA_course_Aalto/slides/BDA_lecture_6.pdf">slides</a>)
  to adaptively determine the number of steps, <span class="math inline">\(L\)</span>, while the step size is adapted during the
  warm-up phase according to a target average acceptance ratio. To gain some
  more intuition on the behaviour of the adaptivity of NUTS, open the
  interactive demo again with this <a href="https://chi-feng.github.io/mcmc-demo/app.html?algorithm=EfficientNUTS&amp;target=banana">link</a>
  (algorithm=EfficientNUTS, target=banana). Set Autoplay delay to around 500,
  and set Leapfrog <span class="math inline">\(\delta t\)</span> to 0.03. This
  algorithm corresponds to Algorithm 3 in <a href="https://arxiv.org/pdf/1111.4246">Hoffman and Gelman (2014)</a>, where
  for a fixed <span class="math inline">\(\epsilon\)</span>, the algorithm
  adaptively determines the number of steps, <span class="math inline">\(L\)</span>.</p>
<p><strong>1.8</strong> What do you observe?</p>
<p><strong>1.9</strong> On the other hand, set Leapfrog <span class="math inline">\(\delta t\)</span> to 0.6, all else equal. What do you
  observe?</p>
<p>The user does not need to select the stepsize directly. Stan includes also
  adaptation of the step size in the warmup phase using stochastic optimization
  called dual averaging. The user specifies a target acceptance ratio (in Stan
  actually target for expected discretization error), with argument
  <code>adapt_delta</code>, and a number of iterations during which adaptation
  of <span class="math inline">\(\epsilon L\)</span> occurs (warm-up draws).
  Open, the interactive demo again with this <a href="https://chi-feng.github.io/mcmc-demo/app.html?algorithm=DualAveragingNUTS&amp;target=banana">link</a>
  (algorithm=DualAveragingNUTS, target=banana), and adjust the Autoplay delay to
  around 70, but otherwise keep the default options, particularly, keep the
  target acceptance ratio (here <span class="math inline">\(\delta\)</span>) at
  0.65. On the top left-hand corner m/M_adapt tells you how many draws have been
  taken compared to number of warm-up draws. Wait until m/M_adapt is at least
  50/200.</p>
<p><strong>1.10</strong> What do you observe with the first couple of
  iterations?</p>
<p><strong>1.11</strong> What do you observe with sufficient warm-up?</p>
<p><strong>1.12</strong> Now set the target acceptance ratio to 0.95. What do
  you observe?</p>
<p><strong>1.13</strong> Now set the target acceptance ratio to the smallest
  possible value. What do you observe?</p>
<p>The current Stan HMC-NUTS implementation has some further enhancements, but
  we will not go to details of those. The main algorithm paramaters are
  <code>adapt_delta</code> and <code>max_treedepth</code> options.</p>
<p><code>adapt_delta</code> specifies the target expected discretization error
  (in the same scale as the average proposal acceptance ratio), during the
  warm-up phase. The default in most packages using Stan is
  <code>adapt_delta=0.8</code>.</p>
<p><strong>1.14</strong> What should happen when you increase
  <code>adapt_delta</code>, all else equal?</p>
<p><code>max_treedepth</code> controls the maximum number of doublings in the
  tree-building algorithm and thus controls the maximum number of steps in
  Hamiltonian simulation. This allows the sampler to explore further away in the
  distribution, which can be beneficial when dealing with complex posteriors.
  The default in Stan is <code>max_treedepth = 10</code>.</p>
<p><strong>1.15</strong> What is the main cost to increasing the
  <code>max_treedepth</code>?</p>
<p><strong>1.16</strong> Despite the adaptated step-size, you may encounter
  challenging posteriors, e.g.&nbsp;with highly varying curvature in log-density.
  What can happen if the step-size is too big compared to the curvature of the
  log-density?</p>
<h1 id="stan-warmup">2. Stan warmup</h1>
<p>From 2018 to 2023, we have been keeping track of assignment submissions for
  the BDA course given the number of submissions for the 1st assignment. We will
  fit a simple linear model to answer two questions of interest:</p>
<ul>
  <li>What is the trend of student retention as measured by assignment
    submissions?</li>
  <li>Given the submission rates for assignments 1-8, how many students will
    complete the final 9th assignment (and potentially pass the course)?</li>
</ul>
<p>Below is broken Stan code for a linear model. In the following, we write the
  equations following the Stan distributional definitions. See Stan
  documentation for the definitions related to the normal distribution.</p>
<p><span class="math inline">\(p(y \mid x, \alpha, \beta, \sigma) =
    \text{normal}(y \mid \alpha + \beta x, \sigma)\)</span> (normal model)</p>
<p><span class="math inline">\(p(\alpha, \beta, \sigma) \propto
    \text{const}\)</span> (improper flat prior)</p>
<p>In both the statistical model above and in the Stan model below, <span class="math inline">\(x \in \mathbb{R}^N\)</span> and <span class="math inline">\(y \in \mathbb{R}^N\)</span> are vectors of the
  covariates/predictors (the assignment number) and vectors of the observation
  (proportions of students who have handed in the respective assignment). <span class="math inline">\(\alpha \in \mathbb{R}^N\)</span> is the unknown scalar
  intercept, <span class="math inline">\(\beta \in \mathbb{R}^N\)</span> is the
  unknown scalar slope and <span class="math inline">\(\sigma \in \mathbb{R}
    &gt; 0\)</span> is the unknown scalar observation standard deviation. The
  statistical model further implies</p>
<p><span class="math inline">\(p(y_\text{pred} \mid x_\text{pred}, \alpha,
    \beta, \sigma) = normal(y_\text{pred} \mid \alpha + \beta x_\text{pred},
    \sigma)\)</span></p>
<p>as the predictive distribution for a new observation <span class="math inline">\(y_\text{pred}\)</span> at a given new covariate value
  <span class="math inline">\(x_\text{pred}\)</span>. The broken Stan model
  code:</p>
<pre><code>data {
    // number of data points
    int&lt;lower=0&gt; N; 
    // covariate / predictor
    vector[N] x; 
    // observations
    vector[N] y; 
    // number of covariate values to make predictions at
    int&lt;lower=0&gt; N_predictions;
    // covariate values to make predictions at
    vector[N_predictions] x_predictions; 
}
parameters {
    // intercept
    real alpha; 
    // slope
    real beta; 
    // the standard deviation should be constrained to be positive
    real&lt;upper=0&gt; sigma; 
}
transformed parameters {
    // deterministic transformation of parameters and data
    vector[N] mu = alpha + beta * x // linear model
}
model {
    // observation model
    y ~ normal(mu, sigma); 
}
generated quantities {
    // compute the means for the covariate values at which to make predictions
    vector[N_predictions] mu_pred = alpha + beta * x_predictions;
    // sample from the predictive distribution normal(mu_pred, sigma).
    array[N_predictions] real y_pred = normal_rng(to_array_1d(mu), sigma);
}</code></pre>
<p>Firstly, let’s review some Stan syntax.</p>
<p><strong>2.1</strong> What is the function of the data block?</p>
<p><strong>2.2</strong> What is the function of the parameters block?</p>
<p><strong>2.3</strong> Can you use statements (e.g.&nbsp;<code>real&lt;lower=0&gt;
    theta = lambda^2</code>) in the parameters code block, where lambda is some
  other variable?</p>
<p><strong>2.4</strong> What is the function of the transformed parameters
  block?</p>
<p><strong>2.5</strong> What is the function of the model block?</p>
<p><strong>2.6</strong> As you’ve learned in the lecture or from the <a href="https://mc-stan.org/docs/reference-manual/statements.html#distribution-statements.section">Stan
    documentation</a>, log densities can be added to the target density either
  via the distribution statement using <code>~</code> or via the log probability
  increment statement using target <code>+=</code>. Furthermore, we don’t need
  to include constant terms. Assume the model block has a line <code>theta ~
    normal(0,1);</code>. How could you equivalently increment the log density to
  get the same increment (ignoring the possible difference in the constants)?
</p>
<p><strong>2.7</strong> Why can the normalising constant(s) be dropped when
  using MCMC (this holds for e.g.&nbsp;variational inference and optimisation too)?
</p>
<p>Stan language allows writing the models as usually written in books and
  articles. As you’ve learned during the course, a collection of distribution
  statements define a joint distribution as a product of component
  distributions. Suppose your model is the following:</p>
<p><span class="math inline">\(p(y \mid \mu, \sigma) = \text{normal}(y \mid \mu,
    \sigma)\)</span></p>
<p><span class="math inline">\(p(\mu) = \text{normal}(\mu \mid 0, 1)\)</span>
</p>
<p><span class="math inline">\(p(\sigma)= \text{normal}_+ (\sigma \mid
    0,10)\)</span>,</p>
<p>where <span class="math inline">\(\text{normal}_+ ()\)</span> stands for the
  half normal, defined for the positive reals.</p>
<p><strong>2.8</strong> What are correct ways to write your model in the model
  block? In the below, assume that there is a line-break after each semi-colon,
  and that the variables have been appropriately declared in the parameter
  blocks.</p>
<p>When writing complicated models, it may happen that some distribution
  statement is accidentally repeated twice. Check out <a href="https://mc-stan.org/docs/reference-manual/statements.html">this
    page</a> in the Stan manual to see what happens in this case.</p>
<p><strong>2.9</strong> What is the function of the generated quantities block?
</p>
<p>Now, let’s return to the student retention model code, shown above.</p>
<p><strong>2.10</strong> What are the three mistakes in the Stan model code
  above?</p>
<p>You may find some of the mistakes in the code using Stan syntax checker. If
  you copy the Stan code to a file ending <code>.stan</code> and open it in
  RStudio (you can also choose from RStudio menu File → New File → Stan file to
  create a new Stan file), the editor will show you some syntax errors. More
  syntax errors might be detected by clicking `Check’ in the bar just above the
  Stan file in the RStudio editor. Note that some of the errors in the presented
  Stan code may not be syntax errors. Use the code in the <a href="https://avehtari.github.io/BDA_course_Aalto/assignments/template6.html">template</a>
  to first compile your model using CmdStanR (which is a handy interface for
  CmdStan which transpiles Stan model code to C++ which is compiled to
  executable program which can do the actual sampling), run the inference with
  the supplied data, and finally create the plot to answer the following
  questions.</p>
<p>Define the term of the model <span class="math inline">\(\mu = \alpha + \beta
    x\)</span> as the linear predictor.</p>
<p><strong>2.11</strong> What is the solid red line plotting?</p>
<p><strong>2.12</strong> What are the dashed red lines referring to?</p>
<p><strong>2.13</strong> How and why are these different from the corresponding
  grey lines?</p>
<p><strong>2.14</strong> What is the general trend of student retention as
  measured by the assignment submissions?</p>
<p><strong>2.15</strong> Does it do a good job predicting the proportion of
  students who submit the final 9th assignment?</p>
<p><strong>2.16</strong> What modeling choice could you make to improve the
  prediction for the given data set?</p>
<h1 id="diagnosing-problems-in-hmc-nuts-sampling">3. Diagnosing Problems in
  HMC-NUTS sampling</h1>
<p>Another benefit of the HMC-NUTS algorithm over simpler non-gradient based
  MCMC algorithms, is that we have access to many diagnostic tools related to
  the posterior geometry that we would otherwise not have. This feedback is
  helpful for modeling and also for debugging code, and therefore an essential
  part of the <a href="https://arxiv.org/abs/2011.01808">Bayesian workflow</a>.
  A model type which is likely to cause problems is logistic regression with
  complete separation in the data. This creates an unbounded likelihood.</p>
<p><strong>3.1</strong> Why is it problematic to use flat, improper priors for
  this likelihood?</p>
<p>Using the data generated from the template, compile and run the following
  Stan model:</p>
<pre><code>// logistic regression
data {
  int&lt;lower=0&gt; N;
  int&lt;lower=0&gt; M;
  array[N] int&lt;lower=0,upper=1&gt; y;
  matrix[N,M] x;
}
parameters {
  real alpha;
  vector[M] beta;
}
model {
  y ~ bernoulli_logit_glm(x, alpha, beta);
}</code></pre>
<p><strong>3.2</strong> You can use the function <code>[fit object
    name]$diagnostic summary()</code> to check for the number of divergent
  transitions and max_treedepth exceedences. What do you see?</p>
<p><strong>3.3</strong> You can examine the problematic behaviour of MCMC by
  looking at parameter specific sampling diagnostics using the
  <code>summarize_draws</code> function discussed last week. To gain visual
  intuition use bayesplot’s mcmc_pairs function to plot histograms and bivariate
  scatter plots of the posteriors. What do you observe?</p>
<p>Before thinking about changing the model, a first step should be to check for
  any easy mistakes made in the Stan code. The Stan compiler has a pedantic mode
  to help spot such issues. By default the pedantic mode is not enabled, but we
  can use option <code>pedantic = TRUE</code> at compilation time, or after
  compilation with the check_syntax method.</p>
<p><strong>3.4</strong> Use the function <code>[Stan
    model]$check_syntax(pedantic = TRUE</code>). What warning message(s) do you
  get?</p>
<p><strong>3.5</strong> Set normal(0,10) priors for both parameters, what do you
  find from the MCMC output?</p>
<p>As you’ve learned during the course, using proper priors, even when they are
  wide, are always preferable to stabilise inference and make the model
  generative. You’ll learn next week more about priors.</p>
<p><strong>3.6</strong> Sometimes, when adjusting Stan model code you may have
  removed a variable from the model block, but left the declaration in the
  parameters block. Add such a variable to your model. What do you see from
  convergence diagnostics (it may also help you visualise the MCMC chains using
  <code>mcmc_pairs</code> and <code>mcmc_trace</code>)?</p>
<p><strong>3.7</strong> Use <code>check_syntax(pedantic = TRUE)</code>, would
  you have been able to detect this problem from the output?</p>
<h1 id="generalised-linear-model-bioassay-with-stan">4. Generalised Linear
  Model: Bioassay with Stan</h1>
<p>Now, we re-investigate the Bioassay model from last week with Stan. If you
  need a reminder about the model and likelihood definition, check out section
  3.7 in BDA3. To make the implementation simpler, we consider the following
  priors:</p>
<p>alpha ~ normal(0,2); beta ~ normal(10,10);</p>
<p><strong>4.1</strong> What is the difference in the prior to last week?</p>
<p><strong>4.2</strong> Which pre-built function can you use in Stan to compute
  the likelihood?</p>
<p>
  
</p>
<p>Use the code hints in the <a href="https://avehtari.github.io/BDA_course_Aalto/assignments/template6.html">template</a>
  to complete your Stan model. For questions about declarations and
  functionality of Stan, your first point of reference should always be the <a href="https://mc-stan.org/docs/reference-manual/">Stan Manual</a> (it’s been
  recently revised, be sure to open at least version 2.35). Use 4 chains, with
  1000 warmup and 2000 total draws each, use default options for
  <code>adapt_delta</code> and <code>max_treedepth</code>, and use <code>seed =
    4911</code>. Compile your model, define the data inputs needed, sample from
  the posterior, and answer the following. To make sure that your model is
  correct, compare a scatter plot of alpha and beta to last week (the priors are
  not exactly the same, but the posterior should be quite similar to last week
  as the priors are relatively weak).</p>
<p><strong>4.3</strong> Did the Stan model produce any warnings about the
  sampling efficiency?</p>
<p>Use the Rhat function from the posterior package, <code>rhat_basic()</code>,
  (used in last week’s assignment).</p>
<p><strong>4.4</strong> The Rhat for alpha is?</p>
<p><strong>4.7</strong> What do you see?</p>
<p></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./assignment5.html" class="pagination-link" aria-label="Assignment 5">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Assignment 5</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./assignment7.html" class="pagination-link" aria-label="Assignment 7">
        <span class="nav-page-text">Assignment 7</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>