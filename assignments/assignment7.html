<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aki Vehtari et al.">

<title>Assignment 7 – Bayesian Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./assignment8.html" rel="next">
<link href="./assignment6.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-3b41dc0f5e1034f3961de186a2aad809.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script>


</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignment1.html">Assignments</a></li><li class="breadcrumb-item"><a href="./assignment7.html">Assignment 7</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">General instructions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment_instructions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment instructions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment7.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Assignment 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 9</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Templates</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 9</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#general-information" id="toc-general-information" class="nav-link active" data-scroll-target="#general-information"><span class="header-section-number">1</span> General information</a>
  <ul class="collapse">
  <li><a href="#assignment-questions" id="toc-assignment-questions" class="nav-link" data-scroll-target="#assignment-questions"><span class="header-section-number">1.1</span> Assignment questions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignment1.html">Assignments</a></li><li class="breadcrumb-item"><a href="./assignment7.html">Assignment 7</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Assignment 7</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Aki Vehtari et al. </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="general-information" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> General information</h1>
<p>The exercises here refer to the lecture 7/BDA chapter 5 content. The main topics for this assignment are the MCSE and importance sampling.</p>
<p><strong>The exercises constitute 96% of the Quiz 7 grade.</strong></p>
<p>We prepared a quarto notebook specific to this assignment to help you get started. <u>You still need to fill in your answers on Mycourses!</u> You can inspect this and future templates</p>
<ul>
<li>as a <a href="template7.html">rendered html file</a> (to access the qmd file click the “&lt;/&gt; Code” button at the top right hand corner of the template)</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>General Instructions for Answering the Assignment Questions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Questions below are exact copies of the text found in the MyCourses quiz and should serve as a notebook where you can store notes and code.</li>
<li>We recommend opening these notebooks in the Aalto JupyterHub, see <a href="https://avehtari.github.io/BDA_course_Aalto/FAQ.html#How_to_use_R_and_RStudio_remotely"><strong>how to use R and RStudio remotely</strong></a>.</li>
<li>For inspiration for code, have a look at the <a href="https://avehtari.github.io/BDA_course_Aalto/demos.html"><strong>BDA R Demos</strong></a> and the specific Assignment code notebooks</li>
<li>Recommended additional self study exercises for each chapter in BDA3 are listed in the course web page. These will help to gain deeper understanding of the topic.</li>
<li>Common questions and answers regarding installation and technical problems can be found in <a href="https://avehtari.github.io/BDA_course_Aalto/FAQ.html">Frequently Asked Questions (FAQ)</a>.</li>
<li>Deadlines for all assignments can be found on the course web page and in MyCourses.</li>
<li>You are allowed to discuss assignments with your friends, but it is not allowed to copy solutions directly from other students or from internet.</li>
<li>Do not share your answers publicly.</li>
<li>Do not copy answers from the internet or from previous years. We compare the answers to the answers from previous years and to the answers from other students this year.</li>
<li>Use of AI is allowed on the course, but the most of the work needs to by the student, and you need to report whether you used AI and in which way you used them (See <a href="https://www.aalto.fi/en/services/guidance-for-the-use-of-artificial-intelligence-in-teaching-and-learning-at-aalto-university">points 5 and 6 in Aalto guidelines for use of AI in teaching</a>).</li>
<li>All suspected plagiarism will be reported and investigated. See more about the <a href="https://into.aalto.fi/display/ensaannot/Aalto+University+Code+of+Academic+Integrity+and+Handling+Violations+Thereof"><strong>Aalto University Code of Academic Integrity and Handling Violations Thereof</strong></a>.</li>
<li>If you have any suggestions or improvements to the course material, please post in the course chat feedback channel, create an issue, or submit a pull request to the public repository!</li>
<li>The decimal separator throughout the <strong>whole course</strong> is a dot, “.” (Follows English language convention). Please be aware that MyCourses will not accept numerical value answers with “,” as a decimal separator</li>
<li><u><strong>Unless stated otherwise</strong></u>: if the question instructions ask for reporting of numerical values in terms of the ith decimal digit, round to the ith decimal digit. For example, 0.0075 for two decimal digits should be reported as 0.01. More on this in Assignment 4.</li>
</ul>
</div>
</div>
</div>
<section id="assignment-questions" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="assignment-questions"><span class="header-section-number">1.1</span> Assignment questions</h2>
<p>For convenience the assignment questions are copied below. Answer the questions in MyCourses.</p>
<p></p>
<h1 id="lecture-7chapter-5-of-bda-quiz-96-of-grade">Lecture 7/Chapter 5 of BDA
  Quiz (96% of grade)</h1>
<p>This week’s assignment focuses on hierarchical models and modelling with
  brms.</p>
<h1 id="exchangeability">1. Exchangeability</h1>
<p>An important building block of hierarchical models is the assumption of
  exchangeability. Please have a look at lecture 7, slides 75-83, Chapter 5.2 in
  BDA3, as well as the <a href="https://avehtari.github.io/BDA_course_Aalto/BDA3_notes.html#exchangeability-vs.-independence">chapter
    notes for chapter 5</a> more details on the difference between the
  exchangeability and independence assumption. Let’s review.</p>
<p><strong>1.1</strong> Consider parameters <span class="math inline">\(\theta_j\)</span> for <span class="math inline">\(j \;
    \text{in} \; 1...J\)</span>. Which of these statements correctly describes
  exchangeability?</p>
<p><strong>1.2</strong> What best describes the difference between independence
  and exchangeability?</p>
<p>Consider the following: assume a box has n black and white balls but we do
  not know how many of each color. We pick a ball <span class="math inline">\(y_1\)</span> at random, we do not put it back, and
  pick another ball <span class="math inline">\(y_2\)</span> at random. Denote
  the number of black balls by B and white by W.</p>
<p><strong>1.3</strong> Are observations <span class="math inline">\(y_1\)</span> and <span class="math inline">\(y_2\)</span> exchangeable?</p>
<p><strong>1.4</strong> Are observations <span class="math inline">\(y_1\)</span> and <span class="math inline">\(y_2\)</span> independent?</p>
<p><strong>1.5</strong> Can we treat the two observations as if they are
  independent?</p>
<p><strong>1.6</strong> Exchangeability allows us to express dependencies of
  data and parameters in a convenient form. Suppose we model a sequence of
  exchangeable random variables <span class="math inline">\(\theta\)</span> via
  a governing, or population distribution, where conditional on some unknown
  parameters <span class="math inline">\(\phi\)</span>, we may assume
  independence between the elements of <span class="math inline">\(\theta\)</span>. Assume that <span class="math inline">\(\theta\)</span> has <span class="math inline">\(J\)</span> elements, write down an equation that
  conveniently factors the joint probability <span class="math inline">\(p(\theta,\phi)\)</span>:</p>
<p>De Finetti’s theorem provides the theoretical basis for the equivalence to
  the independence assumption when <span class="math inline">\(J\)</span> goes
  to infinity. In practice <span class="math inline">\(J\)</span> is finite, but
  the difference may be small when <span class="math inline">\(J\)</span> is
  relatively large. Check out the examples mentioned in the <a href="https://avehtari.github.io/BDA_course_Aalto/BDA3_notes.html#exchangeability-vs.-independence">Chapter
    notes</a> if you need more convincing.</p>
<p><span class="math inline">\(\phi\)</span> is in general unknown. So the
  marginal prior for <span class="math inline">\(\theta\)</span> must average
  over uncertainty in <span class="math inline">\(\phi\)</span>: <span class="math inline">\(\int \prod_{j=1}^Jp(\theta_j \mid
    \phi)p(\phi)d\phi\)</span>.</p>
<p><strong>1.7</strong> Based on the marginal prior formulation in the paragraph
  above, what can you say about the covariances <span class="math inline">\(\mathrm{cov}(\theta_i,\theta_j)\)</span>?</p>
<p><strong>1.8</strong> As with the parameters above, we often think of
  exchangeability as arising for our data model conditional on extra information
  <span class="math inline">\(x\)</span>, such that the tuple <span class="math inline">\((x_i,y_i)\)</span> are exchangeable whereas <span class="math inline">\(y_i\)</span> might not be. In which modeling context
  is this useful? Assume that the target data is denoted by <span class="math inline">\(y_i\)</span>.</p>
<h1 id="overview-of-hierarchical-models">2. Overview of hierarchical models</h1>
<p><strong>2.1</strong> Which of these best describes a hierarchical model?</p>
<p><strong>2.2</strong> Consider that there are observations <span class="math inline">\(y\)</span> indexed by observation number <span class="math inline">\(i\)</span> and group <span class="math inline">\(j\)</span>. Suppose the data are modeled dependent on
  parameters <span class="math inline">\(θ_j\)</span> where <span class="math inline">\(j=1,\dotsc,J\)</span> indexes some meaningful grouping
  such as hospital-j specific health-outcomes, conditional on parameters <span class="math inline">\(\phi\)</span> which are hyper-parameters of the prior
  distribution of <span class="math inline">\(\theta_j\)</span>. <span class="math inline">\(\phi\)</span> are modeled by prior distribution <span class="math inline">\(p(\phi)\)</span>. We think of the distribution <span class="math inline">\(p(\theta_j|\phi)\)</span> as the population
  distribution which generates the values for <span class="math inline">\(\theta\)</span> in the hierarchical model. What are
  some of the benefits of hierarchical models compared to separate models, which
  assume no relationship between <span class="math inline">\(j\)</span> (and
  separate models are estimated), and pooled models, which consider all <span class="math inline">\(j\)</span> jointly, but do not model <span class="math inline">\(j\)</span> specific parameters?</p>
<p>Throughout the rest of the course, we will often compare the hierarchical
  model, to a separate model and the pooled model. Suppose for the questions
  below that you are modeling data <span class="math inline">\(y_{ij}\)</span>
  where <span class="math inline">\(i\)</span> refers to an observation within
  the jth group, the observation model for <span class="math inline">\(y_{ij}\)</span> is normal, and we consider hierarchies
  at the level of the parameters describing the location of <span class="math inline">\(y_{ij}\)</span>.</p>
<p><strong>2.3</strong> Based on the description of the above, the lecture and
  BDA chapter 5 content, which of these below would suggest a separate model for
  <span class="math inline">\(y_{ij}\)</span>? <span class="math inline">\(\pi()\)</span> stands for some prior distribution and
  <span class="math inline">\(η_j\)</span> may be a vector of parameters such
  that <span class="math inline">\(\mathrm{cov}(\eta_s,\eta_r)=0\)</span> for
  <span class="math inline">\(s\neq r\)</span>.</p>
<p><strong>2.4</strong> Based on the description of the above, the lecture and
  BDA chapter 5 content, which of these below would suggest a pooled model for
  <span class="math inline">\(y_{ij}\)</span>? <span class="math inline">\(\pi()\)</span> stands for some prior distribution and
  <span class="math inline">\(η_j\)</span> may be a vector of parameters such
  that <span class="math inline">\(\mathrm{cov}(\eta_s,\eta_r)=0\)</span> for
  <span class="math inline">\(s\neq r\)</span>.</p>
<p><strong>2.5</strong> Based on the description of the above, the lecture and
  BDA chapter 5 content, which of these below would suggest a hierarchical model
  for <span class="math inline">\(y_{ij}\)</span>? <span class="math inline">\(\pi()\)</span> stands for some prior distribution and
  <span class="math inline">\(η_j\)</span> may be a vector of parameters such
  that <span class="math inline">\(\mathrm{cov}(\eta_s,\eta_r)=0\)</span> for
  <span class="math inline">\(s\neq r\)</span>.</p>
<p><strong>2.6</strong> Why are hierarchical models sometimes also referred to
  as partially pooled models. You may find it helpful to review the first
  unnumbered equation on <a href="https://users.aalto.fi/~ave/BDA3.pdf">page 115
    of BDA3</a>?</p>
<p>It may help, before translating the model to code, to first describe the
  relationship between variables as a directed acyclic graph (DAG) (<a href="https://avehtari.github.io/BDA_course_Aalto/slides/BDA_lecture_7.pdf">see
    lecture 7,slide 3</a>). We interpret the DAG starting from top to bottom as
  describing the generative mechanism implied by priors and observation model
  for <span class="math inline">\(y_{ij}\)</span>. Top level variables feed into
  distributions of lower level parameters and the observation model.
  Distributions are typically not further described in the DAG. By drawing
  variables sequentially from top to bottom, you can generate fake observations
  (push-forward distribution). In the case that the parameters have not yet been
  updated by the data information, this push-forward distribution is called the
  prior predictive distribution of <span class="math inline">\(y\)</span>. You
  have already created such a prior predictive distribution in Assignment 1,
  question 7 and we will return to this in the sections below.</p>
<p><strong>2.7</strong> What is the difference between sequential draws from
  priors and the data model as described above to drawing from the joint
  posterior in Stan?</p>
<p>In the Figure 1 below, assume that all circular nodes indicate that the
  object inside can be generated according to some distribution, conditional on
  the parent nodes.</p>
<div class="figure"><img style="width: 50.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/DAG.png" alt="">
  <p class="caption">Figure 1</p>
</div>
<p><strong>2.8</strong> Which of these equations properly describes the
  posterior for the model shown in the diagram?</p>
<h1 id="meta-analysis-and-hierarchical-models">3. Meta-analysis and hierarchical
  models</h1>
<p>Often similar research studies in areas such as medicine or social science
  will be published under slightly different conditions or replicated with
  different subjects. It is of interest to summarise and integrate those
  findings for which hierarchical models have become increasingly popular.</p>
<p><strong>3.1</strong> Suppose <span class="math inline">\(y_i\)</span> is the
  point estimate for an effect size of a single study, <span class="math inline">\(i\)</span>. Why is it often appropriate to model <span class="math inline">\(y_i\)</span> by a normal distribution with known
  standard deviation <span class="math inline">\(\sigma_i\)</span> which is
  taken as the standard error estimate for <span class="math inline">\(y_i\)</span>?</p>
<p><strong>3.2</strong> Why are hierarchical models preferable to separate and
  pooled models for meta-analysis?</p>
<p><strong>3.3</strong> Suppose the assumption of exchangeability is false
  because you know the estimates of effects across studies depends on extra
  information <span class="math inline">\(x_i\)</span>, e.g.&nbsp;geolocation, and
  this has a substantial impact on the estimates. What should you do in this
  circumstance?</p>
<p><strong>3.4</strong> Based on the discussion above, which of the below would
  refer to a hierarchical model for <span class="math inline">\(y_i\)</span>?
</p>
<h1 id="introduction-to-brms">4. Introduction to brms</h1>
<p>brms is an R package which makes writing models with Stan easier.</p>
<p>Suppose you have oberved the following variables, from different groups:
  <span class="math inline">\(x,z,y\)</span>. <span class="math inline">\(i\)</span> is the observation number and <span class="math inline">\(j\)</span> the group indicator. Assume a model <span class="math inline">\(y_{ij} \sim
    \mathrm{normal}\left(\mu_{ij},\sigma\right)\)</span>. Translate the
  following equations for the linear predictor term <span class="math inline">\(\mu_{ij}\)</span> into brms syntax:</p>
<p><strong>4.1</strong> <span class="math inline">\(\mu_{ij}=\alpha_0\)</span>:
</p>
<p><strong>4.2</strong> <span class="math inline">\(\mu_{ij}=\alpha_0+\beta_1
    x_i\)</span></p>
<p><strong>4.3</strong> <span class="math inline">\(\mu_{ij}=\alpha_0+\beta_1
    x_i+\beta_2 z_i\)</span></p>
<p><strong>4.4</strong> <span class="math inline">\(\mu_{ij}=\alpha_0+\alpha_j+\beta_1 x_i\)</span></p>
<p>Note that in within brms, coefficients that do not vary according to some
  grouping index (e.g.&nbsp;<span class="math inline">\(\mu_{ij}=\alpha_0\)</span>)
  are called population effects while coefficients that vary according to some
  grouping are called varying effects (e.g.&nbsp;<span class="math inline">\(\mu_{ij}=\alpha_j\)</span>). Some literatures refer to
  these parameters as fixed and random effects respectively, however in the
  context of Bayesian inference, this terminology can be misleading, since
  parameters in a model are treated as random variables. See <a href="http://www.stat.columbia.edu/~gelman/research/published/AOS259.pdf">here</a>
  for more discussion on this. For the questions below, we will use brms
  terminology.</p>
<h1 id="simulation-warmup">5. Simulation warmup</h1>
<p>In this task, you will simulate data from a hierarchical model to gain better
  insight into it.</p>
<p>The following R code simulates data from a hierarchical structure, and then
  plots the results. Experiment with this function by using it on different
  values of the arguments, and answer the following questions. This code is also
  included in the notebook for this assignment.</p>
<pre><code>hierarchical_sim &lt;- function(group_pop_mean,
                             between_group_sd,
                             within_group_sd,
                             n_groups,
                             n_obs_per_group
                             ) {  
  # Generate group means
  group_means &lt;- rnorm(n = n_groups, mean = group_pop_mean, sd = between_group_sd)
  # Generate observations
  ## Create an empty vector for observations
  y &lt;- numeric()   
  ## Create a vector for the group identifier   
  group &lt;- rep(1:n_groups, each = n_obs_per_group)   
  for (j in 1:n_groups) {
    ### Generate one group observations     
    group_y &lt;- rnorm(n = n_obs_per_group, mean = group_means[j], sd = within_group_sd)
    ### Append the group observations to the vector
    y &lt;- c(y, group_y)
  }  
  # Combine into a data frame   
  data &lt;- data.frame(group = factor(group), y = y)   
  # Plot the data
  ggplot(data, aes(x = y, y = group)) +
    geom_point() +
    geom_vline(xintercept = group_pop_mean, linetype = "dashed")
}</code></pre>
<p><strong>5.1</strong> Which of the following generative models does the code
  correspond to? <span class="math inline">\(i\)</span> is the observation
  number, <span class="math inline">\(j\)</span> is the group indicator.</p>
<p><strong>5.2</strong> What does the vertical dashed line in the plot
  represent?</p>
<p><strong>5.3</strong> Which function call would plausibly create Figure 2
  below (although the random numbers you generate will almost certainly be
  different those plotted below, try to distill what attributes are captured
  with the different simulation choices and compare to the below)?</p>
<div class="figure"><img style="width: 50.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/simulator_outout.png" alt="">
  <p class="caption">Figure 2</p>
</div>
<p><strong>5.4</strong> Which of these statements correctly describes the
  behaviour when the number of groups is increased?</p>
<p><strong>5.5</strong> Which of these statements correctly describes the
  behaviour when the ratio of the between group and within group variance is
  changed?</p>
<h1 id="sleep-deprivation">6. Sleep deprivation</h1>
<p>In many studies, data will have been collected for the same people repeatedly
  (e.g.&nbsp;at different time points). A hierarchical model is well suited for such
  data as we can specify a grouping structure corresponding to the
  person/subject id. The sleepstudy dataset contains observations of reaction
  times for different people after differing number of days of sleep
  deprivation.</p>
<p>Your task is to fit a hierarchical normal linear model in brms. The
  observation model will be <span class="math inline">\(\mathrm{Reaction}_{ij}
    \sim \mathrm{normal}\left(\mu_{ij},\sigma\right)\)</span> where <span class="math inline">\(i\)</span> refers to an observation id and <span class="math inline">\(j\)</span> to the subject id. But depending on the
  model, the <span class="math inline">\(\mu_{ij}\)</span> term will be
  differently parameterised.</p>
<p>First fit a model with a population-level intercept, population-level effect
  of Days and varying intercept per Subject. Note: in order to have the
  Intercept parameter be more clearly interpretable, use <code>center =
    FALSE</code> when creating the brms formula (see the Parameterization of the
  population-level intercept secion in the <a href="https://rdrr.io/cran/brms/man/brmsformula.html">brms manual</a>.
  Centering refers here to data transformations made within the Stan model, that
  among other things makes sampling more efficient, but change the
  interpretation of the intercept. <a href="https://avehtari.github.io/BDA_R_demos/demos_rstan/brms_demo.html">Section
    5 of this demo</a> provides some more insight into this. Use the following
  priors (check the code notebook for how to specify):</p>
<p><span class="math inline">\(\alpha_0 \sim
    \mathrm{normal}\left(250,100\right); \beta_0 \sim
    \mathrm{normal}\left(0,20\right);\alpha_j \sim
    \mathrm{normal}\left(0,\tau\right); \tau \sim
    \mathrm{normal}_+\left(0,100\right);\sigma \sim
    \mathrm{normal}_+\left(0,100\right)\)</span></p>
<p><strong>6.1</strong> Which of these formulae correctly defines the linear
  predictor term in a model with population-level intercept, population-level
  effect of Days and varying intercepts per Subject?</p>
<p><strong>6.2</strong> Which is the correct brms formula for this model?</p>
<p><strong>6.3</strong> Based on the posterior, the estimate of the
  population-level intercept is: </p>
<p><strong>6.4</strong> The population-level intercept can be interpreted as:
</p>
<p><strong>6.5</strong> Based on the posterior, the estimate of the
  population-level effect of Days on Reaction <span class="math inline">\(i\)</span>: </p>
<p><strong>6.6</strong> The population-level effect of Days can be interpreted
  as:</p>
<p><strong>6.7</strong> Based on the posterior, the estimate of the standard
  deviation of the Intercept between Subjects <span class="math inline">\(i\)</span>: </p>
<p><strong>6.8</strong> The standard deviation of the Subject-specific Intercept
  can be interpreted as:</p>
<p>Next fit a model with Subject-specific effects of Days in addition to the
  other terms.</p>
<p>In this model, we can consider a correlation between the by-Subject Intercept
  and Days effects. This means the priors on <span class="math inline">\(\alpha_j\)</span> and <span class="math inline">\(\beta_j\)</span> can be considered as a multivariate
  normal <span class="math inline">\(\left(\alpha_j,\beta_j\right)\sim
    \mathrm{N}\left(0,\Sigma\right)\)</span>. It is common to decompose this
  into a prior on <span class="math inline">\(\alpha_j\)</span> and <span class="math inline">\(\beta_j\)</span> and a prior on the correlation matrix
  <span class="math inline">\(R\)</span>.</p>
<p>Use the priors <span class="math inline">\(\alpha_j \sim
    \mathrm{normal}\left(0,\tau_\alpha\right), \beta_j\sim
    \mathrm{normal}\left(0,\tau_\beta\right), \tau_\alpha\sim
    \mathrm{normal}_+\left(0,100\right), \tau_\beta\sim
    \mathrm{normal}_+\left(0,20\right)\)</span> and <span class="math inline">\(R\sim \mathrm{LKJ}\left(2\right)\)</span>.</p>
<p><strong>6.9</strong> Which of these formulae correctly defines the linear
  predictor in this case?</p>
<p><strong>6.10</strong> Which is the correct brms formula for this model?</p>
<p><strong>6.11</strong> Based on the posterior, the estimate of the standard
  deviation of Subject-specific effect of Days is: </p>
<p><strong>6.12</strong> Based on the posterior, the estimate of correlation
  between the Subject-specific Intercept and effect of Days is:
  </p>
<p><strong>6.13</strong> After fitting both models, which of the statements
  describe the results best (here interpret “plausible” as what is contained
  within the 95% posterior interval):</p>
<p>Based on this, we would hope to see also graphically differences between the
  varying intercept only and the varying intercept plus varying slope models.
  Use the <code>conditional_effect()</code> function in brms to plot the
  posterior distribution of the linear predictor term at the covariate’s mean
  values (<a href="https://paulbuerkner.com/brms/reference/conditional_effects.brmsfit.html">this
    is the default of the function</a>).</p>
<p>First, let’s check you used the function correctly.</p>
<p><strong>6.14</strong> Which figure plots the conditional effects of the
  varying slope model?</p>
<div class="figure"><img style="width: 50.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/cond_effects_1.png" alt="">
  <p class="caption">Figure 3</p>
</div>
<div class="figure"><img style="width: 50.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/cond_effects_2.png" alt="">
  <p class="caption">Figure 4</p>
</div>
<p>We will add more model features and conduct predictive evaluation in the next
  assignment!</p>
<h1 id="school-calendar-dataset">7. School calendar dataset</h1>
<p>As you’ve learned from the above, hierarchical models are also useful for
  meta-analyses.</p>
<p>The dataset <code>dat.konstantopolous2011</code> from the
  <code>metadat</code> package contains results from different studies conducted
  on the effect of changing the school calendar from a standard one with a long
  summer break to a modified one with more regular but shorter breaks.</p>
<p>Each result of a study is a standardized estimated mean effect on student
  achievement, where positive values indicate improvement <span class="math inline">\((y_i)\)</span> and the variance of the estimate <span class="math inline">\((v_i)\)</span> for a school.</p>
<p>The meta-analysis model can be written as follows: <span class="math inline">\(y_{ijk} \sim
    \mathrm{normal}\left(\mu_{ijk},\sigma_{ijk}\right)\)</span>. <span class="math inline">\(i\)</span> refers to an observation, <span class="math inline">\(j\)</span> refers to a school, <span class="math inline">\(k\)</span> refers to a district. <span class="math inline">\(\mu_{ijk}\)</span> thus refers to one observation
  <span class="math inline">\(i\)</span> at school <span class="math inline">\(j\)</span> in district <span class="math inline">\(k\)</span>. <span class="math inline">\(\mu_0\)</span>
  is the population-level effect, <span class="math inline">\(\mu_j\)</span> is
  the school-specific effect, and <span class="math inline">\(\mu_k\)</span> is
  the district-specific effect.</p>
<p>In this case, the <span class="math inline">\(\sigma_{ijk}\)</span> values
  are known (the standard errors reported from each study) and the <span class="math inline">\(\mu_{ijk}\)</span> term will differ depending on the
  model.</p>
<p>In this exercise you will fit four different models to the same data set:
  Pooled, separate, partially pooled within school-specific effects, and
  partially pooled within schools and district effects.</p>
<p>For all models, use brms with the default priors and use the following
  settings: iter = 2000, warmup = 1000, chains = 4, seed = 2024</p>
<p>The dataset has separate columns for school and district, but for the models,
  we will want a unique identifier for each school. Before fitting any models,
  add a new column to the dataset called “district_school” which is the
  combination of the district and the school. This is then unique for each
  school, and will be used in the model formulae.</p>
<p><strong>Pooled model</strong>:</p>
<p>Use brms to fit a pooled model and answer the following questions. Check the
  code notebook for help starting.</p>
<p>The pooled model formula is: <span class="math inline">\(\mu_{ijk}=\mu_0\)</span>.</p>
<p><strong>7.1</strong> The pooled model is written as:</p>
<p><strong>7.2</strong> How many parameters are estimated in the pooled model?
</p>
<p><strong>7.6</strong> Based on the posterior of the Intercept, what would you
  conclude about the effect of the intervention:</p>
<p><strong>7.7</strong> Suppose there is a new school in an existing district
  (School = 9, District = 86). What is the mean prediction for the effect in
  this school? Use the function <code>posterior_epred</code> and the newdata
  argument.</p>
<p>Use brms to fit a separate model and answer the following questions. Check
  the code notebook for help starting.</p>
<p>The separate model formula is: <span class="math inline">\(\mu_{ijk}=\mu_{jk}\)</span>.</p>
<p><strong>7.9</strong> The separate model is written as:</p>
<p><strong>7.10</strong> How many parameters are estimated in the separate
  model?</p>
<p>Mean: , lower 95% interval bound:
  , upper 95% interval bound: </p>
<p><strong>7.12</strong> What is the estimated effect for School 7 in District
  86?</p>
<p>Mean: , lower 95% interval bound:
  , upper 95% interval bound: 
</p>
<p><strong>7.13</strong> Based on the posterior for the separate model, what
  could reasonably be concluded about the effect of the intervention:</p>
<p><strong>7.14</strong> Suppose there is a new school in an existing district
  (District = 86, School = 9). Why can we not easily predict the effect for this
  school based on the separate model posterior?</p>
<p><strong>Partially pooled model for schools</strong></p>
<p>The partially pooled model formula is: <span class="math inline">\(\mu_{ijk}
    = \mu_0 + \mu_{jk}\)</span></p>
<p><strong>7.15</strong> And the partially pooled hierarchical model:</p>
<p><strong>7.16</strong> How many parameters are estimated in the partially
  pooled for schools model?</p>
<p><strong>7.18</strong> What is the estimated effect for School 3 in District
  71?</p>
<p>Mean:  , lower 95% interval bound:
  , upper 95% interval bound: </p>
<p><strong>7.19</strong> What is the estimated effect of School 7 in District
  86?</p>
<p>Mean:  , lower 95% interval bound:
  , upper 95% interval bound: 
</p>
<p><strong>7.20</strong> Suppose there is a new school in an existing district
  (District = 86, School = 9). What would the mean prediction for the effect in
  this school? Use the function<code>posterior_epred</code> and the newdata
  argument with allow_new_levels = TRUE:</p>
<p>In this data set, as there is a two-level structure, where schools are nested
  in districts, we can add another level to the hierarchy. The additional
  hierarchy formula is: <span class="math inline">\(\mu_{ijk}=\mu_0+\mu_j+\mu_{jk}\)</span></p>
<p><strong>7.22</strong> What is the correct brms formula?</p>
<p><strong>7.23</strong> How many parameters are estimated in the partially
  pooled for schools in districts model?</p>
<p><strong>7.27</strong> After fitting all the models, choose which of the
  following statements relating to the results are true:</p>
<p></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./assignment6.html" class="pagination-link" aria-label="Assignment 6">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Assignment 6</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./assignment8.html" class="pagination-link" aria-label="Assignment 8">
        <span class="nav-page-text">Assignment 8</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>