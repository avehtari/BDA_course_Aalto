---
title: "Assignment 1"
author: "Aki Vehtari et al."
format:
  html:
    toc: true
    code-tools: true
    code-line-numbers: true
    number-sections: true
    mainfont: Georgia, serif
  pdf:
    geometry:
    - left=1cm,top=1cm,bottom=1cm,right=7cm
    number-sections: true
    code-annotations: none
editor: source
---

# General information

The exercises here refer to the lecture 1/BDA chapter 1 content, not the course infrastructure quiz. This assignment is meant to test whether or not you have sufficient knowledge to participate in the course. The first question checks that you remember basic terms of probability calculus. The second exercise checks you recognise the most important notation used throughout the course and used in BDA3. The third-fifth exercise you will solve some basic Bayes theorem questions to check your understanding on the basics of probability theory. The 6th exercise checks on whether you recall the three steps of Bayesian Data Ananlysis as mentioned in chapter 1 of BDA3. The last exercise walks you through an example of how we can use models to generate distributions for outcomes of interest, applied to a setting of a simplified Roulette table.

This quarto document is not intended to be submitted, but to render the questions as they appear on Mycourses to be available also outside of it. 

**The exercises constitute 80% of the Quiz 1 grade.**

We prepared a quarto template specific to this assignment to help you get started. [You still need to fill in your answers on Mycourses!]{.underline} You can inspect this and future templates

-   as a [qmd file](https://avehtari.github.io/BDA_course_Aalto/assignments/template1.qmd),
-   as a [rendered html file](template1.html)

::: {.callout-warning collapse="false"}
## Setup

This is the template for [assignment 1](assignment1.html). You can download the [qmd-file](https://avehtari.github.io/BDA_course_Aalto/assignments/template1.qmd) or copy the code from this rendered document after clicking on `</> Code` in the top right corner.

**Please replace the instructions in this template by your own text, explaining what you are doing in each exercise.**

The following will set-up `markmyassignment` to check your functions at the end of the notebook:

```{r}
library(markmyassignment)
assignment_path = paste("https://github.com/avehtari/BDA_course_Aalto/",
"blob/master/tests/assignment1.yml", sep="")
set_assignment(assignment_path)
```
:::

# 1. Basic probability theory notation and terms

This can be trivial or you may need to refresh your memory on these concepts (see, e.g. Aalto course *First Course in Probability and Statistics*). Match each of the following terms to the list of labeled pasted below:

1.  probability
2.  probability mass (function)
3.  probability density (function)
4.  probability distribution
5.  discrete probability distribution
6.  continuous probability distribution
7.  cumulative distribution function (cdf)
8.  likelihood

::: {.callout-note icon="false"}
###### Question 1.1
Match the following terms with the correct definition:
Note that the answers order and set of possible answers is the same for questions 1.1 - 1.8. Check the BDA chapter 1, the lecture slides, and Wikipedia if you are uncertain about the terms below. 
:::



# 2. Notation

This task check whether you recognise the following math symbols.

::: {.callout-note icon="false"}
###### Question 2.1
Match the following notation with the correct definition:

$\sim$


:::

::: {.callout-note icon="false"}
###### Question 2.2
Match the following notation with the correct definition:

$\propto$

:::

::: {.callout-note icon="false"}
###### Question 2.3
Match the following notation with the correct definition:

$E[\cdot]$

:::

::: {.callout-note icon="false"}
###### Question 2.4
Match the following notation with the correct definition:

$p(y|\theta)$
:::

# 3. Bayes' theorem 1

A group of researchers has designed a new inexpensive and painless test for detecting lung cancer. The test is intended to be an initial screening test for the population in general. A positive result (presence of lung cancer) from the test would be followed up immediately with medication, surgery or more extensive and expensive test. The researchers know from their studies the following facts:

-   Test gives a positive result in $98\%$ of the time when the test subject has lung cancer.
-   Test gives a negative result in $96\%$ of the time when the test subject does not have lung cancer.
-   In general population approximately one person in 1000 has lung cancer.

Here are some probability values that can help you figure out if you copied the right conditional probabilities from the question:

-   P(Test gives positive \| Subject does not have lung cancer) = 4%
-   P(Test gives positive and Subject has lung cancer) = 0.098%
    -   this is also referred to as the joint probability of test being positive and the subject having lung cancer

Your end goal for this exercise is to calculate the probability of having cancer given a positive test result: P(cancer\|positive).

::: {.callout-note icon="false"}
###### Question 3.1
Which quantity in Bayes' Theorem does P(cancer\|positive) represent?

:::

::: {.callout-note icon="false"}
###### Question 3.2
What is the probability of the test having a positive result, given that the test subject has cancer (P(B\|A))?
:::

::: {.callout-note icon="false"}
###### Question 3.3
What is the probability of having cancer (P(A))?


:::

::: {.callout-note icon="false"}
###### Question 3.4
What is the probability of having a positive test (P(B))?


:::

::: {.callout-note icon="false"}
###### Question 3.5
Using your previous answers, what is the probability of having cancer given a positive test?


:::

::: {.content-visible when-profile="public"}
If you use pen and paper, it may help to draw pictures as follows (see also [assignment_instructions#fig-workflow](assignment_instructions#fig-workflow)):

![Parts of Bayesian workflow](additional_files/bayes_workflow.jpg){#fig-workflow width="350"}

See @fig-workflow for illustration of parts of Bayesian workflow.
:::

Here are some probability values that can help you figure out if you copied the right conditional probabilities from the question.

-   P(Test gives positive \| Subject does not have lung cancer) = $4\%$
-   P(Test gives positive **and** Subject has lung cancer) = $0.098\%$ this is also referred to as the **joint probability** of *test being positive* and the *subject having lung cancer*.



# 4. Bayes' theorem 2

We have three boxes, A, B, and C. There are

-   2 red balls and 5 white balls in the box A,
-   4 red balls and 1 white ball in the box B, and
-   1 red ball and 3 white balls in the box C.

Consider a random experiment in which one of the boxes is randomly selected and from that box, one ball is randomly picked up. After observing the color of the ball it is replaced in the box it came from. Suppose also that on average box A is selected 40% of the time and box B $10\%$ of the time (i.e. $P(A) = 0.4$).

::: {.content-visible when-profile="public"}
The following will help you implementing a function to calculate the required probabilities for this exercise. Keep the below name and format for the function to work with `markmyassignment`:

```{r}
boxes_test <- matrix(c(2,2,1,5,5,1), ncol = 2,
    dimnames = list(c("A", "B", "C"), c("red", "white")))

p_red <- function(boxes) {
    # Do computation here, and return as below.
    # This is the correct return value for the test data provided above.
    0.3928571
}

p_box <- function(boxes) {
    # Do computation here, and return as below.
    # This is the correct return value for the test data provided above.
    c(0.29090909,0.07272727,0.63636364)
}
```
:::





::: {.callout-note icon="false"}
###### Question 4.1
What is the probability of picking a red ball from box A?
:::

::: {.callout-note icon="false"}
###### Question 4.2
What is the probability of picking a red ball from box B?
:::

::: {.callout-note icon="false"}
###### Question 4.3
What is the probability of picking a red ball from box C?

:::

::: {.callout-note icon="false"}
###### Question 4.4
Considering the probabilities of selecting each box, what is the probability of picking a red ball (tolerance of 0.01)?
:::

::: {.callout-note icon="false"}
###### Question 4.4
If a red ball was picked, calculate the probability that it was picked from (tolerance of 0.04):
:::

# 5. Bayes' theorem 3

Assume that on average fraternal twins (two fertilized eggs and then could be of different sex) occur once in 150 births and identical twins (single egg divides into two separate embryos, so both have the same sex) once in 400 births (**Note!** This is not the true value, see Exercise 1.6, page 28, in BDA3). Assume that an equal number of boys and girls are born on average.

American male singer-actor Elvis Presley (1935 -- 1977) had a twin brother who died in birth, your goal is to compute the probability that Elvis was an identical twin.

::: {.content-visible when-profile="public"}
The R functions below might help you calculating the requited probabilities.

```{r}
fraternal_prob = 1/125
identical_prob = 1/300
```

Keep the below name and format for the function to work with `markmyassignment`:

```{r}
p_identical_twin <- function(fraternal_prob, identical_prob) {
    # Do computation here, and return as below.
    # This is the correct return value for the test data provided above.
    0.4545455
}
```
:::



::: {.callout-note icon="false"}
###### Question 5.1
What is the probability of having a twin brother, given identical twins (no tolerance)?
:::

::: {.callout-note icon="false"}
###### Question 5.2
What is the total probability of having a twin brother (either fraternal or identical)? (tolerance of 0.001)
:::

::: {.callout-note icon="false"}
###### Question 5.3
5.3 What is the probability that Elvis was an identical twin, given that he had a twin brother? (tolerance of 0.001)
:::

# 6. The three steps of Bayesian data analysis

::: {.callout-note icon="false"}
###### Question 6.1
6.1 Select the three steps of Bayesian data analysis (see BDA3 p. 3):
:::

# 7. A Binomial Model for the Roulette Table

In this course, models are used to explain social and physical data, and we will be able to generate data from our models which we can use for checking how well our model does. In this example, we show how to generate outcomes from a binomial model to explain outcomes of a roulette game (there is a connection to the history of statistics). Suppose a roulette table with only red and black colours. Roulette tables won't be perfect and it's likely that the probability of red vs black is not exactly 0.5 (the tables can have adjustments that are randomized each day to avoid long term bias). 

Suppose your model for the tables' ratio of red/black is a Binomial which takes as inputs the number of trials and a probability parameter, theta. Set theta to 0.6 (this is much bigger than what we would expect in real roulette, but makes it easier as a teaching example) and generate a series (for a sequence of 100 equally spaced trial values between 10 and 1000) of red/black ratios. Generate 1000 random draws from your model for each trial value and save the data in a Data frame with columns `Ratios`, `Nsims` and `Trials`. Incomplete code can be found below.

```{r,eval=FALSE}
# Ratio of red/black
theta <- # declare probability parameter for the binomial model

# Sequence of trials

trials <- seq(#start value of sequence,#end value of sequence,#value for spacing)

# Number of simulation draws from the model
nsims <- # number of of simulations from the binomial model

# Helper function for getting the ratios
binom_gen <- function(trials,theta,nsims){
    df <-  as.data.frame(rbinom(nsims,trials,theta)/trials) |> mutate(nsims = nsims,trials = trials)
    colnames(df) <- c("Ratios","Nsims","Trials")
  return(df)
}

# Create a data frame containing the draws for each number of trials
ratio_60 <- do.call(rbind, lapply(trials, binom_gen, theta, nsims)) # lapply applies elements in trials column to binom_gen function, which is then rowbound via do.call
```

::: {.callout-note icon="false"}
###### Question 7.1
Suppose you are unsure whether the code to create the data frame worked. Which of the following functions should you use in order to check on the structure of the dataframe object (assuming df below stands for a generic dataframe object)?


:::

::: {.callout-note icon="false"}
###### Question 7.2
The structure checks out, but now you want to print the first 5 rows of the dataframe to check whether the values are as expected. Which of the following functions should you use?


:::

::: {.callout-note icon="false"}
###### Question 7.3
The quick peek checks also out, but you would be more at ease scrolling all data, perhaps you'll find some interesting patterns. Which of the following actions allows you to scroll through the data in a separate window (for the below, we assume that you have the code loaded in an RStudio session)? (More than one answer may be correct)
:::

Now plot a histogram of the computed ratios for 10, 50 and 1000 trials, using the code below

```{r,eval=FALSE}
# Plot the Distributions
subset_df <- ratio_60[ratio_60$Trials %in% c(#trial values), ] # Subset your dataframe

subset_df60 |> ggplot(aes(Ratios)) +
  geom_histogram(position = "identity" ,bins = 40) +
  facet_grid(cols = vars(Trials))  +
  ggtitle("Ratios for specific trials")
```

::: {.callout-note icon="false"}
###### Question 7.4
Which histogram below is the correct one for theta = 0.6?
:::

::: {.callout-note icon="false"}
###### Question 7.5
What do these distributions refer to?
:::

::: {.callout-note icon="false"}
###### Question 7.6
Given these histograms, which number of trials gives you the most certainty about the likely red/black ratio for that table?
:::

::: {.callout-note icon="false"}
###### Question 7.7
Given the draws from the model, give an estimate about the probability p(Ratio\<=0.5) for the model with 1000 trials (tolerance of 0.001).
:::

Suppose you are now certain that theta = 0.6, plot the probability density given 1000 trials using the code below.

```{r, eval=FALSE}
size =  # number of trials
prob =  # probability of success

binom_data <- data.frame(
  Success = 0:size,
  Probability = dbinom(0:size, size = size, prob = prob)
)

ggplot(binom_data, aes(x = Success, y = Probability)) +
  geom_point() +
  geom_line() +
  labs(title = "PMF of Binomial Distribution", x = "Number of Successes", y = "PDF")

```

::: {.callout-note icon="false"}
###### Question 7.8
Which plot of the PMF is the correct one?
:::

::: {.callout-note icon="false"}
###### Question 7.9
How does the PMF plot relate to the histogram of ratios plotted earlier?

:::

::: {.callout-note icon="false"}
###### Question 7.10
Given the PMF for your model, calculate the probability for 1000 trials of observing less or equal to 500 red outcomes using theta = 0.6. Use the pbinom function in R.


:::

::: {.callout-warning collapse="false"}
## markmyassignment

The following will check the functions for which `markmyassignment` has been set up:

```{r}
mark_my_assignment()
```
:::

