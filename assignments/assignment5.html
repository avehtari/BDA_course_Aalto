<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aki Vehtari et al.">

<title>Assignment 5 – Bayesian Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./assignment6.html" rel="next">
<link href="./assignment4.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-3b41dc0f5e1034f3961de186a2aad809.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script>


</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignment1.html">Assignments</a></li><li class="breadcrumb-item"><a href="./assignment5.html">Assignment 5</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">General instructions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment_instructions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment instructions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment5.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Assignment 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 9</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Templates</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook for Assignment 9</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#general-information" id="toc-general-information" class="nav-link active" data-scroll-target="#general-information"><span class="header-section-number">1</span> General information</a>
  <ul class="collapse">
  <li><a href="#assignment-questions" id="toc-assignment-questions" class="nav-link" data-scroll-target="#assignment-questions"><span class="header-section-number">1.1</span> Assignment questions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignment1.html">Assignments</a></li><li class="breadcrumb-item"><a href="./assignment5.html">Assignment 5</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Assignment 5</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Aki Vehtari et al. </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="general-information" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> General information</h1>
<p>The exercises here refer to the lecture 5/BDA chapter 11 content. The main topics for this assignment are the MCSE and importance sampling.</p>
<p><strong>The exercises constitute 96% of the Quiz 5 grade.</strong></p>
<p>We prepared a quarto notebook specific to this assignment to help you get started. <u>You still need to fill in your answers on Mycourses!</u> You can inspect this and future templates</p>
<ul>
<li>as a <a href="template5.html">rendered html file</a> (to access the qmd file click the “&lt;/&gt; Code” button at the top right hand corner of the template)</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>General Instructions for Answering the Assignment Questions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Questions below are exact copies of the text found in the MyCourses quiz and should serve as a notebook where you can store notes and code.</li>
<li>We recommend opening these notebooks in the Aalto JupyterHub, see <a href="https://avehtari.github.io/BDA_course_Aalto/FAQ.html#How_to_use_R_and_RStudio_remotely"><strong>how to use R and RStudio remotely</strong></a>.</li>
<li>For inspiration for code, have a look at the <a href="https://avehtari.github.io/BDA_course_Aalto/demos.html"><strong>BDA R Demos</strong></a> and the specific Assignment code notebooks</li>
<li>Recommended additional self study exercises for each chapter in BDA3 are listed in the course web page. These will help to gain deeper understanding of the topic.</li>
<li>Common questions and answers regarding installation and technical problems can be found in <a href="https://avehtari.github.io/BDA_course_Aalto/FAQ.html">Frequently Asked Questions (FAQ)</a>.</li>
<li>Deadlines for all assignments can be found on the course web page and in MyCourses.</li>
<li>You are allowed to discuss assignments with your friends, but it is not allowed to copy solutions directly from other students or from internet.</li>
<li>Do not share your answers publicly.</li>
<li>Do not copy answers from the internet or from previous years. We compare the answers to the answers from previous years and to the answers from other students this year.</li>
<li>Use of AI is allowed on the course, but the most of the work needs to by the student, and you need to report whether you used AI and in which way you used them (See <a href="https://www.aalto.fi/en/services/guidance-for-the-use-of-artificial-intelligence-in-teaching-and-learning-at-aalto-university">points 5 and 6 in Aalto guidelines for use of AI in teaching</a>).</li>
<li>All suspected plagiarism will be reported and investigated. See more about the <a href="https://into.aalto.fi/display/ensaannot/Aalto+University+Code+of+Academic+Integrity+and+Handling+Violations+Thereof"><strong>Aalto University Code of Academic Integrity and Handling Violations Thereof</strong></a>.</li>
<li>If you have any suggestions or improvements to the course material, please post in the course chat feedback channel, create an issue, or submit a pull request to the public repository!</li>
<li>The decimal separator throughout the <strong>whole course</strong> is a dot, “.” (Follows English language convention). Please be aware that MyCourses will not accept numerical value answers with “,” as a decimal separator</li>
<li><u><strong>Unless stated otherwise</strong></u>: if the question instructions ask for reporting of numerical values in terms of the ith decimal digit, round to the ith decimal digit. For example, 0.0075 for two decimal digits should be reported as 0.01. More on this in Assignment 4.</li>
</ul>
</div>
</div>
</div>
<section id="assignment-questions" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="assignment-questions"><span class="header-section-number">1.1</span> Assignment questions</h2>
<p>For convenience the assignment questions are copied below. Answer the questions in MyCourses.</p>
<p></p>
<h1 id="lecture-5chapter-11-of-bda-quiz-96-of-grade">Lecture 5/Chapter 11 of BDA
  Quiz (96% of grade)</h1>
<h1 id="monte-carlo-methods">1. Monte Carlo Methods</h1>
<p>As you’ve learned in the previous assignments, in some cases we have closed
  form solution for useful posterior summaries for parameter vector <span class="math inline">\(\theta\)</span>.</p>
<p><strong>1.1</strong> Why are Monte Carlo and other sampling based methods for
  posterior evaluation of functions <span class="math inline">\(f(\theta)\)</span> convenient?</p>
<p></p>
<p>We now briefly review some Monte Carlo methods. Assume we want to obtain
  draws from <span class="math inline">\(p(\theta \mid y)\)</span> . Possibly
  the simplest way, is to apply grid sampling (see lectures <a href="https://avehtari.github.io/BDA_course_Aalto/slides/BDA_lecture_3.pdf">3.2</a>
  and <a href="https://avehtari.github.io/BDA_course_Aalto/slides/BDA_lecture_4.pdf">4.1</a>).
  Briefly, the general idea of this method is to identify range of values for
  <span class="math inline">\(\theta\)</span> which captures almost all the mass
  of the posterior distribution, divide this range into grid (small intervals
  for 1D case, small squares for 2D case and so on), compute the unnormalised
  posterior density at a grid of values, normalize them by approximating the
  distribution as a step function over the grid and setting the total
  probability in the grid to 1. Then we can draw from the discrete distribution
  over values of a grid (more information can be found on page 76 of BDA3).
  However, this approach poses a certain challenge for the case of multivariate
  <span class="math inline">\(\theta\)</span>.</p>
<p><strong>1.2</strong> What is the main issue of grid sampling:</p>
<p></p>
<p>We may try to apply more elaborated methods such as rejection sampling (page
  264 of BDA3). Rejection sampling is based on defining a positive function
  <span class="math inline">\(g(\theta)\)</span>, so that we can obtain draws
  from the probability density proportional to <span class="math inline">\(p(\theta)\)</span> and accept those draws according to
  a certain rule (check <a href="https://avehtari.github.io/BDA_course_Aalto/slides/BDA_lecture_4.pdf">lecture
    4</a>).</p>
<p><strong>1.3</strong> What problem(s) appear with rejection sampling:</p>
<p></p>
<h1 id="markov-chain-monte-carlo-mcmc">2. Markov Chain Monte Carlo (MCMC)</h1>
<p>The most popular way to obtain posterior draws nowadays is MCMC.</p>
<p><strong>2.1</strong> What is a Markov chain?</p>
<p></p>
<p><strong>2.2</strong> Which of the following is not a Markov chain?</p>
<p></p>
<p><strong>2.3</strong> In question 2.2 we assumed discrete sequences. For the
  continuous case, we can use conditional transition distribution <span class="math inline">\(T_t(\theta^t \theta^{t-1})\)</span> for a set of
  random variables <span class="math inline">\(\theta_1, \theta_2,
    \dots\)</span> to describe the probability density <span class="math inline">\(p(\theta^t \mid \theta^1, \dots, \theta^{t-1}) =
    p(\theta^t \theta^{t-1})\)</span>, given some initial point <span class="math inline">\(\theta^0\)</span>. What are the two steps we need to
  prove for the Markov chain to eventually produce valid series of draws from
  the posterior <span class="math inline">\(p(\theta \mid y)\)</span>?</p>
<p></p>
<p><strong>2.4</strong> What are the necessary and sufficient conditions to
  prove that a Markov chain has a unique stationary distribution?</p>
<p>
  
</p>
<p><strong>2.5</strong> Why is it often necessary to discard the first draws of
  the MCMC chain?</p>
<p></p>
<p><strong>2.6</strong> Why might MCMC be preferable to grid and rejection
  sampling?</p>
<p></p>
<h1 id="metropolis-algorithm">3. Metropolis algorithm</h1>
<p>The Metropolis algorithm is a relatively simple MCMC algorithm, yet it is
  foundational for more advanced algorithms, such as the Hamiltonian Monte Carlo
  algorithm you will encounter later in the course. Later in this assignment,
  you will implement the Metropolis algorithm (page 278 of BDA3). Denote the
  proposal distribution at time <span class="math inline">\(t\)</span> for
  parameter vector <span class="math inline">\(\theta^t\)</span> conditional on
  <span class="math inline">\(\theta^{t-1}\)</span> as <span class="math inline">\(J_t(\theta^t \mid \theta^{t-1})\)</span>. For
  simplicity, we consider here symmetric proposal distributions (otherwise the
  algorithm would be known as the Metropolis-Hastings algorithm).</p>
<p><strong>3.1</strong> What is a main idea behind the Metropolis algorithm?</p>
<p></p>
<p><strong>3.2</strong>: Denote the current proposal by <span class="math inline">\(\theta^*\)</span> at time <span class="math inline">\(t\)</span> from the proposal distribution <span class="math inline">\(J_t (\theta^* \theta^{t-1})\)</span>. Which one is the
  correct acceptance ratio, <span class="math inline">\(r\)</span>:</p>
<p><strong>3.3</strong> Which one is the correct rule for accepting the
  proposal? Denote the acceptance ratio you’ve determined in 3.2 by <span class="math inline">\(r\)</span>. Set <span class="math inline">\(\theta^t\)</span> equal to:</p>
<p><strong>3.4</strong> Assume the posterior surface has a unique mode. What
  would eventually happen to the MCMC chain if adopting the rule <span class="math inline">\(\theta^*\)</span> iff <span class="math inline">\(r
    &gt; 1\)</span> and <span class="math inline">\(\theta^{t-1}\)</span>
  otherwise?</p>
<p></p>
<p><strong>3.5</strong> Retain the assumption made in question 3.4. Why is the
  posterior mode alone not generally useful for posterior expectations?</p>
<p></p>
<h1 id="trace-plot-diagnostics">4. Trace plot diagnostics</h1>
<p>Suppose you’ve successfully obtained multiple chains of MCMC draws from the
  Metropolis algorithm. Remember that the goal for the MCMC chains is to firstly
  converge to some unique distribution, and that all chains converge to the same
  distribution (with the hope of that being <span class="math inline">\(p(\theta
    \mid y)\)</span>). You would now like to check if your chains can be trusted
  to have done so, after having discarded an appropriate amount of draws you
  used for warm-up. There are multiple convergence diagnostics and we will
  discuss some of them here. One way is to investigate the trace plot: check
  visually whether the chains converged to the same distribution. If they have,
  we say the chains have mixed. To do this, we plot them in the same figure and
  observe if something went wrong. Below you are given an example with two
  chains. Look at them carefully and answer questions below.</p>
<div class="figure"><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/Quiz5/trace_4.png" alt="">
  <p class="caption">Figure 1</p>
</div>
<div class="figure"><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/Quiz5/trace_3.png" alt="">
  <p class="caption">Figure 2</p>
</div>
<p><strong>4.1</strong> Can you say that your chains converged to the same
  distribution based on Figure 1:</p>
<p></p>
<p><strong>4.2</strong>: Can you say that your chains are mixing well based on
  Figure 2:</p>
<p></p>
<p><strong>5.</strong> Trace plot inspection can be useful when the number of
  parameters is small. When dealing with a large number of parameters, however,
  it becomes inconvenient to analyse trace plots of each parameter separately,
  therefore we would like to also have some quantitative metrics for
  investigating convergence. One of them is called Rhat. There are different
  versions of it, for instance, version from BDA3 book (page 285). The much
  improved version you will use throughout the course is presented in <a href="https://projecteuclid.org/journals/bayesian-analysis/volume-16/issue-2/Rank-Normalization-Folding-and-Localization--An-Improved-R%cb%86-for/10.1214/20-BA1221.full">Vehtari
    et al.&nbsp;(2021)</a>. Let’s look at the book version to understand why it is
  preferred to use the modified version.</p>
<p><strong>5.1</strong>: What is the definition of Rhat from the BDA3 book:</p>
<p></p>
<p><strong>5.2</strong>: Which range of values for Rhat would are a good
  indicator for convergence (see lecture 5)?</p>
<p></p>
<p>Imagine a situation where one chain converged to N(0, 1) distribution and the
  other one to Student t with 3 degrees of freedom. The trace plot then looks
  like:</p>
<div class="figure"><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/Quiz5/rhat_example.png" alt="">
  <p class="caption">Figure 3</p>
</div>
<p><strong>5.3</strong>: What do you observe?</p>
<p>
</p>
<p><strong>5.4</strong> However, despite of this issue, the Rhat value from the
  book equals <span class="math inline">\(\sim\)</span> 1, indicating good
  convergence of the chains. What can be the explanation for this:</p>
<p></p>
<p>On the contrary, the much improved Rhat computation as presented in <a href="https://projecteuclid.org/journals/bayesian-analysis/volume-16/issue-2/Rank-Normalization-Folding-and-Localization--An-Improved-R%cb%86-for/10.1214/20-BA1221.full">Vehtari
    et al.&nbsp;(2021)</a>, equals in a Rhat value of 1.39, much bigger than the
  recommended threshold of 1.01. You can find more examples about the usefulness
  of the improved Rhat computation in the paper but also this <a href="https://avehtari.github.io/BDA_R_demos/demos_ch11/demo11_3_4.html">demo</a>.
  The improved Rhat is the default in cmdstan as well as the brms R package
  (used heavily in later assignments) and is called in this assignment’s
  template via the posterior package.</p>
<h1 id="ess-diagnostics">6. ESS diagnostics</h1>
<p>Another useful quantity is the effective sample size.</p>
<p><strong>6.1:</strong> Why can we not rely on total sample size of draws from
  MCMC?</p>
<p></p>
<p><strong>6.2</strong> Suppose you have obtained <span class="math inline">\(S\)</span> draws from your posterior with MCMC. We
  define the effective sample size as <span class="math inline">\(S_\text{eff} =
    S/\tau\)</span>. What does <span class="math inline">\(\tau\)</span> refer
  to in this context?</p>
<p></p>
<p><strong>6.3</strong> Look at the trace plots below. For which sequences do
  you expect HIGHER effective sample size:</p>
<div class="figure"><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/Quiz5/gibbs_2.png" alt="">
  <p class="caption">Figure 4</p>
</div>
<div class="figure"><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/Quiz5/gibbs_1.png" alt="">
  <p class="caption">Figure 5</p>
</div>
<p></p>
<p><strong>6.4</strong> Select the autocorrelation function below corresponding
  to the chains in Figure 4 of the previous question.</p>
<div class="figure"><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/Quiz5/autocorrelation_2.png" alt="">
  <p class="caption">Figure 6</p>
</div>
<div class="figure"><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/Quiz5/autocorrelation_1.png" alt="">
  <p class="caption">Figure 7</p>
</div>
<p></p>
<h1 id="generalised-linear-model-bioassay-model-with-metropolis-algorithm">7.
  Generalised linear model: Bioassay model with Metropolis algorithm</h1>
<p>In this exercise, you will implement the Metropolis algorithm. <a href="https://avehtari.github.io/BDA_course_Aalto/assignments/template5.html">Here</a>
  you are provided code for a Metropolis algorithm, however, it contains three
  errors. Your task is to find these errors, correct them and answer the
  following questions below.</p>
<p><strong>7.1</strong> Lets denote <code>bioassaylp(alpha_propose,
    beta_propose, x, y, n) - bioassaylp(alpha_previous, beta_previous, x, y, n)
    + dmvnorm(c(alpha_propose, beta_propose), prior_mean, prior_sigma, TRUE) -
    dmvnorm(c(alpha_previous, beta_previous), prior_mean, prior_sigma,
    TRUE)</code> as expression 1. How should we correct error 1:</p>
<p></p>
<p><strong>7.2</strong> Lets denote <code>if(runif(1) &gt;
    density_ratio(alpha_propose, alpha_previous, beta_propose, beta_previous, x,
    y, n))</code> as expression 2. How should we correct error 2:</p>
<p></p>
<p><strong>7.3:</strong> How should we correct error 3:</p>
<p></p>
<p>After you corrected the errors, you may run sampling. Investigate the code in
  the <a href="https://avehtari.github.io/BDA_course_Aalto/assignments/template5.html">notebook</a>
  and answer the questions below.</p>
<p><strong>7.4</strong> How many chains did we run:</p>
<p></p>
<p><strong>7.5</strong> How many draws including warm-up have we obtained for
  each individual chain</p>
<p></p>
<p><strong>7.6</strong> What is the warm-up length</p>
<p></p>
<p><strong>7.7</strong> After performing sampling, let’s check the convergence
  of the chains. The next code chunk will produce trace plots. Which one is the
  correct one:</p>
<div class="figure"><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/Quiz5/trace_1.png" alt="">
  <p class="caption">Figure 8</p>
</div>
<div class="figure"><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/Quiz5/trace_2.png" alt="">
  <p class="caption">Figure 9</p>
</div>
<p></p>
<p>After looking at trace plots, compute Rhat values for both alpha and beta:
</p>
<p><strong>7.8</strong> Rhat for alpha</p>
<p></p>
<p><strong>7.9</strong> Rhat for beta</p>
<p></p>
<p>In addition to Rhat, compute ESS for for the mean and 0.25 quantile of alpha
  and beta:</p>
<p><strong>7.10</strong> ESS mean for alpha</p>
<p></p>
<p><strong>7.11</strong> ESS mean for beta</p>
<p></p>
<p><strong>7.12</strong> ESS q0.25 for alpha</p>
<p></p>
<p><strong>7.13</strong> ESS q0.25 for beta</p>
<p></p>
<p>Let us compare ESS of independent draws and MCMC draws. Use 4000 independent
  draws from the posterior distribution of the model in the dataset
  bioassay_posterior in the aaltobda package from Assignment 4.</p>
<p><strong>7.14</strong> ESS mean of alpha for bioassay_posterior</p>
<p></p>
<p><strong>7.15</strong> ESS mean of beta for bioassay_posterior</p>
<p></p>
<p><strong>7.16</strong> ESS q0.25 of alpha for bioassay_posterior</p>
<p></p>
<p><strong>7.17</strong> ESS q0.25 of beta for bioassay_posterior</p>
<p></p>
<p><strong>7.18</strong> Visualise scatter plot of posterior draws. Which one is
  the correct figure:</p>
<div class="figure"><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/Quiz5/scatter_2.png" alt="">
  <p class="caption">Figure 10</p>
</div>
<div class="figure"><img style="width: 100.0%;" src="https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/master/figures/Quizzes/Quiz5/scatter_1.png" alt="">
  <p class="caption">Figure 11</p>
</div>
<p></p>
<p></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./assignment4.html" class="pagination-link" aria-label="Assignment 4">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Assignment 4</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./assignment6.html" class="pagination-link" aria-label="Assignment 6">
        <span class="nav-page-text">Assignment 6</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>